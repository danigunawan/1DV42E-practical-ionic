"use strict";var BookingSystem=angular.module("BookingSystem",["ionic","BookingSystem.controllers","BookingSystem.furnituring","BookingSystem.furnituringServices","BookingSystem.meals","BookingSystem.mealsServices","BookingSystem.mealPropertiesServices","BookingSystem.resources","BookingSystem.resourcesServices","BookingSystem.locationBooking","BookingSystem.locationBookingServices","BookingSystem.calendarDayDirective","BookingSystem.customers","BookingSystem.customersServices","BookingSystem.bookingTypes","BookingSystem.bookingTypesServices","BookingSystem.imageResizeServices","BookingSystem.calendarWeekDirective","BookingSystem.bookingHelperServices","BookingSystem.imageUploaderDirective","BookingSystem.locationsServices","BookingSystem.ngMinMaxDirectives","BookingSystem.filters","BookingSystem.bookingServices","ngMaterial","ngResource","ngMessages"]);BookingSystem.run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()}),moment.locale("sv")}]),BookingSystem.constant("API_URL","http://bokning.vvfors.se/api/"),BookingSystem.constant("API_IMG_PATH_URL","http://bokning.vvfors.se/"),BookingSystem.constant("UPLOAD_IMG_MAX_WIDTH","400"),BookingSystem.constant("UPLOAD_IMG_MAX_HEIGHT","400"),BookingSystem.constant("PHOTO_MISSING_SRC","img/photo_missing.svg"),BookingSystem.constant("DEFAULT_MAP_ZOOM",5),BookingSystem.constant("DEFAULT_LATITUDE",59.2792),BookingSystem.constant("DEFAULT_LONGITUDE",15.2361),BookingSystem.constant("MODAL_ANIMATION","slide-in-up"),BookingSystem.constant("DATA_SYNC_INTERVAL_TIME",3e5),BookingSystem.config(["$stateProvider","$urlRouterProvider","$mdDateLocaleProvider",function(e,t,o){e.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html",controller:"AppCtrl"}).state("app.start",{url:"/start",views:{menuContent:{templateUrl:"templates/start.html"}}}).state("app.location-booking-view",{url:"/location-booking-view",views:{menuContent:{templateUrl:"templates/location-booking/location-booking-view.html",controller:"LocationBookingViewCtrl"}}}).state("app.location-booking-create",{url:"/location-booking-create",params:{date:null,locationId:null},views:{menuContent:{templateUrl:"templates/location-booking/location-booking-create.html",controller:"LocationBookingCreateCtrl"}}}).state("app.furnituring-list",{url:"/furnituring-list",views:{menuContent:{templateUrl:"templates/furnituring/furnituring-list.html",controller:"FurnituringListCtrl"}}}).state("app.furnituring-details",{url:"/furnituring-details/:furnituringId",views:{menuContent:{templateUrl:"templates/furnituring/furnituring-details.html",controller:"FurnituringDetailsCtrl"}}}).state("app.furnituring-create",{url:"/furnituring-create",views:{menuContent:{templateUrl:"templates/furnituring/furnituring-create.html",controller:"FurnituringCreateCtrl"}}}).state("app.meals-list",{url:"/meals-list",views:{menuContent:{templateUrl:"templates/meals/meals-list.html",controller:"MealsListCtrl"}}}).state("app.meal-details",{url:"/meal-details/:mealId",views:{menuContent:{templateUrl:"templates/meals/meal-details.html",controller:"MealDetailsCtrl"}}}).state("app.meal-create",{url:"/meal-create",views:{menuContent:{templateUrl:"templates/meals/meal-create.html",controller:"MealCreateCtrl"}}}).state("app.resources-list",{url:"/resources-list",views:{menuContent:{templateUrl:"templates/resources/resources-list.html",controller:"ResourcesListCtrl"}}}).state("app.resource-details",{url:"/resource-details/:resourceId",views:{menuContent:{templateUrl:"templates/resources/resource-details.html",controller:"ResourceDetailsCtrl"}}}).state("app.resource-create",{url:"/resource-create",views:{menuContent:{templateUrl:"templates/resources/resource-create.html",controller:"ResourceCreateCtrl"}}}).state("app.customers-list",{url:"/customers-list",views:{menuContent:{templateUrl:"templates/customers/customers-list.html",controller:"CustomersListCtrl"}}}).state("app.customer-details",{url:"/customer-details/:customerId",views:{menuContent:{templateUrl:"templates/customers/customer-details.html",controller:"CustomerDetailsCtrl"}}}).state("app.customer-create",{url:"/customer-create",views:{menuContent:{templateUrl:"templates/customers/customer-create.html",controller:"CustomerCreateCtrl"}}}).state("app.bookingtypes-list",{url:"/bookingtypes-list",views:{menuContent:{templateUrl:"templates/bookingtypes/bookingtypes-list.html",controller:"BookingTypesListCtrl"}}}).state("app.bookingtype-details",{url:"/bookingtype-details/:bookingTypeId",views:{menuContent:{templateUrl:"templates/bookingtypes/bookingtype-details.html",controller:"BookingTypeDetailsCtrl"}}}).state("app.bookingtype-create",{url:"/bookingtype-create",views:{menuContent:{templateUrl:"templates/bookingtypes/bookingtype-create.html",controller:"BookingTypeCreateCtrl"}}}),t.otherwise("/app/start")}]),BookingSystem.config(["$mdDateLocaleProvider",function(e){e.months=["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"],e.shortMonths=["jan","feb","mar","apr","maj","jun","jul","aug","sep","okt","nov","dec"],e.days=["söndag","måndag","tisdag","onsdag","torsdag","fredag","lördag"],e.shortDays=["Sö","Må","Ti","On","To","Fr","Lö"],e.firstDayOfWeek=1,e.parseDate=function(e){var t=moment(e,"L",!0);return t.isValid()?t.toDate():new Date(NaN)},e.formatDate=function(e){return moment(e).format("L")},e.monthHeaderFormatter=function(t){return e.shortMonths[t.getMonth()]+" "+t.getFullYear()},e.weekNumberFormatter=function(e){return"Vecka "+e},e.msgCalendar="Kalender",e.msgOpenCalendar="Öppna kalender"}]),angular.module("BookingSystem.furnituringServices",["ngResource"]).factory("Furnituring",["$resource","API_URL",function(e,t){return e(t+"Furnituring/:furnituringId",{furnituringId:"@furnituringId"})}]).factory("LocationFurnituring",["$resource","API_URL",function(e,t){return e(t+"LocationFurnituring/:locationId",{locationId:"@locationId"},{remove:{url:t+"LocationFurnituring/:locationId/:furnituringId",id:"@id",method:"DELETE",isArray:!1,params:{locationId:"@locationId",furnituringId:"@furnituringId"}},removeForLocation:{url:t+"LocationFurnituring/:locationId",id:"@id",method:"DELETE",isArray:!1,params:{locationId:"@locationId"}},queryForLocation:{url:t+"LocationFurnituring/location/:locationId",id:"@id",method:"GET",isArray:!0,params:{locationId:"@locationId"}},saveForLocation:{url:t+"LocationFurnituring/location",id:"@id",method:"POST",isArray:!0}})}]),angular.module("BookingSystem.controllers",[]).controller("AppCtrl",["$scope","$ionicModal","$timeout",function(e,t,o){e.loginData={},t.fromTemplateUrl("templates/login.html",{scope:e}).then(function(t){e.modal=t}),e.closeLogin=function(){e.modal.hide()},e.login=function(){e.modal.show()},e.doLogin=function(){o(function(){e.closeLogin()},1e3)}}]).controller("PlaylistsCtrl",["$scope",function(e){e.playlists=[{title:"Reggae",id:1},{title:"Chill",id:2},{title:"Dubstep",id:3},{title:"Indie",id:4},{title:"Rap",id:5},{title:"Cowbell",id:6}]}]).controller("PlaylistCtrl",["$scope","$stateParams",function(e,t){}]),angular.module("BookingSystem.furnituring",[]).controller("FurnituringListCtrl",["$rootScope","$scope","$state","Furnituring",function(e,t,o,n){var r=function(){var o=n.query();o.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Möbleringar kunde inte hämtas, var god försök igen."}}),t.furniturings=o};t.$on("$ionicView.enter",function(e,t){r()})}]).controller("FurnituringDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","Furnituring",function(e,t,o,n,r,a,s){var i="templates/modals/furnituring-delete.html";t.editMode=!1,t.furnituringBackup={};var l=function(){a.fromTemplateUrl(i,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},u=function(){var n=s.get({furnituringId:o.furnituringId});n.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Möblering kunde inte hämtas, var god försök igen."}}),t.furnituring=n};t.startEditMode=function(){var e=this;e.isEditMode=!0,e.furnituringBackup=angular.copy(e.furnituring)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.furnituring=e.furnituringBackup},t.saveFurnituring=function(){var t=this;s.save({FurnituringId:o.furnituringId,Name:t.furnituring.Name}).$promise.then(function(o){t.endEditMode(),e.FlashMessage={type:"success",message:'Möbleringen "'+t.furnituring.Name+'" sparades med ett lyckat resultat'}})["catch"](function(o){409===o.status?e.FlashMessage={type:"error",message:'Det finns redan en möblering som heter "'+t.furnituring.Name+'". Två möbleringar kan inte heta lika.'}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när möbleringen skulle sparas"}),404===o.status&&(e.FlashMessage={type:"error",message:'Möbleringen "'+t.furnituring.Name+'" existerar inte längre. Hann kanske någon radera den?'},history.back())})},t.deleteFurnituring=function(){s["delete"]({furnituringId:o.furnituringId}).$promise.then(function(o){e.FlashMessage={type:"success",message:'Möbleringen "'+t.furnituring.Name+'" raderades med ett lyckat resultat'},history.back()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?e.FlashMessage={type:"error",message:"Möbleringen kan inte raderas eftersom det finns en lokalbokning eller en lokalmöblering som refererar till möbleringen"}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när möbleringen skulle tas bort"}),404===o.status&&(e.FlashMessage={type:"error",message:'Möbleringen "'+t.furnituring.Name+'" existerar inte längre. Hann kanske någon radera den?'}),history.back()})},l(),u()}]).controller("FurnituringCreateCtrl",["$rootScope","$stateParams","$scope","$state","Furnituring",function(e,t,o,n,r){o.furnituring={},o.saveFurnituring=function(){var t=this;r.save({FurnituringId:0,Name:t.furnituring.Name}).$promise.then(function(o){e.FlashMessage={type:"success",message:'Möbleringen "'+t.furnituring.Name+'" skapades med ett lyckat resultat'},history.back()})["catch"](function(o){409===o.status?e.FlashMessage={type:"error",message:'Det finns redan en möblering som heter "'+t.furnituring.Name+'". Två möbleringar kan inte heta lika.'}:e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när möbleringen skulle sparas"}})}}]),angular.module("BookingSystem.mealsServices",["ngResource"]).factory("Meal",["$resource","API_URL",function(e,t){return e(t+"Meal/:mealId",{mealId:"@mealId"})}]).factory("MealHasPropertyHelper",["MealHasProperty","MealProperty",function(e,t){return{getCombined:function(o){var n=t.query(),r=e.queryForMealProperty({mealPropertyId:mealPropertyId});return n.$promise["finally"](function(){r.$promise["finally"](function(){n.forEach(function(e){var t=!1,o=void 0;for(o=0;o<r.length;o++)if(e.MealPropertyId===r[o].MealPropertyId){e.Selected=!0,t=!0;break}t||(e.Selected=!1)})})}),n}}}]),angular.module("BookingSystem.meals",[]).controller("MealsListCtrl",["$rootScope","$scope","$state","Meal",function(e,t,o,n){var r=function(){var o=n.query();o.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Måltider kunde inte hämtas, var god försök igen."}}),t.meals=o};t.$on("$ionicView.enter",function(e,t){r()})}]).controller("MealDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","Meal","MealProperty","MealHasProperty",function(e,t,o,n,r,a,s,i,l){var u="templates/modals/meals-delete.html";t.isEditMode=!1,t.mealBackup={};var c=function(){r.fromTemplateUrl(u,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},m=function(){var n=s.get({mealId:o.mealId});n.$promise.then(function(){n.mealProperties=l.queryForMealProperty({mealPropertyId:o.mealPropertyId})})["catch"](function(){e.FlashMessage={type:"error",message:"Måltid kunde inte hämtas, var god försök igen."}}),t.meal=n},d=function(){t.mealProperties=i.query()};t.startEditMode=function(){var e=this;e.isEditMode=!0,e.mealBackup=angular.copy(e.meal)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.meal=e.mealBackup},t.saveMeal=function(){var t=this;s.save({MealId:o.mealId,Name:t.meal.Name}).$promise.then(function(o){t.endEditMode(),e.FlashMessage={type:"success",message:'Måltiden "'+t.meal.Name+'" sparades med ett lyckat resultat'}})["catch"](function(o){409===o.status?e.FlashMessage={type:"error",message:'Det finns redan en måltid som heter "'+t.meal.Name+'". Två måltider kan inte heta lika.'}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när måltiden skulle sparas"}),404===o.status&&(e.FlashMessage={type:"error",message:'Måltiden "'+t.meal.Name+'" existerar inte längre. Hann kanske någon radera den?'},history.back())})},t.deleteMeal=function(){s["delete"]({mealId:o.mealId}).$promise.then(function(o){e.FlashMessage={type:"success",message:'Måltiden "'+t.meal.Name+'" raderades med ett lyckat resultat'},history.back()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?e.FlashMessage={type:"error",message:"Måltiden kan inte raderas eftersom det finns en lokalbokning eller en lokalmåltid som refererar till måltiden"}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när måltiden skulle tas bort"}),404===o.status&&(e.FlashMessage={type:"error",message:'Måltiden "'+t.meal.Name+'" existerar inte längre. Hann kanske någon radera den?'}),history.back()})},c(),m(),d()}]).controller("MealCreateCtrl",["$rootScope","$stateParams","$scope","$state","Meal",function(e,t,o,n,r){o.meal={},o.saveMeal=function(){var t=this;r.save({MealId:0,Name:t.meal.Name}).$promise.then(function(o){e.FlashMessage={type:"success",message:'Måltiden "'+t.meal.Name+'" skapades med ett lyckat resultat'},history.back()})["catch"](function(o){409===o.status?e.FlashMessage={type:"error",message:'Det finns redan en måltid som heter "'+t.meal.Name+'". Två måltider kan inte heta lika.'}:e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när måltiden skulle sparas"}})}}]),angular.module("BookingSystem.mealPropertiesServices",["ngResource","BookingSystem.mealsServices"]).factory("MealProperty",["$resource","API_URL",function(e,t){return e(t+"MealProperty/:mealPropertyId",{mealPropertyId:"@mealPropertyId"})}]).factory("MealHasProperty",["$resource","API_URL",function(e,t){return e(t+"MealHasProperty/:mealPropertyId/:mealId",{mealPropertyId:"@mealPropertyId"},{remove:{url:t+"MealHasProperty/:mealPropertyId/:mealId",id:"@id",method:"DELETE",isArray:!1,params:{mealPropertyId:"@mealPropertyId",mealId:"@mealId"}},removeForMealProperty:{url:t+"MealHasProperty/:mealPropertyId",id:"@id",method:"DELETE",isArray:!1,params:{mealPropertyId:"@mealPropertyId"}},queryForMealProperty:{url:t+"MealHasProperty/:mealPropertyId",id:"@id",method:"GET",isArray:!0,params:{mealPropertyId:"@mealPropertyId"}},saveForMealProperty:{url:t+"MealHasProperty",id:"@id",method:"POST",isArray:!0}})}]),angular.module("BookingSystem.resourcesServices",["ngResource"]).factory("Resource",["$resource","API_URL",function(e,t){return e(t+"Resource/:resourceId",{resourceId:"@resourceId"})}]),angular.module("BookingSystem.resources",[]).controller("ResourcesListCtrl",["$rootScope","$scope","$state","Resource",function(e,t,o,n){var r=function(){var o=n.query();o.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Resurser kunde inte hämtas, var god försök igen."}}),t.resources=o};t.$on("$ionicView.enter",function(e,t){r()})}]).controller("ResourceDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","Resource",function(e,t,o,n,r,a,s){var i="templates/modals/resources-delete.html";t.isEditMode=!1,t.resourceBackup={};var l=function(){r.fromTemplateUrl(i,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},u=function(){var n=s.get({resourceId:o.resourceId});n.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Resurs kunde inte hämtas, var god försök igen."}}),t.resource=n};t.startEditMode=function(){var e=this;e.isEditMode=!0,e.resourceBackup=angular.copy(e.resource)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.resource=e.resourceBackup},t.saveResource=function(){var t=this;s.save({ResourceId:o.resourceId,Name:t.resource.Name,Count:t.resource.Count,BookingPricePerHour:t.resource.BookingPricePerHour,MinutesMarginAfterBooking:t.resource.MinutesMarginAfterBooking,WeekEndCount:t.resource.WeekEndCount}).$promise.then(function(o){t.endEditMode(),e.FlashMessage={type:"success",message:'Resursen "'+t.resource.Name+'" sparades med ett lyckat resultat'}})["catch"](function(o){409===o.status?e.FlashMessage={type:"error",message:'Det finns redan en resurs som heter "'+t.resource.Name+'". Två resurser kan inte heta lika.'}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när resursen skulle sparas"}),404===o.status&&(e.FlashMessage={type:"error",message:'Resursen "'+t.resource.Name+'" existerar inte längre. Hann kanske någon radera den?'},history.back())})},t.deleteResource=function(){s["delete"]({resourceId:o.resourceId}).$promise.then(function(o){e.FlashMessage={type:"success",message:'Resursen "'+t.resource.Name+'" raderades med ett lyckat resultat'},history.back()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?e.FlashMessage={type:"error",message:"Resursen kan inte raderas eftersom det finns en lokalbokning eller en lokalresurs som refererar till resursen"}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när resursen skulle tas bort"}),404===o.status&&(e.FlashMessage={type:"error",message:'Resursen "'+t.resource.Name+'" existerar inte längre. Hann kanske någon radera den?'}),history.back()})},l(),u()}]).controller("ResourceCreateCtrl",["$rootScope","$stateParams","$scope","$state","Resource",function(e,t,o,n,r){o.resource={},o.saveResource=function(){var t=this;r.save({ResourceId:0,Name:t.resource.Name,Count:t.resource.Count,BookingPricePerHour:t.resource.BookingPricePerHour,MinutesMarginAfterBooking:t.resource.MinutesMarginAfterBooking,WeekEndCount:t.resource.WeekEndCount}).$promise.then(function(o){e.FlashMessage={type:"success",message:'Resursen "'+t.resource.Name+'" skapades med ett lyckat resultat'},history.back()})["catch"](function(o){409===o.status?e.FlashMessage={type:"error",message:'Det finns redan en resurs som heter "'+t.resource.Name+'". Två resurser kan inte heta lika.'}:e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när resursen skulle sparas"}})}}]),angular.module("BookingSystem.locationBooking",["ngMessages"]).controller("LocationBookingViewCtrl",["$rootScope","$scope","$state","LocationBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture",function(e,t,o,n,r,a,s){var i=a,l=null;t.weekDate=moment(),t.zoom=2;var u=function(){var o=n.query();o.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Lokalbokningar kunde inte hämtas, var god försök igen."}}).then(function(e){t.locationBookings=e})},c=function(){l=r(function(){u()},i)};t.$on("$ionicView.enter",function(e,t){u(),c()}),t.$on("$ionicView.leave",function(e){l&&r.cancel(l),t.$broadcast("leaving-view")});var m=angular.element(document.querySelector("#booking-view-content"));s.on("pinch",function(e){e.gesture.srcEvent.preventDefault(),t.$apply(function(){t.zoom=e.gesture.scale})},m)}]).controller("LocationBookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","LocationBooking",function(e,t,o,n,r,a,s){var i="templates/modals/locationBooking-delete.html";t.editMode=!1,t.locationBookingBackup={};var l=function(){a.fromTemplateUrl(i,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},u=function(){var n=s.get({locationBookingId:o.locationBookingId});n.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Möblering kunde inte hämtas, var god försök igen."}}),t.locationBooking=n};t.startEditMode=function(){var e=this;e.isEditMode=!0,e.locationBookingBackup=angular.copy(e.locationBooking)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.locationBooking=e.locationBookingBackup},t.saveLocationBooking=function(){var t=this;s.save({LocationBookingId:o.locationBookingId,Name:t.locationBooking.Name}).$promise.then(function(o){t.endEditMode(),e.FlashMessage={type:"success",message:'Möbleringen "'+t.locationBooking.Name+'" sparades med ett lyckat resultat'}})["catch"](function(o){409===o.status?e.FlashMessage={type:"error",message:'Det finns redan en möblering som heter "'+t.locationBooking.Name+'". Två möbleringar kan inte heta lika.'}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när möbleringen skulle sparas"}),404===o.status&&(e.FlashMessage={type:"error",message:'Möbleringen "'+t.locationBooking.Name+'" existerar inte längre. Hann kanske någon radera den?'},history.back())})},t.deleteLocationBooking=function(){s["delete"]({locationBookingId:o.locationBookingId}).$promise.then(function(o){e.FlashMessage={type:"success",message:'Möbleringen "'+t.locationBooking.Name+'" raderades med ett lyckat resultat'},history.back()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?e.FlashMessage={type:"error",message:"Möbleringen kan inte raderas eftersom det finns en lokalbokning eller en lokalmöblering som refererar till möbleringen"}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när möbleringen skulle tas bort"}),404===o.status&&(e.FlashMessage={type:"error",message:'Möbleringen "'+t.locationBooking.Name+'" existerar inte längre. Hann kanske någon radera den?'}),history.back()})},l(),u()}]).controller("LocationBookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","LocationBooking","Location","BookingHelper","LocationFurnituring","Customer","$q",function(e,t,o,n,r,a,s,i,l,u){o.locationBooking={Provisional:!0,BookingTypeId:1},o.furnituring=[];var c=function(){n.params.date?(o.bookingStartDate=moment(n.params.date).toDate(),o.bookingStartHour=moment(n.params.date).hour(),o.bookingStartMinute=moment(n.params.date).minute(),o.bookingEndDate=moment(n.params.date).toDate(),o.bookingEndHour=moment(n.params.date).hour(),o.bookingEndMinute=moment(n.params.date).add(59,"minutes").minute()):(o.bookingStartDate=new Date,o.bookingStartHour=8,o.bookingStartMinute=0,o.bookingEndDate=new Date,o.bookingEndHour=8,o.bookingEndMinute=59)},m=function(){return"undefined"!=typeof o.bookingStartDate&&"undefined"!=typeof o.bookingStartHour&&"undefined"!=typeof o.bookingStartMinute&&"undefined"!=typeof o.bookingEndDate&&"undefined"!=typeof o.bookingEndHour&&"undefined"!=typeof o.bookingEndMinute},d=function(){o.selectHours=s.getHoursForSelect(),o.selectMinutes=s.getMinutesForSelect()},g=function(){if(o.locations=a.query(),m()){var t=k(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute),n=k(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute);a.queryFreeForPeriod({fromDate:t.format("YYYY-MM-DD"),fromTime:t.format("HH:mm"),toDate:n.format("YYYY-MM-DD"),toTime:n.format("HH:mm")}).$promise.then(function(e){o.locations=e})["catch"](function(t){e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när uppgifter om lediga lokaler skulle hämtas"}})}},p=function(){o.customers=l.query()},k=function(e,t,o){return moment(e).hour(t).minute(o)},f=function(){var t=u.defer();return s.createBookingContainer(o.locationBooking).then(function(e){o.locationBooking.BookingId=e.BookingId,t.resolve()})["catch"](function(o){e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när bokningstillfället skulle sparas"},t.reject()}),t.promise};o.updateFurniturings=function(){o.locationBooking.LocationId?(o.furniturings=i.queryForLocation({locationId:o.locationBooking.LocationId}),o.furniturings.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Möbleringar för vald lokal kunde inte hämtas."}}).then(function(){})):o.furnituring=[]},o.checkEndDate=function(){if(m()){var e=k(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute).toDate().getTime(),t=k(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute).toDate().getTime();e>t&&(o.bookingEndDate=o.bookingStartDate,o.bookingEndHour=o.bookingStartHour,o.bookingEndMinute=o.bookingStartMinute+15),g()}},o.saveLocationBooking=function(){var t=this,o=u.defer(),n=o.promise;return f().then(function(){var n=t.locationBooking.SelectedFurnituring?t.locationBooking.SelectedFurnituring.FurnituringId:null;r.save({BookingId:t.locationBooking.BookingId,LocationBookingId:0,LocationId:t.locationBooking.LocationId,FurnituringId:n,StartTime:k(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute).format(),EndTime:k(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute).format(),NumberOfPeople:t.locationBooking.NumberOfPeople}).$promise.then(function(t){e.FlashMessage={type:"success",message:"Lokal/plats-bokningen skapades med ett lyckat resultat"},o.resolve()})["catch"](function(t){409===t.status?e.FlashMessage={type:"error",message:"Lokalen är tyvärr redan bokad under vald tidsram."}:e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när lokal/plats-bokningen skulle sparas"}})}),n},c(),g(),p(),d()}]),angular.module("BookingSystem.locationBookingServices",["ngResource"]).factory("LocationBooking",["$resource","API_URL",function(e,t){return e(t+"LocationBooking/:locationBookingId",{locationBookingId:"@locationBookingId"})}]),angular.module("BookingSystem.calendarWeekDirective",[]).controller("CalendarWeekCtrl",["$rootScope","$scope","$state","LocationBooking","BookingHelper",function(e,t,o,n,r){t.days=[],t.weekDateStart=moment(t.date).startOf("isoWeek");var a=function(e,t,o){return r.doBookingsCollide(o.StartTime,o.EndTime,e,t)},s=function(e){var o=void 0;for(o=0;7>o;o++){var n=moment(t.days[o].date),r=moment(n).endOf("day"),s=t.bookings.filter(a.bind(null,n,r));t.days[o].bookings=[],s.forEach(function(e){t.days[o].bookings.push(JSON.parse(JSON.stringify(e)))})}},i=function(){for(var e=0,o=moment(t.weekDateStart);7>e;o.add(1,"days"))t.days[e]={},t.days[e].date=o.format(),e++},l=function(e){t.$broadcast("hideAllAddButtons",!0)};t.hideAddButtons=function(e){l()},i(),t.$watch("bookings",function(e){void 0!==e&&s()})}]).directive("calendarWeek",[function(){return{restrict:"E",replace:!0,templateUrl:function(e,t){return"templates/directives/calendar-week.html"},scope:{date:"=",bookings:"=",bookingsType:"=",zoom:"="},link:function(e,t,o){},controller:"CalendarWeekCtrl"}}]),angular.module("BookingSystem.calendarDayDirective",[]).controller("CalendarDayCtrl",["$scope","$element","$attrs","$rootScope","$location","$q","$state","BookingHelper","$interval",function(e,t,o,n,r,a,s,i,l){var u=moment(e.date),c=6e4,m=200,d=35,g=null;e.dayNumber=u.format("D"),e.dayName=u.format("ddd"),e.visibleAddButtonHour=null,e.columnHeight=35*e.zoom;var p=function(){var t=void 0,o=24;for(e.hoursArray=[],t=0;o>t;t++)e.hoursArray.push(t)},k=function(e,t){return Number(e)+Number(t/60)},f=function(){var t=e.columnHeight+35*(e.zoom-1);console.log("setColumnHeight",t,e.columnHeight),m>t&&t>d&&(e.columnHeight=t)},y=function(){if(e.isCurrentDay=moment().format("YYYY-MM-DD")===u.format("YYYY-MM-DD"),e.isCurrentDay){var t=moment(),o=t.format("H"),n=t.format("mm");e.currentHour=k(o,n)}},h=function(){e.isCurrentDay&&(g=l(function(){y()},c))},v=function(e){var t=moment(e.EndTime).startOf("day"),o=moment(e.StartTime).format("H"),n=moment(e.StartTime).format("mm");return u.date()!==moment(e.StartTime).date()&&moment(e.StartTime).isBefore(t)?0:k(o,n)},M=function(e){return moment(e.EndTime).isAfter(moment(u).endOf("day"))?23.99:Number(moment(e.EndTime).format("H"))+Number(moment(e.EndTime).format("mm")/60)},b=function(){void 0!==e.bookings&&e.bookings.forEach(function(t){t.StartHour=v(t),t.EndHour=M(t),t.Duration=t.EndHour-t.StartHour,i.setConcurrentBookingData(t,e.bookings)})};e.showAddHour=function(t){e.hideAllAddButtonsCallback(),e.visibleAddButtonHour=t},e.hideAddButton=function(){e.visibleAddButtonHour=null},e.createEventForHour=function(e){u.set({hour:e}),s.go("app.location-booking-create",{date:u,locationId:null})},p(),y(),h(),e.$on("hideAllAddButtons",function(t,o){e.hideAddButton()}),e.$watch("bookings",function(e,t){Array.isArray(e)&&b()}),e.$watch("zoom",function(e,t){f()}),e.$on("leaving-view",function(e){null!==g&&l.cancel(g)})}]).directive("calendarDay",[function(){return{restrict:"E",replace:!0,templateUrl:function(e,t){return"templates/directives/calendar-day.html"},scope:{date:"=",hideAllAddButtonsCallback:"&",hideAddButton:"=",bookings:"=",bookingsType:"=",zoom:"="},link:function(e,t,o){},controller:"CalendarDayCtrl"}}]).controller("CalendarTimeCtrl",["$scope",function(e){e.weekNumber=moment(e.date).isoWeek(),e.columnHeight=35*e.zoom;var t=200,o=35,n=function(){var n=e.columnHeight+35*(e.zoom-1);t>n&&n>o&&(e.columnHeight=n)},r=function(){var t=void 0,o=24;for(e.hoursArray=[],t=1;o>t;t++)e.hoursArray.push(t)};r(),e.$watch("zoom",function(e,t){n()})}]).directive("calendarTime",[function(){return{restrict:"E",replace:!0,scope:{date:"=",zoom:"="},templateUrl:function(e,t){return"templates/directives/calendar-time.html"},controller:"CalendarTimeCtrl"}}]).filter("digits",function(){return function(e){return 10>e&&(e="0"+e),e}}),angular.module("BookingSystem.customersServices",["ngResource"]).factory("Customer",["$resource","API_URL",function(e,t){return e(t+"Customer/:customerId",{customerId:"@customerId"})}]).factory("CustomerImage",["$http","API_URL",function(e,t){return{upload:function(o,n){return e({method:"POST",url:t+"Customer/image/"+n,data:o,headers:{"Content-Type":void 0}})}}}]),angular.module("BookingSystem.customers",[]).controller("CustomersListCtrl",["$rootScope","$scope","$state","Customer",function(e,t,o,n){var r=function(){var o=n.query();o.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Kunder kunde inte hämtas, var god försök igen."}}),t.customers=o};t.$on("$ionicView.enter",function(e,t){r()})}]).controller("CustomerDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","Customer","CustomerImage","API_IMG_PATH_URL",function(e,t,o,n,r,a,s,i,l){var u="templates/modals/customers-delete.html";t.isEditMode=!1,t.customerBackup={},t.API_IMG_PATH_URL=l;var c=function(){r.fromTemplateUrl(u,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},m=function(e){return i.upload(t.customer.ImageForUpload,e)},d=function(){e.FlashMessage={type:"success",message:'Kunden "'+t.customer.Name+'" sparades med ett lyckat resultat'},history.back()},g=function(){var n=s.get({customerId:o.customerId});n.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Kunden kunde inte hämtas, var god försök igen."}}),t.customer=n};t.startEditMode=function(){var e=this;e.isEditMode=!0,e.customerBackup=angular.copy(e.customer)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.customer=e.customerBackup},t.saveCustomer=function(){var t=this;s.save({CustomerId:o.customerId,Name:t.customer.Name,Address:t.customer.Address,PostNumber:t.customer.PostNumber,City:t.customer.City,EmailAddress:t.customer.EmailAddress,PhoneNumber:t.customer.PhoneNumber,
CellPhoneNumber:t.customer.CellPhoneNumber,ParentCustomerId:t.customer.ParentCustomerId,ImageSrc:t.customer.ImageSrc,Notes:t.customer.Notes}).$promise.then(function(o){t.endEditMode(),"undefined"!=typeof t.customer.ImageForUpload?m(o.CustomerId).success(function(){d()}).error(function(){e.FlashMessage={type:"error",message:"Kunden sparades, men det gick inte att ladda upp och spara den önskade bilden."}}):d()})["catch"](function(o){409===o.status?e.FlashMessage={type:"error",message:'Det finns redan en kund som heter "'+t.customer.Name+'". Två kunder kan inte heta lika.'}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när kunden skulle sparas"}),404===o.status&&(e.FlashMessage={type:"error",message:'Kunden "'+t.customer.Name+'" existerar inte längre. Hann kanske någon radera den?'},history.back())})},t.deleteCustomer=function(){s["delete"]({customerId:o.customerId}).$promise.then(function(o){e.FlashMessage={type:"success",message:'Kunden "'+t.customer.Name+'" raderades med ett lyckat resultat'},history.back()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?e.FlashMessage={type:"error",message:"Kunden kan inte raderas eftersom det finns en bokning som refererar till kunden"}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när kunden skulle tas bort"}),404===o.status&&(e.FlashMessage={type:"error",message:'Kunden "'+t.customer.Name+'" existerar inte längre. Hann kanske någon radera den?'}),history.back()})},c(),g()}]).controller("CustomerCreateCtrl",["$rootScope","$stateParams","$scope","$state","Customer","CustomerImage",function(e,t,o,n,r,a){o.customer={},console.log(API_IMG_PATH_URL);var s=function(e){return a.upload(o.customer.ImageForUpload,e)},i=function(){e.FlashMessage={type:"success",message:'Kunden "'+o.customer.Name+'" sparades med ett lyckat resultat'},history.back()};o.saveCustomer=function(){var t=this;r.save({CustomerId:0,Name:t.customer.Name,Address:t.customer.Address,PostNumber:t.customer.PostNumber,City:t.customer.City,EmailAddress:t.customer.EmailAddress,PhoneNumber:t.customer.PhoneNumber,CellPhoneNumber:t.customer.CellPhoneNumber,ParentCustomerId:t.customer.ParentCustomerId,ImageSrc:t.customer.ImageSrc,Notes:t.customer.Notes}).$promise.then(function(o){"undefined"!=typeof t.customer.ImageForUpload?s(o.CustomerId).success(function(e){i()}).error(function(){e.FlashMessage={type:"error",message:'Kunden "'+t.customer.Name+'" skapades, men det gick inte att ladda upp och spara den önskade bilden.'},history.back()}):i()})["catch"](function(o){409===o.status?e.FlashMessage={type:"error",message:'Det finns redan en kund som heter "'+t.customer.Name+'". Två kunder kan inte heta lika.'}:e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när kunden skulle sparas"}})}}]),angular.module("BookingSystem.bookingTypesServices",["ngResource"]).factory("BookingType",["$resource","API_URL",function(e,t){return e(t+"BookingType/:bookingTypeId",{bookingTypeId:"@bookingTypeId"})}]),angular.module("BookingSystem.bookingTypes",[]).controller("BookingTypesListCtrl",["$rootScope","$scope","$state","BookingType",function(e,t,o,n){var r=function(){var o=n.query();o.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Bokningstyper kunde inte hämtas, var god försök igen."}}),t.bookingTypes=o};t.$on("$ionicView.enter",function(e,t){r()})}]).controller("BookingTypeDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","BookingType",function(e,t,o,n,r,a,s){var i="templates/modals/bookingtypes-delete.html";t.isEditMode=!1,t.bookingTypeBackup={};var l=function(){r.fromTemplateUrl(i,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},u=function(){var n=s.get({bookingTypeId:o.bookingTypeId});n.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Bokningstypen kunde inte hämtas, var god försök igen."}}),t.bookingType=n};t.toggleHasLocation=function(){var e=this;console.log(e.bookingType.HasLocation),e.bookingType.HasLocation===!0?e.bookingType.HasLocation=!1:e.bookingType.HasLocation=!0},t.startEditMode=function(){var e=this;e.isEditMode=!0,e.bookingTypeBackup=angular.copy(e.bookingType)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.bookingType=e.bookingTypeBackup},t.saveBookingType=function(){var t=this;s.save({BookingTypeId:o.bookingTypeId,Name:t.bookingType.Name}).$promise.then(function(o){t.endEditMode(),e.FlashMessage={type:"success",message:'Bokningstypen "'+t.bookingType.Name+'" sparades med ett lyckat resultat'}})["catch"](function(o){409===o.status?e.FlashMessage={type:"error",message:'Det finns redan en bokningstyp som heter "'+t.bookingType.Name+'". Två boknigstyper kan inte heta lika.'}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när bokningstypen skulle sparas"}),404===o.status&&(e.FlashMessage={type:"error",message:'Bokningstypen "'+t.bookingType.Name+'" existerar inte längre. Hann kanske någon radera den?'},history.back())})},t.deleteBookingType=function(){s["delete"]({bookingTypeId:o.bookingTypeId}).$promise.then(function(o){e.FlashMessage={type:"success",message:'Bokningstypen "'+t.bookingType.Name+'" raderades med ett lyckat resultat'},history.back()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?e.FlashMessage={type:"error",message:"Bokningstypen kan inte raderas eftersom det finns en bokning som refererar till bokningstypen"}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när bokningstypen skulle tas bort"}),404===o.status&&(e.FlashMessage={type:"error",message:'Bokningstypen "'+t.bookingType.Name+'" existerar inte längre. Hann kanske någon radera den?'}),history.back()})},l(),u()}]).controller("BookingTypeCreateCtrl",["$rootScope","$stateParams","$scope","$state","BookingType",function(e,t,o,n,r){o.bookingType={},o.bookingType.HasLocation=!1,o.toggleHasLocation=function(){var e=this;e.bookingType.HasLocation===!0?e.bookingType.HasLocation=!1:e.bookingType.HasLocation=!0},o.saveBookingType=function(){var t=this;r.save({BookingTypeId:0,Name:t.bookingType.Name,HasLocation:t.bookingType.HasLocation,MinutesMarginBeforeBooking:t.bookingType.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:t.bookingType.MinutesMarginAfterBooking}).$promise.then(function(o){e.FlashMessage={type:"success",message:'Bokningstypen "'+t.bookingType.Name+'" skapades med ett lyckat resultat'},history.back()})["catch"](function(o){409===o.status?e.FlashMessage={type:"error",message:'Det finns redan en bokningstyp som heter "'+t.bookingType.Name+'". Två bokningstyper kan inte heta lika.'}:e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när bokningstypen skulle sparas"}})}}]),angular.module("BookingSystem.bookingHelperServices",[]).factory("BookingHelper",["$q","Booking",function(e,t){var o=function(e,t,o,n){return e=moment(e),t=moment(t),o=moment(o),n=moment(n),e.isBefore(n)&&t.isAfter(n)||e.isBefore(o)&&t.isAfter(o)||e.isSameOrAfter(o)&&t.isSameOrBefore(n)},n=function(e,t){var n=[],r=0,a=void 0;for(a=0;a<t.length;a++)o(e.StartTime,e.EndTime,t[a].StartTime,t[a].EndTime)&&n.push(t[a]);e.ConcurrentBookings=n.length,n.length&&(n.sort(function(e,t){return e.StartTime>=t.StartTime&&e.EndTime<=t.EndTime}),r=n.findIndex(function(t){return e.LocationBookingId===t.LocationBookingId})),e.ConcurrentBookingIndex=r},r=function(){for(var e=[],t=0;23>=t;t++)e.push(t);return e},a=function(){for(var e=[],t=0;59>=t;t++)e.push(t);return e},s=function(e){return t.save({BookingId:0,Name:"",BookingTypeId:e.BookingTypeId,CustomerId:e.CustomerId,Provisional:1,NumberOfPeople:e.NumberOfPeople,Discount:0,CreatedByUserId:1,ModifiedByUserId:1,ResponsibleUserId:1}).$promise};return{doBookingsCollide:o,setConcurrentBookingData:n,getHoursForSelect:r,getMinutesForSelect:a,createBookingContainer:s}}]),angular.module("BookingSystem.imageResizeServices",[]).factory("ImageResize",["UPLOAD_IMG_MAX_WIDTH","UPLOAD_IMG_MAX_HEIGHT","$q",function(e,t,o){var n=void 0,r=void 0,a=void 0,s=void 0,i=function(e){var t=document.createElement("canvas");return t.width=e.width/2,t.height=e.height/2,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t},l=function(e,t,o){function n(e,t,o,n,r,a){var s=1-r,i=1-a;return e*s*i+t*r*i+o*s*a+n*r*a}var r=void 0,a=void 0,s=void 0,i=void 0,l=void 0,u=void 0,c=void 0,m=void 0,d=void 0,g=void 0,p=void 0,k=void 0,f=void 0,y=void 0,h=void 0,v=void 0,M=void 0,b=void 0,B=void 0;for(r=0;r<t.height;++r)for(s=r/o,i=Math.floor(s),l=Math.ceil(s)>e.height-1?e.height-1:Math.ceil(s),a=0;a<t.width;++a)u=a/o,c=Math.floor(u),m=Math.ceil(u)>e.width-1?e.width-1:Math.ceil(u),d=4*(a+t.width*r),g=4*(c+e.width*i),p=4*(m+e.width*i),k=4*(c+e.width*l),f=4*(m+e.width*l),y=u-c,h=s-i,v=n(e.data[g],e.data[p],e.data[k],e.data[f],y,h),t.data[d]=v,M=n(e.data[g+1],e.data[p+1],e.data[k+1],e.data[f+1],y,h),t.data[d+1]=M,b=n(e.data[g+2],e.data[p+2],e.data[k+2],e.data[f+2],y,h),t.data[d+2]=b,B=n(e.data[g+3],e.data[p+3],e.data[k+3],e.data[f+3],y,h),t.data[d+3]=B},u=function(t){var o=document.createElement("canvas"),n=e/t.width;o.width=t.width*n,o.height=t.height*n;var r=t.getContext("2d").getImageData(0,0,t.width,t.height),a=o.getContext("2d").createImageData(o.width,o.height);return l(r,a,n),o.getContext("2d").putImageData(a,0,0),o};return{scaleImage:function(t){return n=document.createElement("img"),r=document.createElement("canvas"),a=o.defer(),n.src=t,n.onload=function(){for(r.width=n.width,r.height=n.height,r.getContext("2d").drawImage(n,0,0,r.width,r.height);r.width>=2*e;)r=i(r);r.width>e&&(r=u(r)),s=r.toDataURL("image/jpeg",1),a.resolve(s)},a.promise}}}]),angular.module("BookingSystem.imageUploaderDirective",["BookingSystem.imageResizeServices"]).controller("imageUploaderCtrl",["$scope","$q","$element","$attrs","$rootScope","CustomerImage","ImageResize","API_IMG_PATH_URL","PHOTO_MISSING_SRC",function(e,t,o,n,r,a,s,i,l){e.file="",e.progress=0,e.isProgressVisible=!1;var u=function(t,o){return function(){e.$apply(function(){s.scaleImage(t.result).then(function(t){e.displayImageSrc=t,e.base64EncodedImage=t.replace(/^data:image\/jpeg;base64,/,""),o.resolve()})})}},c=function(t,o){return function(){e.$apply(function(){o.reject(t.result)})}},m=function(e){return function(e){}},d=function(e){var t=!1;return"image/png"!==e.type&&"image/jpg"!==e.type&&"image/jpeg"!==e.type&&"image/gif"!==e.type||e.size<1e7&&(t=!0),t};e.$watch("imageSrc",function(t,o){"undefined"!=typeof t&&""!==t?e.displayImageSrc=i+t+"?"+Date.now():e.displayImageSrc=l}),e.readUploadedFile=function(e){var o=t.defer(),n=new FileReader,a=null;return d(e)?(n.onload=u(n,o),n.onerror=c(n,o),n.onprogress=m(n),n.readAsDataURL(e),a=o.promise):(r.FlashMessage={type:"error",message:"Den uppladdade bilden måste vara av typen: jpg, gif eller png och får inte överstiga 10mb i storlek"},o.reject(),a=o.promise),a}}]).directive("imageUploader",["$http",function(e){return{restrict:"E",link:function(e,t,o){},scope:{imageSrc:"=imageSrc",base64EncodedImage:"=base64EncodedImage"},replace:!0,templateUrl:"templates/directives/image-uploader-directive.html",controller:"imageUploaderCtrl"}}]).directive("imageUploaderFile",function(){return{restrict:"A",replace:!1,scope:!1,controller:["$scope","$element","$attrs",function(e,t,o){t.bind("change",function(t){var o=(t.srcElement||t.target).files[0];e.readUploadedFile(o)})}]}}),angular.module("BookingSystem.locationsServices",["ngResource"]).factory("Location",["$resource","API_URL",function(e,t){return e(t+"Location/:locationId",{locationId:"@locationId"},{queryFreeForPeriod:{url:t+"Location/free/:fromDate/:toDate",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},querySearch:{url:t+"Location/search/:column",id:"@id",method:"GET",isArray:!0,params:{column:"@column"}}})}]),angular.module("BookingSystem.filters",[]).filter("zpad",[function(){return function(e,t){if(void 0===e&&(e=""),e.length>=t)return e;var o="0".repeat(t);return(o+e).slice(-1*t)}}]),function(){var e=function(e){return angular.isUndefined(e)||""===e||null===e||void 0===e};angular.module("BookingSystem.ngMinMaxDirectives",[]).directive("ngMin",function(){return{restrict:"A",require:"ngModel",link:function(t,o,n,r){t.$watch(n.ngMin,function(){r.$setViewValue(r.$viewValue)});var a=function(o){var a=t.$eval(n.ngMin)||0;return!e(o)&&a>o?void r.$setValidity("ngMin",!1):(r.$setValidity("ngMin",!0),o)};r.$parsers.push(a),r.$formatters.push(a)}}}).directive("ngMax",function(){return{restrict:"A",require:"ngModel",link:function(t,o,n,r){t.$watch(n.ngMax,function(){r.$setViewValue(r.$viewValue)});var a=function(o){var a=t.$eval(n.ngMax)||1/0;return!e(o)&&o>a?void r.$setValidity("ngMax",!1):(r.$setValidity("ngMax",!0),o)};r.$parsers.push(a),r.$formatters.push(a)}}})}(),angular.module("BookingSystem.bookingServices",["ngResource"]).factory("Booking",["$resource","API_URL",function(e,t){return e(t+"Booking/:bookingId",{bookingId:"@bookingId"},{queryLessForPeriod:{url:t+"Booking/period/:fromDate/:toDate/less",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},queryMoreForPeriod:{url:t+"Booking/period/:fromDate/:toDate/more",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},countEmpty:{url:t+"Booking/empty/count",id:"@id",method:"GET",isArray:!1},queryEmpty:{url:t+"Booking/empty/info",id:"@id",method:"GET",isArray:!0},querySearch:{url:t+"Booking/search/:column",id:"@id",method:"GET",isArray:!0,params:{column:"@column"}}})}]),angular.module("BookingSystem.bookings",[]).controller("BookingListCtrl",["$rootScope","$scope","$state","Booking",function(e,t,o,n){var r=function(){var o=n.query();o.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Bokningstillfällen kunde inte hämtas, var god försök igen."}}),t.bookings=o};t.$on("$ionicView.enter",function(e,t){r()})}]).controller("BookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","Booking",function(e,t,o,n,r,a,s){var i="templates/modals/booking-delete.html";t.editMode=!1,t.bookingBackup={};var l=function(){a.fromTemplateUrl(i,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},u=function(){var n=s.get({bookingId:o.bookingId});n.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Bokningstillfälle kunde inte hämtas, var god försök igen."}}),t.booking=n};t.startEditMode=function(){var e=this;e.isEditMode=!0,e.bookingBackup=angular.copy(e.booking)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.booking=e.bookingBackup},t.saveBooking=function(){var t=this;s.save({BookingId:o.bookingId,Name:t.booking.Name}).$promise.then(function(o){t.endEditMode(),e.FlashMessage={type:"success",message:'Bokningstillfället "'+t.booking.Name+'" sparades med ett lyckat resultat'}})["catch"](function(o){409===o.status?e.FlashMessage={type:"error",message:'Det finns redan ett bokningstillfälle som heter "'+t.booking.Name+'". Två bokningstillfällen kan inte heta lika.'}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när bokningstillfället skulle sparas"}),404===o.status&&(e.FlashMessage={type:"error",message:'Bokningstillfället "'+t.booking.Name+'" existerar inte längre. Hann kanske någon radera den?'},history.back())})},t.deleteBooking=function(){s["delete"]({bookingId:o.bookingId}).$promise.then(function(o){e.FlashMessage={type:"success",message:'Bokningstillfället "'+t.booking.Name+'" raderades med ett lyckat resultat'},history.back()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?e.FlashMessage={type:"error",message:"Bokningstillfället kan inte raderas eftersom det finns en lokalbokning, resursbokning eller en måltidsbokning som refererar till bokningstillfället"}:400!==o.status&&500!==o.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när bokningstillfället skulle tas bort"}),404===o.status&&(e.FlashMessage={type:"error",message:'Bokningstillfället "'+t.booking.Name+'" existerar inte längre. Hann kanske någon radera den?'}),history.back()})},l(),u()}]).controller("BookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","Booking",function(e,t,o,n,r){o.booking={},o.saveBooking=function(){var t=this;r.save({BookingId:0,Name:t.booking.Name}).$promise.then(function(o){e.FlashMessage={type:"success",message:'Bokningstillfället "'+t.booking.Name+'" skapades med ett lyckat resultat'},history.back()})["catch"](function(o){409===o.status?e.FlashMessage={type:"error",message:'Det finns redan ett bokningstillfälle som heter "'+t.booking.Name+'". Två bokningstillfällen kan inte heta lika.'}:e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när bokningstillfället skulle sparas"}})}}]);