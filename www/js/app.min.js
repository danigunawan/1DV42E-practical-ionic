"use strict";var BookingSystem=angular.module("BookingSystem",["ionic","BookingSystem.controllers","BookingSystem.furnituring","BookingSystem.furnituringServices","BookingSystem.meals","BookingSystem.mealsServices","BookingSystem.mealPropertiesServices","BookingSystem.resources","BookingSystem.resourcesServices","BookingSystem.locationBooking","BookingSystem.locationBookingServices","BookingSystem.locations","BookingSystem.locationsServices","BookingSystem.calendarDayDirective","BookingSystem.customers","BookingSystem.customersServices","BookingSystem.bookingTypes","BookingSystem.bookingTypesServices","BookingSystem.imageResizeServices","BookingSystem.calendarWeekDirective","BookingSystem.bookingHelperServices","BookingSystem.imageUploaderDirective","BookingSystem.locationsServices","BookingSystem.ngMinMaxDirectives","BookingSystem.filters","BookingSystem.bookingServices","BookingSystem.resourceBooking","BookingSystem.resourceBookingServices","BookingSystem.calendarDaysHeaderDirective","BookingSystem.start","BookingSystem.mealBookingServices","BookingSystem.mealBooking","BookingSystem.bookings","ngMaterial","ngResource","ngMessages"]);BookingSystem.run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()}),moment.locale("sv")}]),BookingSystem.constant("API_URL","http://localhost:6796/api/"),BookingSystem.constant("API_IMG_PATH_URL","http://bokning.vvfors.se/"),BookingSystem.constant("UPLOAD_IMG_MAX_WIDTH","400"),BookingSystem.constant("UPLOAD_IMG_MAX_HEIGHT","400"),BookingSystem.constant("PHOTO_MISSING_SRC","img/photo_missing.svg"),BookingSystem.constant("DEFAULT_MAP_ZOOM",5),BookingSystem.constant("DEFAULT_LATITUDE",59.2792),BookingSystem.constant("DEFAULT_LONGITUDE",15.2361),BookingSystem.constant("MODAL_ANIMATION","slide-in-up"),BookingSystem.constant("DATA_SYNC_INTERVAL_TIME",3e5),BookingSystem.constant("DEFAULT_CALENDAR_ZOOM",2),BookingSystem.config(["$stateProvider","$urlRouterProvider","$mdDateLocaleProvider",function(e,o,t){e.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html",controller:"AppCtrl"}).state("app.start",{url:"/start",params:{bookingType:"booking"},views:{menuContent:{templateUrl:"templates/start/start.html",controller:"StartViewCtrl"}}}).state("app.booking-details",{url:"/booking-details",params:{id:null},views:{menuContent:{templateUrl:"templates/booking/booking-details.html",controller:"BookingDetailsCtrl"}}}).state("app.meal-booking-view",{url:"/meal-booking-view",views:{menuContent:{templateUrl:"templates/meal-booking/meal-booking-view.html",controller:"MealBookingViewCtrl"}}}).state("app.meal-booking-details",{url:"/meal-booking-details",params:{id:null},views:{menuContent:{templateUrl:"templates/meal-booking/meal-booking-details.html",controller:"MealBookingDetailsCtrl"}}}).state("app.meal-booking-create",{url:"/meal-booking-create",params:{date:null,locationId:null},views:{menuContent:{templateUrl:"templates/meal-booking/meal-booking-create.html",controller:"MealBookingCreateCtrl"}}}).state("app.resource-booking-view",{url:"/resource-booking-view",views:{menuContent:{templateUrl:"templates/resource-booking/resource-booking-view.html",controller:"ResourceBookingViewCtrl"}}}).state("app.resource-booking-details",{url:"/resource-booking-details",params:{id:null},views:{menuContent:{templateUrl:"templates/resource-booking/resource-booking-details.html",controller:"ResourceBookingDetailsCtrl"}}}).state("app.resource-booking-create",{url:"/resource-booking-create",params:{date:null,locationId:null},views:{menuContent:{templateUrl:"templates/resource-booking/resource-booking-create.html",controller:"ResourceBookingCreateCtrl"}}}).state("app.location-booking-view",{url:"/location-booking-view",views:{menuContent:{templateUrl:"templates/location-booking/location-booking-view.html",controller:"LocationBookingViewCtrl"}}}).state("app.location-booking-details",{url:"/location-booking-details",params:{id:null},views:{menuContent:{templateUrl:"templates/location-booking/location-booking-details.html",controller:"LocationBookingDetailsCtrl"}}}).state("app.location-booking-create",{url:"/location-booking-create",params:{date:null,locationId:null},views:{menuContent:{templateUrl:"templates/location-booking/location-booking-create.html",controller:"LocationBookingCreateCtrl"}}}).state("app.furnituring-list",{url:"/furnituring-list",views:{menuContent:{templateUrl:"templates/furnituring/furnituring-list.html",controller:"FurnituringListCtrl"}}}).state("app.furnituring-details",{url:"/furnituring-details/:furnituringId",views:{menuContent:{templateUrl:"templates/furnituring/furnituring-details.html",controller:"FurnituringDetailsCtrl"}}}).state("app.furnituring-create",{url:"/furnituring-create",views:{menuContent:{templateUrl:"templates/furnituring/furnituring-create.html",controller:"FurnituringCreateCtrl"}}}).state("app.meals-list",{url:"/meals-list",views:{menuContent:{templateUrl:"templates/meals/meals-list.html",controller:"MealsListCtrl"}}}).state("app.meal-details",{url:"/meal-details/:mealId",views:{menuContent:{templateUrl:"templates/meals/meal-details.html",controller:"MealDetailsCtrl"}}}).state("app.meal-create",{url:"/meal-create",views:{menuContent:{templateUrl:"templates/meals/meal-create.html",controller:"MealCreateCtrl"}}}).state("app.resources-list",{url:"/resources-list",views:{menuContent:{templateUrl:"templates/resources/resources-list.html",controller:"ResourcesListCtrl"}}}).state("app.resource-details",{url:"/resource-details/:resourceId",views:{menuContent:{templateUrl:"templates/resources/resource-details.html",controller:"ResourceDetailsCtrl"}}}).state("app.resource-create",{url:"/resource-create",views:{menuContent:{templateUrl:"templates/resources/resource-create.html",controller:"ResourceCreateCtrl"}}}).state("app.customers-list",{url:"/customers-list",views:{menuContent:{templateUrl:"templates/customers/customers-list.html",controller:"CustomersListCtrl"}}}).state("app.customer-details",{url:"/customer-details/:customerId",views:{menuContent:{templateUrl:"templates/customers/customer-details.html",controller:"CustomerDetailsCtrl"}}}).state("app.customer-create",{url:"/customer-create",views:{menuContent:{templateUrl:"templates/customers/customer-create.html",controller:"CustomerCreateCtrl"}}}).state("app.bookingtypes-list",{url:"/bookingtypes-list",views:{menuContent:{templateUrl:"templates/bookingtypes/bookingtypes-list.html",controller:"BookingTypesListCtrl"}}}).state("app.bookingtype-details",{url:"/bookingtype-details/:bookingTypeId",views:{menuContent:{templateUrl:"templates/bookingtypes/bookingtype-details.html",controller:"BookingTypeDetailsCtrl"}}}).state("app.bookingtype-create",{url:"/bookingtype-create",views:{menuContent:{templateUrl:"templates/bookingtypes/bookingtype-create.html",controller:"BookingTypeCreateCtrl"}}}).state("app.locations-list",{url:"/locations-list",views:{menuContent:{templateUrl:"templates/locations/locations-list.html",controller:"LocationsListCtrl"}}}).state("app.location-details",{url:"/location-details/:locationId",views:{menuContent:{templateUrl:"templates/locations/location-details.html",controller:"LocationDetailsCtrl"}}}).state("app.location-create",{url:"/location-create",views:{menuContent:{templateUrl:"templates/locations/location-create.html",controller:"LocationCreateCtrl"}}}),o.otherwise("/app/start")}]),BookingSystem.config(["$mdDateLocaleProvider",function(e){e.months=["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],e.shortMonths=["jan","feb","mar","apr","maj","jun","jul","aug","sep","okt","nov","dec"],e.days=["söndag","måndag","tisdag","onsdag","torsdag","fredag","lördag"],e.shortDays=["Sö","Må","Ti","On","To","Fr","Lö"],e.firstDayOfWeek=1,e.parseDate=function(e){var o=moment(e,"L",!0);return o.isValid()?o.toDate():new Date(NaN)},e.formatDate=function(e){return moment(e).format("L")},e.monthHeaderFormatter=function(o){return e.shortMonths[o.getMonth()]+" "+o.getFullYear()},e.weekNumberFormatter=function(e){return"Vecka "+e},e.msgCalendar="Kalender",e.msgOpenCalendar="Öppna kalender"}]),BookingSystem.controller("NavigationCtrl",["$scope","$state",function(e,o){}]),BookingSystem.config(["$mdGestureProvider",function(e){e.skipClickHijack()}]),angular.module("BookingSystem.furnituringServices",["ngResource"]).factory("Furnituring",["$resource","API_URL",function(e,o){return e(o+"Furnituring/:furnituringId",{furnituringId:"@furnituringId"})}]).factory("LocationFurnituring",["$resource","API_URL",function(e,o){return e(o+"LocationFurnituring/:locationId",{locationId:"@locationId"},{remove:{url:o+"LocationFurnituring/:locationId/:furnituringId",id:"@id",method:"DELETE",isArray:!1,params:{locationId:"@locationId",furnituringId:"@furnituringId"}},removeForLocation:{url:o+"LocationFurnituring/:locationId",id:"@id",method:"DELETE",isArray:!1,params:{locationId:"@locationId"}},queryForLocation:{url:o+"LocationFurnituring/location/:locationId",id:"@id",method:"GET",isArray:!0,params:{locationId:"@locationId"}},saveForLocation:{url:o+"LocationFurnituring/location",id:"@id",method:"POST",isArray:!0}})}]),angular.module("BookingSystem.controllers",[]).controller("AppCtrl",["$scope","$ionicModal","$timeout",function(e,o,t){e.loginData={},o.fromTemplateUrl("templates/login.html",{scope:e}).then(function(o){e.modal=o}),e.closeLogin=function(){e.modal.hide()},e.login=function(){e.modal.show()},e.doLogin=function(){t(function(){e.closeLogin()},1e3)}}]).controller("PlaylistsCtrl",["$scope",function(e){e.playlists=[{title:"Reggae",id:1},{title:"Chill",id:2},{title:"Dubstep",id:3},{title:"Indie",id:4},{title:"Rap",id:5},{title:"Cowbell",id:6}]}]).controller("PlaylistCtrl",["$scope","$stateParams",function(e,o){}]),angular.module("BookingSystem.furnituring",[]).controller("FurnituringListCtrl",["$rootScope","$scope","$state","Furnituring",function(e,o,t,n){var r=function(){var t=n.query();t.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Möbleringar kunde inte hämtas, var god försök igen."}}),o.furniturings=t};o.$on("$ionicView.enter",function(e,o){r()})}]).controller("FurnituringDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","Furnituring",function(e,o,t,n,r,i,a){var s="templates/modals/furnituring-delete.html";o.editMode=!1,o.furnituringBackup={};var u=function(){i.fromTemplateUrl(s,{scope:o,animation:n}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()})},l=function(){var n=a.get({furnituringId:t.furnituringId});n.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Möblering kunde inte hämtas, var god försök igen."}}),o.furnituring=n};o.startEditMode=function(){var e=this;e.isEditMode=!0,e.furnituringBackup=angular.copy(e.furnituring)},o.endEditMode=function(){var e=this;e.isEditMode=!1},o.abortEditMode=function(){var e=this;e.isEditMode=!1,e.furnituring=e.furnituringBackup},o.saveFurnituring=function(){var o=this;a.save({FurnituringId:t.furnituringId,Name:o.furnituring.Name}).$promise.then(function(t){o.endEditMode(),e.FlashMessage={type:"success",message:'Möbleringen "'+o.furnituring.Name+'" sparades med ett lyckat resultat'}})["catch"](function(t){409===t.status?e.FlashMessage={type:"error",message:'Det finns redan en möblering som heter "'+o.furnituring.Name+'". Två möbleringar kan inte heta lika.'}:400!==t.status&&500!==t.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när möbleringen skulle sparas"}),404===t.status&&(e.FlashMessage={type:"error",message:'Möbleringen "'+o.furnituring.Name+'" existerar inte längre. Hann kanske någon radera den?'},history.back())})},o.deleteFurnituring=function(){a["delete"]({furnituringId:t.furnituringId}).$promise.then(function(t){e.FlashMessage={type:"success",message:'Möbleringen "'+o.furnituring.Name+'" raderades med ett lyckat resultat'},history.back()})["catch"](function(t){400===t.status&&"undefined"!==t.data.Message&&"Foreign key references exists"===t.data.Message?e.FlashMessage={type:"error",message:"Möbleringen kan inte raderas eftersom det finns en lokalbokning eller en lokalmöblering som refererar till möbleringen"}:400!==t.status&&500!==t.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när möbleringen skulle tas bort"}),404===t.status&&(e.FlashMessage={type:"error",message:'Möbleringen "'+o.furnituring.Name+'" existerar inte längre. Hann kanske någon radera den?'}),history.back()})},u(),l()}]).controller("FurnituringCreateCtrl",["$rootScope","$stateParams","$scope","$state","Furnituring",function(e,o,t,n,r){t.furnituring={},t.saveFurnituring=function(){var o=this;r.save({FurnituringId:0,Name:o.furnituring.Name}).$promise.then(function(t){e.FlashMessage={type:"success",message:'Möbleringen "'+o.furnituring.Name+'" skapades med ett lyckat resultat'},history.back()})["catch"](function(t){409===t.status?e.FlashMessage={type:"error",message:'Det finns redan en möblering som heter "'+o.furnituring.Name+'". Två möbleringar kan inte heta lika.'}:e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när möbleringen skulle sparas"}})}}]),angular.module("BookingSystem.mealsServices",["ngResource"]).factory("Meal",["$resource","API_URL",function(e,o){return e(o+"Meal/:mealId",{mealId:"@mealId"})}]).factory("MealHasPropertyHelper",["MealHasProperty","MealProperty",function(e,o){return{getCombined:function(t){var n=o.query(),r=e.queryForMealProperty({mealPropertyId:mealPropertyId});return n.$promise["finally"](function(){r.$promise["finally"](function(){n.forEach(function(e){var o=!1,t=void 0;for(t=0;t<r.length;t++)if(e.MealPropertyId===r[t].MealPropertyId){e.Selected=!0,o=!0;break}o||(e.Selected=!1)})})}),n}}}]),angular.module("BookingSystem.meals",[]).controller("MealsListCtrl",["$rootScope","$scope","$state","Meal",function(e,o,t,n){var r=function(){var t=n.query();t.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Måltider kunde inte hämtas, var god försök igen."}}),o.meals=t};o.$on("$ionicView.enter",function(e,o){r()})}]).controller("MealDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","Meal","MealProperty","MealHasProperty",function(e,o,t,n,r,i,a,s,u){var l="templates/modals/meals-delete.html";o.isEditMode=!1,o.mealBackup={};var c=function(){r.fromTemplateUrl(l,{scope:o,animation:n}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()})},d=function(){var n=a.get({mealId:t.mealId});n.$promise.then(function(){n.mealProperties=u.queryForMealProperty({mealPropertyId:t.mealPropertyId})})["catch"](function(){e.FlashMessage={type:"error",message:"Måltid kunde inte hämtas, var god försök igen."}}),o.meal=n},m=function(){o.mealProperties=s.query()};o.startEditMode=function(){var e=this;e.isEditMode=!0,e.mealBackup=angular.copy(e.meal)},o.endEditMode=function(){var e=this;e.isEditMode=!1},o.abortEditMode=function(){var e=this;e.isEditMode=!1,e.meal=e.mealBackup},o.saveMeal=function(){var o=this;a.save({MealId:t.mealId,Name:o.meal.Name}).$promise.then(function(t){o.endEditMode(),saveMealProperties(t.MealId).then(function(){e.FlashMessage={type:"success",message:'Måltiden "'+o.meal.Name+'" sparades med ett lyckat resultat'}})["catch"](function(){e.FlashMessage={type:"error",message:"Uppgifter om måltiden sparades, men kostinformationen kunde inte sparas. Var god försök igen."}})})["catch"](function(t){409===t.status?e.FlashMessage={type:"error",message:'Det finns redan en måltid som heter "'+o.meal.Name+'". Två måltider kan inte heta lika.'}:400!==t.status&&500!==t.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när måltiden skulle sparas"}),404===t.status&&(e.FlashMessage={type:"error",message:'Måltiden "'+o.meal.Name+'" existerar inte längre. Hann kanske någon radera den?'},history.back())})},o.deleteMeal=function(){a["delete"]({mealId:t.mealId}).$promise.then(function(t){e.FlashMessage={type:"success",message:'Måltiden "'+o.meal.Name+'" raderades med ett lyckat resultat'},history.back()})["catch"](function(t){400===t.status&&"undefined"!==t.data.Message&&"Foreign key references exists"===t.data.Message?e.FlashMessage={type:"error",message:"Måltiden kan inte raderas eftersom det finns en lokalbokning eller en lokalmåltid som refererar till måltiden"}:400!==t.status&&500!==t.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när måltiden skulle tas bort"}),404===t.status&&(e.FlashMessage={type:"error",message:'Måltiden "'+o.meal.Name+'" existerar inte längre. Hann kanske någon radera den?'}),history.back()})},c(),d(),m()}]).controller("MealCreateCtrl",["$rootScope","$stateParams","$scope","$state","Meal",function(e,o,t,n,r){t.meal={},t.saveMeal=function(){var o=this;r.save({MealId:0,Name:o.meal.Name}).$promise.then(function(t){e.FlashMessage={type:"success",message:'Måltiden "'+o.meal.Name+'" skapades med ett lyckat resultat'},history.back()})["catch"](function(t){409===t.status?e.FlashMessage={type:"error",message:'Det finns redan en måltid som heter "'+o.meal.Name+'". Två måltider kan inte heta lika.'}:e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när måltiden skulle sparas"}})}}]),angular.module("BookingSystem.mealPropertiesServices",["ngResource","BookingSystem.mealsServices"]).factory("MealProperty",["$resource","API_URL",function(e,o){return e(o+"MealProperty/:mealPropertyId",{mealPropertyId:"@mealPropertyId"})}]).factory("MealHasProperty",["$resource","API_URL",function(e,o){return e(o+"MealHasProperty/:mealPropertyId/:mealId",{mealPropertyId:"@mealPropertyId"},{remove:{url:o+"MealHasProperty/:mealPropertyId/:mealId",id:"@id",method:"DELETE",isArray:!1,params:{mealPropertyId:"@mealPropertyId",mealId:"@mealId"}},removeForMealProperty:{url:o+"MealHasProperty/:mealPropertyId",id:"@id",method:"DELETE",isArray:!1,params:{mealPropertyId:"@mealPropertyId"}},queryForMealProperty:{url:o+"MealHasProperty/:mealPropertyId",id:"@id",method:"GET",isArray:!0,params:{mealPropertyId:"@mealPropertyId"}},saveForMealProperty:{url:o+"MealHasProperty",id:"@id",method:"POST",isArray:!0}})}]),angular.module("BookingSystem.resourcesServices",["ngResource"]).factory("Resource",["$resource","API_URL",function(e,o){return e(o+"Resource/:resourceId",{resourceId:"@resourceId"},{queryFreeForPeriod:{url:o+"Resource/free/:fromDate/:toDate",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}}})}]),angular.module("BookingSystem.resources",[]).controller("ResourcesListCtrl",["$rootScope","$scope","$state","Resource",function(e,o,t,n){var r=function(){var t=n.query();t.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Resurser kunde inte hämtas, var god försök igen."}}),o.resources=t};o.$on("$ionicView.enter",function(e,o){r()})}]).controller("ResourceDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","Resource",function(e,o,t,n,r,i,a){var s="templates/modals/resources-delete.html";o.isEditMode=!1,o.resourceBackup={};var u=function(){r.fromTemplateUrl(s,{scope:o,animation:n}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()})},l=function(){var n=a.get({resourceId:t.resourceId});n.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Resurs kunde inte hämtas, var god försök igen."}}),o.resource=n};o.startEditMode=function(){var e=this;e.isEditMode=!0,e.resourceBackup=angular.copy(e.resource)},o.endEditMode=function(){var e=this;e.isEditMode=!1},o.abortEditMode=function(){var e=this;e.isEditMode=!1,e.resource=e.resourceBackup},o.saveResource=function(){var o=this;a.save({ResourceId:t.resourceId,Name:o.resource.Name,Count:o.resource.Count,BookingPricePerHour:o.resource.BookingPricePerHour,MinutesMarginAfterBooking:o.resource.MinutesMarginAfterBooking,WeekEndCount:o.resource.WeekEndCount}).$promise.then(function(t){o.endEditMode(),e.FlashMessage={type:"success",message:'Resursen "'+o.resource.Name+'" sparades med ett lyckat resultat'}})["catch"](function(t){409===t.status?e.FlashMessage={type:"error",message:'Det finns redan en resurs som heter "'+o.resource.Name+'". Två resurser kan inte heta lika.'}:400!==t.status&&500!==t.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när resursen skulle sparas"}),404===t.status&&(e.FlashMessage={type:"error",message:'Resursen "'+o.resource.Name+'" existerar inte längre. Hann kanske någon radera den?'},history.back())})},o.deleteResource=function(){a["delete"]({resourceId:t.resourceId}).$promise.then(function(t){e.FlashMessage={type:"success",message:'Resursen "'+o.resource.Name+'" raderades med ett lyckat resultat'},history.back()})["catch"](function(t){400===t.status&&"undefined"!==t.data.Message&&"Foreign key references exists"===t.data.Message?e.FlashMessage={type:"error",message:"Resursen kan inte raderas eftersom det finns en lokalbokning eller en lokalresurs som refererar till resursen"}:400!==t.status&&500!==t.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när resursen skulle tas bort"}),404===t.status&&(e.FlashMessage={type:"error",message:'Resursen "'+o.resource.Name+'" existerar inte längre. Hann kanske någon radera den?'}),history.back()})},u(),l()}]).controller("ResourceCreateCtrl",["$rootScope","$stateParams","$scope","$state","Resource",function(e,o,t,n,r){t.resource={},t.saveResource=function(){var o=this;r.save({ResourceId:0,Name:o.resource.Name,Count:o.resource.Count,BookingPricePerHour:o.resource.BookingPricePerHour,MinutesMarginAfterBooking:o.resource.MinutesMarginAfterBooking,WeekEndCount:o.resource.WeekEndCount}).$promise.then(function(t){e.FlashMessage={type:"success",message:'Resursen "'+o.resource.Name+'" skapades med ett lyckat resultat'},history.back()})["catch"](function(t){409===t.status?e.FlashMessage={type:"error",message:'Det finns redan en resurs som heter "'+o.resource.Name+'". Två resurser kan inte heta lika.'}:e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när resursen skulle sparas"}})}}]),angular.module("BookingSystem.locationBooking",["ngMessages"]).controller("LocationBookingViewCtrl",["$rootScope","$scope","$state","LocationBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM",function(e,o,t,n,r,i,a,s,u){var l=i,c=null,d=null,m=null;o.zoom=u,o.weekDate=moment();var g=function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];e>0?o.weekDate=moment(o.weekDate).add(1,"weeks"):0>e&&(o.weekDate=moment(o.weekDate).subtract(1,"weeks")),d=moment(o.weekDate).startOf("week"),m=moment(o.weekDate).endOf("week")},k=function(){var e=n.queryLessForPeriod({fromDate:d.format("YYYY-MM-DD"),toDate:m.format("YYYY-MM-DD")});e.$promise["catch"](function(){s.show(s.simple().content("Lokalbokningar kunde inte hämtas, var god försök igen.").position("top right"))}).then(function(e){o.locationBookings=e})},p=function(){c=r(function(){k()},l)},f=function(){var e=angular.element(document.querySelector("#booking-view-content"));a.on("pinch",function(e){e.gesture.srcEvent.preventDefault(),o.$apply(function(){o.zoom=e.gesture.scale})},e),a.on("swipeleft",function(e){o.toNextWeek(),o.$apply(),o.$broadcast("swipe-occurred")},e),a.on("swiperight",function(e){o.toPreviousWeek(),o.$apply(),o.$broadcast("swipe-occurred")},e)};o.toNextWeek=function(){g(1),k()},o.toPreviousWeek=function(){g(-1),k()},o.$on("$ionicView.enter",function(e,o){g(),k(),p()}),o.$on("$ionicView.loaded",function(e,o){f()}),o.$on("$ionicView.leave",function(e){c&&r.cancel(c),o.$broadcast("leaving-view")})}]).controller("LocationBookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","LocationBooking","$mdToast","Location","Customer","BookingHelper","$q","$ionicHistory",function(e,o,t,n,r,i,a,s,u,l,c,d,m){var g="templates/modals/location-booking-delete.html";o.editMode=!1,o.locationBookingBackup={};var k=function(){i.fromTemplateUrl(g,{scope:o,animation:n}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()})},p=function(){var e=a.get({locationBookingId:t.id});return e.$promise["catch"](function(){s.show(s.simple().content("Lokalbokning kunde inte hämtas, var god försök igen.").position("top right"))}),o.locationBooking=e,e.$promise},f=function(){var e=o.locationBooking.StartTime,t=o.locationBooking.EndTime;o.bookingStartDate=moment(e).toDate(),o.bookingStartHour=moment(e).hour(),o.bookingStartMinute=moment(e).minute(),o.bookingEndDate=moment(t).toDate(),o.bookingEndHour=moment(t).hour(),o.bookingEndMinute=moment(t).minute()},h=function(){return"undefined"!=typeof o.bookingStartDate&&"undefined"!=typeof o.bookingStartHour&&"undefined"!=typeof o.bookingStartMinute&&"undefined"!=typeof o.bookingEndDate&&"undefined"!=typeof o.bookingEndHour&&"undefined"!=typeof o.bookingEndMinute},y=function(){o.selectHours=c.getHoursForSelect(),o.selectMinutes=c.getMinutesForSelect()},b=function(){if(h()){var e=M(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute),t=M(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute);u.queryFreeForPeriod({fromDate:e.format("YYYY-MM-DD"),fromTime:e.format("HH:mm"),toDate:t.format("YYYY-MM-DD"),toTime:t.format("HH:mm")}).$promise.then(function(e){o.locations=e})["catch"](function(e){s.show(s.simple().content("Ett oväntat fel uppstod när uppgifter om lediga lokaler skulle hämtas").position("top right"))})}},v=function(){var e=l.query();e.$promise["catch"](function(){s.show(s.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right"))}),o.customers=e},M=function(e,o,t){return moment(e).hour(o).minute(t)};o.startEditMode=function(){var e=this;e.isEditMode=!0,e.locationBookingBackup=angular.copy(e.locationBooking)},o.endEditMode=function(){var e=this;e.isEditMode=!1},o.abortEditMode=function(){var e=this;e.isEditMode=!1,e.locationBooking=e.locationBookingBackup},o.deleteLocationBooking=function(){a["delete"]({locationBookingId:t.id}).$promise.then(function(e){s.show(s.simple().content("Lokalbokningen raderades med ett lyckat resultat").position("top right")),history.back()})["catch"](function(e){400!==e.status&&500!==e.status||s.show(s.simple().content("Ett oväntat fel uppstod när Lokalbokningen skulle tas bort").position("top right")),404===e.status&&s.show(s.simple().content("Lokalbokningen existerar inte längre. Hann kanske någon radera den?").position("top right")),history.back()})},o.updateFurniturings=function(){o.locationBooking.LocationId?(o.furniturings=LocationFurnituring.queryForLocation({locationId:o.locationBooking.LocationId}),o.furniturings.$promise["catch"](function(){s.show(s.simple().content("Möbleringar för vald lokal kunde inte hämtas.").position("top right"))})):o.furnituring=[]},o.checkEndDate=function(){if(h()){var e=M(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute).toDate().getTime(),t=M(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute).toDate().getTime();e>t&&(o.bookingEndDate=o.bookingStartDate,o.bookingEndHour=o.bookingStartHour,o.bookingEndMinute=o.bookingStartMinute+15),b()}},o.saveLocationBooking=function(){var e=this,o=d.defer(),t=o.promise,n=e.locationBooking.SelectedFurnituring?e.locationBooking.SelectedFurnituring.FurnituringId:null;return a.save({BookingId:e.locationBooking.BookingId,LocationBookingId:e.locationBooking.LocationBookingId,LocationId:e.locationBooking.LocationId,FurnituringId:n,StartTime:M(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).format(),EndTime:M(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).format(),NumberOfPeople:e.locationBooking.NumberOfPeople,Provisional:e.locationBooking.Provisional}).$promise.then(function(e){s.show(s.simple().content("Lokal/plats-bokningen sparades med ett lyckat resultat").position("top right")),o.resolve(),m.goBack()})["catch"](function(e){409===e.status?s.show(s.simple().content("Lokalen är tyvärr redan bokad under vald tidsram.").position("top right")):s.show(s.simple().content("Ett oväntat fel uppstod när lokal/plats-bokningen skulle sparas").position("top right"))}),t},k(),p().then(function(){f()}),b(),v(),y()}]).controller("LocationBookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","LocationBooking","Location","BookingHelper","LocationFurnituring","Customer","$q","$mdToast","$ionicHistory",function(e,o,t,n,r,i,a,s,u,l,c,d){t.locationBooking={Provisional:!0,BookingTypeId:1},t.furnituring=[];var m=function(){n.params.date?(t.bookingStartDate=moment(n.params.date).toDate(),t.bookingStartHour=moment(n.params.date).hour(),t.bookingStartMinute=moment(n.params.date).minute(),t.bookingEndDate=moment(n.params.date).toDate(),t.bookingEndHour=moment(n.params.date).hour(),t.bookingEndMinute=moment(n.params.date).add(59,"minutes").minute()):(t.bookingStartDate=new Date,t.bookingStartHour=8,t.bookingStartMinute=0,t.bookingEndDate=new Date,t.bookingEndHour=8,t.bookingEndMinute=59)},g=function(){return"undefined"!=typeof t.bookingStartDate&&"undefined"!=typeof t.bookingStartHour&&"undefined"!=typeof t.bookingStartMinute&&"undefined"!=typeof t.bookingEndDate&&"undefined"!=typeof t.bookingEndHour&&"undefined"!=typeof t.bookingEndMinute},k=function(){t.selectHours=a.getHoursForSelect(),t.selectMinutes=a.getMinutesForSelect()},p=function(){if(g()){var e=h(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute),o=h(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute);i.queryFreeForPeriod({fromDate:e.format("YYYY-MM-DD"),fromTime:e.format("HH:mm"),toDate:o.format("YYYY-MM-DD"),toTime:o.format("HH:mm")}).$promise.then(function(e){t.locations=e})["catch"](function(e){c.show(c.simple().content("Ett oväntat fel uppstod när uppgifter om lediga lokaler skulle hämtas").position("top right"))})}},f=function(){var e=u.query();e.$promise["catch"](function(){c.show(c.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right"))}),t.customers=e},h=function(e,o,t){return moment(e).hour(o).minute(t)},y=function(){var e=l.defer();return a.createBookingContainer(t.locationBooking).then(function(o){t.locationBooking.BookingId=o.BookingId,e.resolve()})["catch"](function(o){c.show(c.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle sparas").position("top right")),e.reject()}),e.promise};t.updateFurniturings=function(){t.locationBooking.LocationId?(t.furniturings=s.queryForLocation({locationId:t.locationBooking.LocationId}),t.furniturings.$promise["catch"](function(){c.show(c.simple().content("Möbleringar för vald lokal kunde inte hämtas.").position("top right"))})):t.furnituring=[]},t.checkEndDate=function(){if(g()){var e=h(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute).toDate().getTime(),o=h(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute).toDate().getTime();e>o&&(t.bookingEndDate=t.bookingStartDate,t.bookingEndHour=t.bookingStartHour,t.bookingEndMinute=t.bookingStartMinute+15),p()}},t.saveLocationBooking=function(){var e=this,o=l.defer(),t=o.promise;return y().then(function(){var t=e.locationBooking.SelectedFurnituring?e.locationBooking.SelectedFurnituring.FurnituringId:null;r.save({BookingId:e.locationBooking.BookingId,LocationBookingId:0,LocationId:e.locationBooking.LocationId,FurnituringId:t,StartTime:h(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).format(),EndTime:h(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).format(),NumberOfPeople:e.locationBooking.NumberOfPeople}).$promise.then(function(e){c.show(c.simple().content("Lokal/plats-bokningen skapades med ett lyckat resultat").position("top right")),o.resolve(),d.goBack()})["catch"](function(e){409===e.status?c.show(c.simple().content("Lokalen är tyvärr redan bokad under vald tidsram.").position("top right")):c.show(c.simple().content("Ett oväntat fel uppstod när lokal/plats-bokningen skulle sparas").position("top right"))})}),t},m(),p(),f(),
k()}]),angular.module("BookingSystem.locationBookingServices",["ngResource"]).factory("LocationBooking",["$resource","API_URL",function(e,o){return e(o+"LocationBooking/:locationBookingId",{locationBookingId:"@locationBookingId"},{queryLessForPeriod:{url:o+"LocationBooking/period/:fromDate/:toDate/less",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},queryMoreForPeriod:{url:o+"LocationBooking/period/:fromDate/:toDate/more",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}}})}]),angular.module("BookingSystem.locationsServices",["ngResource"]).factory("Location",["$resource","API_URL",function(e,o){return e(o+"Location/:locationId",{locationId:"@locationId"},{queryFreeForPeriod:{url:o+"Location/free/:fromDate/:toDate",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},querySearch:{url:o+"Location/search/:column",id:"@id",method:"GET",isArray:!0,params:{column:"@column"}}})}]).factory("LocationImage",["$http","API_URL",function(e,o){return{upload:function(t,n){return e({method:"POST",url:o+"Location/image/"+n,data:t,headers:{"Content-Type":void 0}})}}}]),angular.module("BookingSystem.locations",["uiGmapgoogle-maps"]).config(["$stateProvider","uiGmapGoogleMapApiProvider",function(e,o){o.configure({v:"3.17",libraries:"weather,geometry,visualization",language:"sv"})}]).controller("LocationsListCtrl",["$rootScope","$scope","$state","$mdToast","Location",function(e,o,t,n,r){var i=function(){var e=r.query();e.$promise["catch"](function(){n.show(n.simple().content("Lokaler och platser kunde inte hämtas, var god försök igen.").position("top right"))}),o.locations=e};o.$on("$ionicView.enter",function(e,o){i()})}]).controller("LocationDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","$mdToast","Location","LocationImage","API_IMG_PATH_URL","DEFAULT_MAP_ZOOM","DEFAULT_LONGITUDE","DEFAULT_LATITUDE",function(e,o,t,n,r,i,a,s,u,l,c,d,m){var g="templates/modals/location-delete.html";o.editMode=!1,o.locationBackup={},o.API_IMG_PATH_URL=l,o.markers=[];var k=function(){i.fromTemplateUrl(g,{scope:o,animation:n}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()})},p=function(e){return u.upload(o.location.ImageForUpload,e)},f=function(){a.show(a.simple().content('Lokalen/Platsen "'+o.location.Name+'" sparades med ett lyckat resultat').position("top right")),history.back()},h=function(){o.map={center:{latitude:m,longitude:d},zoom:c,bounds:{},options:{mapTypeId:google.maps.MapTypeId.SATELLITE}}},y=function(){o.markers[0]={id:o.location.LocationId,coords:{latitude:o.location.GPSLatitude,longitude:o.location.GPSLongitude}},o.map.center={latitude:o.location.GPSLatitude,longitude:o.location.GPSLongitude},o.map.zoom=18},b=function(){var e=s.get({locationId:t.locationId});e.$promise["catch"](function(){a.show(a.simple().content("Lokal/plats kunde inte hämtas, var god försök igen.").position("top right"))}),o.location=e};o.startEditMode=function(){var e=this;e.isEditMode=!0,e.locationBackup=angular.copy(e.location)},o.endEditMode=function(){var e=this;e.isEditMode=!1},o.abortEditMode=function(){var e=this;e.isEditMode=!1,e.location=e.locationBackup},o.saveLocation=function(){var e=this;s.save({LocationId:t.locationId,Name:e.location.Name,MaxPeople:e.location.MaxPeople,ImageSrc:e.location.ImageSrc,BookingPricePerHour:e.location.BookingPricePerHour,MinutesMarginBeforeBooking:e.location.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:e.location.MinutesMarginAfterBooking}).$promise.then(function(o){e.endEditMode(),"undefined"!=typeof e.location.ImageForUpload?p(o.LocationId).success(function(){f()}).error(function(){a.show(a.simple().content("Lokalen/Platsen sparades, men det gick inte att ladda upp och spara den önskade bilden.").position("top right"))}):f()})["catch"](function(o){409===o.status?a.show(a.simple().content('Det finns redan en lokal/plats som heter "'+e.location.Name+'". Två lokaler eller platser kan inte heta lika.').position("top right")):400!==o.status&&500!==o.status||a.show(a.simple().content("Ett oväntat fel uppstod när lokalen/platsen skulle sparas").position("top right")),404===o.status&&(a.show(a.simple().content('Lokalen/platsen "'+e.location.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),history.back())})},o.deleteLocation=function(){s["delete"]({locationId:t.locationId}).$promise.then(function(e){a.show(a.simple().content('Lokalen/platsen "'+o.location.Name+'" raderades med ett lyckat resultat').position("top right")),history.back()})["catch"](function(e){400===e.status&&"undefined"!==e.data.Message&&"Foreign key references exists"===e.data.Message?a.show(a.simple().content("Lokalen/platsen kan inte raderas eftersom det finns en bokning eller en lokalmöblering som refererar till lokalen/platsen").position("top right")):400!==e.status&&500!==e.status||a.show(a.simple().content("Ett oväntat fel uppstod när lokalen/platsen skulle tas bort").position("top right")),404===e.status&&a.show(a.simple().content('Lokalen/platsen "'+o.location.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right")),history.back()})},k(),b(),h(),o.$watch(function(){return o.map.bounds},function(e,o){!o.southwest&&e.southwest&&y()},!0)}]).controller("LocationCreateCtrl",["$rootScope","$stateParams","$scope","$state","$mdToast","Location","LocationImage",function(e,o,t,n,r,i,a){t.location={};var s=function(e){return a.upload(t.location.ImageForUpload,e)},u=function(){r.show(r.simple().content('Lokalen/Platsen "'+t.location.Name+'" sparades med ett lyckat resultat').position("top right")),history.back()};t.saveLocation=function(){var e=this;i.save({LocationId:0,Name:e.location.Name,MaxPeople:e.location.MaxPeople,ImageSrc:e.location.ImageSrc,BookingPricePerHour:e.location.BookingPricePerHour,MinutesMarginBeforeBooking:e.location.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:e.location.MinutesMarginAfterBooking}).$promise.then(function(o){"undefined"!=typeof e.location.ImageForUpload?s(o.LocationId).success(function(){u()}).error(function(){r.show(r.simple().content("Lokalen/Platsen sparades, men det gick inte att ladda upp och spara den önskade bilden.").position("top right"))}):u()})["catch"](function(o){409===o.status?r.show(r.simple().content('Det finns redan en lokal eller plats som heter "'+e.location.Name+'". Två lokaler/platser kan inte heta lika.').position("top right")):r.show(r.simple().content("Ett oväntat fel uppstod när lokalen/platsen skulle sparas").position("top right"))})}}]),angular.module("BookingSystem.calendarWeekDirective",[]).controller("CalendarWeekCtrl",["$rootScope","$scope","$state","LocationBooking","BookingHelper",function(e,o,t,n,r){o.days=[];var i=function(e,o,t){return r.doBookingsCollide(t.StartTime,t.EndTime,e,o)},a=function(e){var t=void 0;for(t=0;7>t;t++){var n=moment(o.days[t].date),r=moment(n).endOf("day"),a=o.bookings.filter(i.bind(null,n,r));o.days[t].bookings=[],a.forEach(function(e){o.days[t].bookings.push(JSON.parse(JSON.stringify(e)))})}},s=function(){o.weekDateStart=moment(o.date).startOf("isoWeek");for(var e=0,t=moment(o.weekDateStart);7>e;t.add(1,"days"))o.days[e]={},o.days[e].date=t.format(),e++},u=function(e){o.$broadcast("hideAllAddButtons",!0)};o.hideAddButtons=function(e){u()},s(),o.$watch("bookings",function(e){void 0!==e&&a()}),o.$watch("date",function(e,o){s()})}]).directive("calendarWeek",[function(){return{restrict:"E",replace:!0,templateUrl:function(e,o){return"templates/directives/calendar-week.html"},scope:{date:"=",bookings:"=",bookingsType:"=",zoom:"="},link:function(e,o,t){},controller:"CalendarWeekCtrl"}}]),angular.module("BookingSystem.calendarDayDirective",[]).controller("CalendarDayCtrl",["$scope","$element","$attrs","$rootScope","$location","$q","$state","BookingHelper","$interval","DEFAULT_CALENDAR_ZOOM","$ionicScrollDelegate","$window","$document",function(e,o,t,n,r,i,a,s,u,l,c,d,m){var g=moment(e.date),k=6e4,p=200,f=35,h=null;e.dayNumber=g.format("D"),e.dayName=g.format("ddd"),e.visibleAddButtonHour=null,e.columnHeight=f*e.zoom;var y=function(){var o=void 0,t=24;for(e.hoursArray=[],o=0;t>o;o++)e.hoursArray.push(o)},b=function(e,o){return Number(e)+Number(o/60)},v=function(){var o=e.columnHeight+f*(e.zoom-1);p>o&&o>f&&(e.columnHeight=o)},M=function(){e.isCurrentDay&&m.ready(function(){var o=angular.element(document.querySelector(".time-line")).prop("offsetTop");c.scrollTo(0,o-e.columnHeight,!1)})},B=function(){if(e.isCurrentDay=moment().format("YYYY-MM-DD")===g.format("YYYY-MM-DD"),e.isCurrentDay){var o=moment(),t=o.format("H"),n=o.format("mm");e.currentHour=b(t,n)}else e.isDayOld=g.isBefore(moment())},D=function(){e.isCurrentDay&&(h=u(function(){B()},k))},$=function(e){var o=moment(e.EndTime).startOf("day"),t=moment(e.StartTime).format("H"),n=moment(e.StartTime).format("mm");return g.date()!==moment(e.StartTime).date()&&moment(e.StartTime).isBefore(o)?0:b(t,n)},S=function(e){return moment(e.EndTime).isAfter(moment(g).endOf("day"))?23.99:Number(moment(e.EndTime).format("H"))+Number(moment(e.EndTime).format("mm")/60)},E=function(){void 0!==e.bookings&&e.bookings.forEach(function(o){o.StartHour=$(o),o.EndHour=S(o),o.Duration=o.EndHour-o.StartHour,s.setConcurrentBookingData(o,e.bookings)})};e.showAddHour=function(o){e.hideAllAddButtonsCallback(),e.visibleAddButtonHour=o},e.hideAddButton=function(){e.visibleAddButtonHour=null},e.createEventForHour=function(o){g.set({hour:o}),a.go("app."+e.bookingsType+"-create",{date:g,id:null}),e.hideAddButton()},e.showEvent=function(o){a.go("app."+e.bookingsType+"-details",{id:o})},y(),B(),D(),M(),e.$on("hideAllAddButtons",function(o,t){e.hideAddButton()}),e.$watch("bookings",function(e,o){Array.isArray(e)&&E()}),e.$watch("zoom",function(e,o){v()}),e.$on("swipe-occurred",function(o){e.columnHeight=f*l}),e.$on("leaving-view",function(e){null!==h&&u.cancel(h)})}]).directive("calendarDay",[function(){return{restrict:"E",replace:!0,templateUrl:function(e,o){return"templates/directives/calendar-day.html"},scope:{date:"=",hideAllAddButtonsCallback:"&",hideAddButton:"=",bookings:"=",bookingsType:"=",zoom:"="},link:function(e,o,t){},controller:"CalendarDayCtrl"}}]).controller("CalendarTimeCtrl",["$scope","DEFAULT_CALENDAR_ZOOM",function(e,o){var t=35;e.columnHeight=t*e.zoom;var n=200,r=function(){e.weekNumber=moment(e.date).isoWeek()},i=function(){var o=e.columnHeight+t*(e.zoom-1);n>o&&o>t&&(e.columnHeight=o)},a=function(){var o=void 0,t=24;for(e.hoursArray=[],o=1;t>o;o++)e.hoursArray.push(o)};a(),r(),e.$watch("zoom",function(e,o){i()}),e.$watch("date",function(e,o){r()}),e.$on("swipe-occurred",function(n){e.columnHeight=t*o})}]).directive("calendarTime",[function(){return{restrict:"E",replace:!0,scope:{date:"=",zoom:"="},templateUrl:function(e,o){return"templates/directives/calendar-time.html"},controller:"CalendarTimeCtrl"}}]).filter("digits",function(){return function(e){return 10>e&&(e="0"+e),e}}),angular.module("BookingSystem.customersServices",["ngResource"]).factory("Customer",["$resource","API_URL",function(e,o){return e(o+"Customer/:customerId",{customerId:"@customerId"})}]).factory("CustomerImage",["$http","API_URL",function(e,o){return{upload:function(t,n){return e({method:"POST",url:o+"Customer/image/"+n,data:t,headers:{"Content-Type":void 0}})}}}]),angular.module("BookingSystem.customers",[]).controller("CustomersListCtrl",["$rootScope","$scope","$state","Customer",function(e,o,t,n){var r=function(){var t=n.query();t.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Kunder kunde inte hämtas, var god försök igen."}}),o.customers=t};o.$on("$ionicView.enter",function(e,o){r()})}]).controller("CustomerDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","Customer","CustomerImage","API_IMG_PATH_URL",function(e,o,t,n,r,i,a,s,u){var l="templates/modals/customers-delete.html";o.isEditMode=!1,o.customerBackup={},o.API_IMG_PATH_URL=u;var c=function(){r.fromTemplateUrl(l,{scope:o,animation:n}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()})},d=function(e){return s.upload(o.customer.ImageForUpload,e)},m=function(){e.FlashMessage={type:"success",message:'Kunden "'+o.customer.Name+'" sparades med ett lyckat resultat'},history.back()},g=function(){var n=a.get({customerId:t.customerId});n.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Kunden kunde inte hämtas, var god försök igen."}}),o.customer=n};o.startEditMode=function(){var e=this;e.isEditMode=!0,e.customerBackup=angular.copy(e.customer)},o.endEditMode=function(){var e=this;e.isEditMode=!1},o.abortEditMode=function(){var e=this;e.isEditMode=!1,e.customer=e.customerBackup},o.saveCustomer=function(){var o=this;a.save({CustomerId:t.customerId,Name:o.customer.Name,Address:o.customer.Address,PostNumber:o.customer.PostNumber,City:o.customer.City,EmailAddress:o.customer.EmailAddress,PhoneNumber:o.customer.PhoneNumber,CellPhoneNumber:o.customer.CellPhoneNumber,ParentCustomerId:o.customer.ParentCustomerId,ImageSrc:o.customer.ImageSrc,Notes:o.customer.Notes}).$promise.then(function(t){o.endEditMode(),"undefined"!=typeof o.customer.ImageForUpload?d(t.CustomerId).success(function(){m()}).error(function(){e.FlashMessage={type:"error",message:"Kunden sparades, men det gick inte att ladda upp och spara den önskade bilden."}}):m()})["catch"](function(t){409===t.status?e.FlashMessage={type:"error",message:'Det finns redan en kund som heter "'+o.customer.Name+'". Två kunder kan inte heta lika.'}:400!==t.status&&500!==t.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när kunden skulle sparas"}),404===t.status&&(e.FlashMessage={type:"error",message:'Kunden "'+o.customer.Name+'" existerar inte längre. Hann kanske någon radera den?'},history.back())})},o.deleteCustomer=function(){a["delete"]({customerId:t.customerId}).$promise.then(function(t){e.FlashMessage={type:"success",message:'Kunden "'+o.customer.Name+'" raderades med ett lyckat resultat'},history.back()})["catch"](function(t){400===t.status&&"undefined"!==t.data.Message&&"Foreign key references exists"===t.data.Message?e.FlashMessage={type:"error",message:"Kunden kan inte raderas eftersom det finns en bokning som refererar till kunden"}:400!==t.status&&500!==t.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när kunden skulle tas bort"}),404===t.status&&(e.FlashMessage={type:"error",message:'Kunden "'+o.customer.Name+'" existerar inte längre. Hann kanske någon radera den?'}),history.back()})},c(),g()}]).controller("CustomerCreateCtrl",["$rootScope","$stateParams","$scope","$state","Customer","CustomerImage",function(e,o,t,n,r,i){t.customer={},console.log(API_IMG_PATH_URL);var a=function(e){return i.upload(t.customer.ImageForUpload,e)},s=function(){e.FlashMessage={type:"success",message:'Kunden "'+t.customer.Name+'" sparades med ett lyckat resultat'},history.back()};t.saveCustomer=function(){var o=this;r.save({CustomerId:0,Name:o.customer.Name,Address:o.customer.Address,PostNumber:o.customer.PostNumber,City:o.customer.City,EmailAddress:o.customer.EmailAddress,PhoneNumber:o.customer.PhoneNumber,CellPhoneNumber:o.customer.CellPhoneNumber,ParentCustomerId:o.customer.ParentCustomerId,ImageSrc:o.customer.ImageSrc,Notes:o.customer.Notes}).$promise.then(function(t){"undefined"!=typeof o.customer.ImageForUpload?a(t.CustomerId).success(function(e){s()}).error(function(){e.FlashMessage={type:"error",message:'Kunden "'+o.customer.Name+'" skapades, men det gick inte att ladda upp och spara den önskade bilden.'},history.back()}):s()})["catch"](function(t){409===t.status?e.FlashMessage={type:"error",message:'Det finns redan en kund som heter "'+o.customer.Name+'". Två kunder kan inte heta lika.'}:e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när kunden skulle sparas"}})}}]),angular.module("BookingSystem.bookingTypesServices",["ngResource"]).factory("BookingType",["$resource","API_URL",function(e,o){return e(o+"BookingType/:bookingTypeId",{bookingTypeId:"@bookingTypeId"})}]),angular.module("BookingSystem.bookingTypes",[]).controller("BookingTypesListCtrl",["$rootScope","$scope","$state","BookingType",function(e,o,t,n){var r=function(){var t=n.query();t.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Bokningstyper kunde inte hämtas, var god försök igen."}}),o.bookingTypes=t};o.$on("$ionicView.enter",function(e,o){r()})}]).controller("BookingTypeDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","BookingType",function(e,o,t,n,r,i,a){var s="templates/modals/bookingtypes-delete.html";o.isEditMode=!1,o.bookingTypeBackup={};var u=function(){r.fromTemplateUrl(s,{scope:o,animation:n}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()})},l=function(){var n=a.get({bookingTypeId:t.bookingTypeId});n.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Bokningstypen kunde inte hämtas, var god försök igen."}}),o.bookingType=n};o.toggleHasLocation=function(){var e=this;console.log(e.bookingType.HasLocation),e.bookingType.HasLocation===!0?e.bookingType.HasLocation=!1:e.bookingType.HasLocation=!0},o.startEditMode=function(){var e=this;e.isEditMode=!0,e.bookingTypeBackup=angular.copy(e.bookingType)},o.endEditMode=function(){var e=this;e.isEditMode=!1},o.abortEditMode=function(){var e=this;e.isEditMode=!1,e.bookingType=e.bookingTypeBackup},o.saveBookingType=function(){var o=this;a.save({BookingTypeId:t.bookingTypeId,Name:o.bookingType.Name}).$promise.then(function(t){o.endEditMode(),e.FlashMessage={type:"success",message:'Bokningstypen "'+o.bookingType.Name+'" sparades med ett lyckat resultat'}})["catch"](function(t){409===t.status?e.FlashMessage={type:"error",message:'Det finns redan en bokningstyp som heter "'+o.bookingType.Name+'". Två boknigstyper kan inte heta lika.'}:400!==t.status&&500!==t.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när bokningstypen skulle sparas"}),404===t.status&&(e.FlashMessage={type:"error",message:'Bokningstypen "'+o.bookingType.Name+'" existerar inte längre. Hann kanske någon radera den?'},history.back())})},o.deleteBookingType=function(){a["delete"]({bookingTypeId:t.bookingTypeId}).$promise.then(function(t){e.FlashMessage={type:"success",message:'Bokningstypen "'+o.bookingType.Name+'" raderades med ett lyckat resultat'},history.back()})["catch"](function(t){400===t.status&&"undefined"!==t.data.Message&&"Foreign key references exists"===t.data.Message?e.FlashMessage={type:"error",message:"Bokningstypen kan inte raderas eftersom det finns en bokning som refererar till bokningstypen"}:400!==t.status&&500!==t.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när bokningstypen skulle tas bort"}),404===t.status&&(e.FlashMessage={type:"error",message:'Bokningstypen "'+o.bookingType.Name+'" existerar inte längre. Hann kanske någon radera den?'}),history.back()})},u(),l()}]).controller("BookingTypeCreateCtrl",["$rootScope","$stateParams","$scope","$state","BookingType",function(e,o,t,n,r){t.bookingType={},t.bookingType.HasLocation=!1,t.toggleHasLocation=function(){var e=this;e.bookingType.HasLocation===!0?e.bookingType.HasLocation=!1:e.bookingType.HasLocation=!0},t.saveBookingType=function(){var o=this;r.save({BookingTypeId:0,Name:o.bookingType.Name,HasLocation:o.bookingType.HasLocation,MinutesMarginBeforeBooking:o.bookingType.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:o.bookingType.MinutesMarginAfterBooking}).$promise.then(function(t){e.FlashMessage={type:"success",message:'Bokningstypen "'+o.bookingType.Name+'" skapades med ett lyckat resultat'},history.back()})["catch"](function(t){409===t.status?e.FlashMessage={type:"error",message:'Det finns redan en bokningstyp som heter "'+o.bookingType.Name+'". Två bokningstyper kan inte heta lika.'}:e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när bokningstypen skulle sparas"}})}}]),angular.module("BookingSystem.bookingHelperServices",[]).factory("BookingHelper",["$q","Booking",function(e,o){var t=function(e,o,t,n){return e=moment(e),o=moment(o),t=moment(t),n=moment(n),e.isBefore(n)&&o.isAfter(n)||e.isBefore(t)&&o.isAfter(t)||e.isSameOrAfter(t)&&o.isSameOrBefore(n)},n=function(e,o){var n=[],r=0,i=void 0;for(i=0;i<o.length;i++)t(e.StartTime,e.EndTime,o[i].StartTime,o[i].EndTime)&&n.push(o[i]);e.ConcurrentBookings=n.length,n.length&&(n.sort(function(e,o){return e.StartTime>=o.StartTime&&e.EndTime<=o.EndTime}),r=n.findIndex(function(o){return e.Id===o.Id})),e.ConcurrentBookingIndex=r},r=function(){for(var e=[],o=0;23>=o;o++)e.push(o);return e},i=function(){for(var e=[],o=0;59>=o;o++)e.push(o);return e},a=function(e){return o.save({BookingId:0,Name:"",BookingTypeId:e.BookingTypeId,CustomerId:e.CustomerId,Provisional:1,NumberOfPeople:e.NumberOfPeople||0,Discount:0,CreatedByUserId:1,ModifiedByUserId:1,ResponsibleUserId:1}).$promise};return{doBookingsCollide:t,setConcurrentBookingData:n,getHoursForSelect:r,getMinutesForSelect:i,createBookingContainer:a}}]),angular.module("BookingSystem.imageResizeServices",[]).factory("ImageResize",["UPLOAD_IMG_MAX_WIDTH","UPLOAD_IMG_MAX_HEIGHT","$q",function(e,o,t){var n=void 0,r=void 0,i=void 0,a=void 0,s=function(e){var o=document.createElement("canvas");return o.width=e.width/2,o.height=e.height/2,o.getContext("2d").drawImage(e,0,0,o.width,o.height),o},u=function(e,o,t){function n(e,o,t,n,r,i){var a=1-r,s=1-i;return e*a*s+o*r*s+t*a*i+n*r*i}var r=void 0,i=void 0,a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0,m=void 0,g=void 0,k=void 0,p=void 0,f=void 0,h=void 0,y=void 0,b=void 0,v=void 0,M=void 0,B=void 0;for(r=0;r<o.height;++r)for(a=r/t,s=Math.floor(a),u=Math.ceil(a)>e.height-1?e.height-1:Math.ceil(a),i=0;i<o.width;++i)l=i/t,c=Math.floor(l),d=Math.ceil(l)>e.width-1?e.width-1:Math.ceil(l),m=4*(i+o.width*r),g=4*(c+e.width*s),k=4*(d+e.width*s),p=4*(c+e.width*u),f=4*(d+e.width*u),h=l-c,y=a-s,b=n(e.data[g],e.data[k],e.data[p],e.data[f],h,y),o.data[m]=b,v=n(e.data[g+1],e.data[k+1],e.data[p+1],e.data[f+1],h,y),o.data[m+1]=v,M=n(e.data[g+2],e.data[k+2],e.data[p+2],e.data[f+2],h,y),o.data[m+2]=M,B=n(e.data[g+3],e.data[k+3],e.data[p+3],e.data[f+3],h,y),o.data[m+3]=B},l=function(o){var t=document.createElement("canvas"),n=e/o.width;t.width=o.width*n,t.height=o.height*n;var r=o.getContext("2d").getImageData(0,0,o.width,o.height),i=t.getContext("2d").createImageData(t.width,t.height);return u(r,i,n),t.getContext("2d").putImageData(i,0,0),t};return{scaleImage:function(o){return n=document.createElement("img"),r=document.createElement("canvas"),i=t.defer(),n.src=o,n.onload=function(){for(r.width=n.width,r.height=n.height,r.getContext("2d").drawImage(n,0,0,r.width,r.height);r.width>=2*e;)r=s(r);r.width>e&&(r=l(r)),a=r.toDataURL("image/jpeg",1),i.resolve(a)},i.promise}}}]),angular.module("BookingSystem.imageUploaderDirective",["BookingSystem.imageResizeServices"]).controller("imageUploaderCtrl",["$scope","$q","$element","$attrs","$rootScope","CustomerImage","ImageResize","API_IMG_PATH_URL","PHOTO_MISSING_SRC",function(e,o,t,n,r,i,a,s,u){e.file="",e.progress=0,e.isProgressVisible=!1;var l=function(o,t){return function(){e.$apply(function(){a.scaleImage(o.result).then(function(o){e.displayImageSrc=o,e.base64EncodedImage=o.replace(/^data:image\/jpeg;base64,/,""),t.resolve()})})}},c=function(o,t){return function(){e.$apply(function(){t.reject(o.result)})}},d=function(e){return function(e){}},m=function(e){var o=!1;return"image/png"!==e.type&&"image/jpg"!==e.type&&"image/jpeg"!==e.type&&"image/gif"!==e.type||e.size<1e7&&(o=!0),o};e.$watch("imageSrc",function(o,t){"undefined"!=typeof o&&""!==o?e.displayImageSrc=s+o+"?"+Date.now():e.displayImageSrc=u}),e.readUploadedFile=function(e){var t=o.defer(),n=new FileReader,i=null;return m(e)?(n.onload=l(n,t),n.onerror=c(n,t),n.onprogress=d(n),n.readAsDataURL(e),i=t.promise):(r.FlashMessage={type:"error",message:"Den uppladdade bilden måste vara av typen: jpg, gif eller png och får inte överstiga 10mb i storlek"},t.reject(),i=t.promise),i}}]).directive("imageUploader",["$http",function(e){return{restrict:"E",link:function(e,o,t){},scope:{imageSrc:"=imageSrc",base64EncodedImage:"=base64EncodedImage"},replace:!0,templateUrl:"templates/directives/image-uploader-directive.html",controller:"imageUploaderCtrl"}}]).directive("imageUploaderFile",function(){return{restrict:"A",replace:!1,scope:!1,controller:["$scope","$element","$attrs",function(e,o,t){o.bind("change",function(o){var t=(o.srcElement||o.target).files[0];e.readUploadedFile(t)})}]}}),angular.module("BookingSystem.filters",[]).filter("zpad",[function(){return function(e,o){if(void 0===e&&(e=""),e.length>=o)return e;var t="0".repeat(o);return(t+e).slice(-1*o)}}]),function(){var e=function(e){return angular.isUndefined(e)||""===e||null===e||void 0===e};angular.module("BookingSystem.ngMinMaxDirectives",[]).directive("ngMin",function(){return{restrict:"A",require:"ngModel",link:function(o,t,n,r){o.$watch(n.ngMin,function(){r.$setViewValue(r.$viewValue)});var i=function(t){var i=o.$eval(n.ngMin)||0;return!e(t)&&i>t?void r.$setValidity("ngMin",!1):(r.$setValidity("ngMin",!0),t)};r.$parsers.push(i),r.$formatters.push(i)}}}).directive("ngMax",function(){return{restrict:"A",require:"ngModel",link:function(o,t,n,r){o.$watch(n.ngMax,function(){r.$setViewValue(r.$viewValue)});var i=function(t){var i=o.$eval(n.ngMax)||1/0;return!e(t)&&t>i?void r.$setValidity("ngMax",!1):(r.$setValidity("ngMax",!0),t)};r.$parsers.push(i),r.$formatters.push(i)}}})}(),angular.module("BookingSystem.bookingServices",["ngResource"]).factory("Booking",["$resource","API_URL",function(e,o){return e(o+"Booking/:bookingId",{bookingId:"@bookingId"},{queryLessForPeriod:{url:o+"Booking/period/:fromDate/:toDate/less",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},queryMoreForPeriod:{url:o+"Booking/period/:fromDate/:toDate/more",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},countEmpty:{url:o+"Booking/empty/count",id:"@id",method:"GET",isArray:!1},queryEmpty:{url:o+"Booking/empty/info",id:"@id",method:"GET",isArray:!0},querySearch:{url:o+"Booking/search/:column",id:"@id",method:"GET",isArray:!0,params:{column:"@column"}}})}]),angular.module("BookingSystem.bookings",[]).controller("BookingListCtrl",["$rootScope","$scope","$state","Booking",function(e,o,t,n){var r=function(){var t=n.query();t.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Bokningstillfällen kunde inte hämtas, var god försök igen."}}),o.bookings=t};o.$on("$ionicView.enter",function(e,o){r()})}]).controller("BookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","Booking",function(e,o,t,n,r,i,a){var s="templates/modals/booking-delete.html";o.editMode=!1,o.bookingBackup={};var u=function(){i.fromTemplateUrl(s,{scope:o,animation:n}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()})},l=function(){var n=a.get({bookingId:t.bookingId});n.$promise["catch"](function(){e.FlashMessage={type:"error",message:"Bokningstillfälle kunde inte hämtas, var god försök igen."}}),o.booking=n};o.startEditMode=function(){var e=this;e.isEditMode=!0,e.bookingBackup=angular.copy(e.booking)},o.endEditMode=function(){var e=this;e.isEditMode=!1},o.abortEditMode=function(){var e=this;e.isEditMode=!1,e.booking=e.bookingBackup},o.saveBooking=function(){var o=this;a.save({BookingId:t.bookingId,Name:o.booking.Name}).$promise.then(function(t){o.endEditMode(),e.FlashMessage={type:"success",message:'Bokningstillfället "'+o.booking.Name+'" sparades med ett lyckat resultat'}})["catch"](function(t){409===t.status?e.FlashMessage={type:"error",message:'Det finns redan ett bokningstillfälle som heter "'+o.booking.Name+'". Två bokningstillfällen kan inte heta lika.'}:400!==t.status&&500!==t.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när bokningstillfället skulle sparas"}),404===t.status&&(e.FlashMessage={type:"error",message:'Bokningstillfället "'+o.booking.Name+'" existerar inte längre. Hann kanske någon radera den?'},history.back())})},o.deleteBooking=function(){a["delete"]({bookingId:t.bookingId}).$promise.then(function(t){e.FlashMessage={type:"success",message:'Bokningstillfället "'+o.booking.Name+'" raderades med ett lyckat resultat'},history.back()})["catch"](function(t){400===t.status&&"undefined"!==t.data.Message&&"Foreign key references exists"===t.data.Message?e.FlashMessage={type:"error",message:"Bokningstillfället kan inte raderas eftersom det finns en lokalbokning, resursbokning eller en måltidsbokning som refererar till bokningstillfället"}:400!==t.status&&500!==t.status||(e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när bokningstillfället skulle tas bort"}),404===t.status&&(e.FlashMessage={type:"error",message:'Bokningstillfället "'+o.booking.Name+'" existerar inte längre. Hann kanske någon radera den?'}),history.back()})},u(),l()}]).controller("BookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","Booking",function(e,o,t,n,r){t.booking={},t.saveBooking=function(){var o=this;r.save({BookingId:0,Name:o.booking.Name}).$promise.then(function(t){e.FlashMessage={type:"success",message:'Bokningstillfället "'+o.booking.Name+'" skapades med ett lyckat resultat'},history.back()})["catch"](function(t){409===t.status?e.FlashMessage={type:"error",message:'Det finns redan ett bokningstillfälle som heter "'+o.booking.Name+'". Två bokningstillfällen kan inte heta lika.'}:e.FlashMessage={type:"error",message:"Ett oväntat fel uppstod när bokningstillfället skulle sparas"}})}}]),angular.module("BookingSystem.resourceBooking",["ngMessages"]).controller("ResourceBookingViewCtrl",["$rootScope","$scope","$state","ResourceBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM",function(e,o,t,n,r,i,a,s,u){var l=i,c=null,d=null,m=null;o.zoom=u,o.weekDate=moment();var g=function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];e>0?o.weekDate=moment(o.weekDate).add(1,"weeks"):0>e&&(o.weekDate=moment(o.weekDate).subtract(1,"weeks")),d=moment(o.weekDate).startOf("week"),m=moment(o.weekDate).endOf("week")},k=function(){var e=n.queryLessForPeriod({fromDate:d.format("YYYY-MM-DD"),toDate:m.format("YYYY-MM-DD")});e.$promise["catch"](function(){s.show(s.simple().content("Resursbokningar kunde inte hämtas, var god försök igen.").position("top right"))}).then(function(e){o.resourceBookings=e})},p=function(){c=r(function(){k()},l)},f=function(){var e=angular.element(document.querySelector("#booking-view-content"));a.on("pinch",function(e){e.gesture.srcEvent.preventDefault(),o.$apply(function(){o.zoom=e.gesture.scale})},e),a.on("swipeleft",function(e){o.toNextWeek(),o.$apply(),o.$broadcast("swipe-occurred")},e),a.on("swiperight",function(e){o.toPreviousWeek(),o.$apply(),o.$broadcast("swipe-occurred")},e)};o.toNextWeek=function(){g(1),k()},o.toPreviousWeek=function(){g(-1),k()},o.$on("$ionicView.enter",function(e,o){g(),k(),p()}),o.$on("$ionicView.loaded",function(e,o){f()}),o.$on("$ionicView.leave",function(e){c&&r.cancel(c),o.$broadcast("leaving-view")})}]).controller("ResourceBookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","ResourceBooking","$mdToast","Resource","Customer","BookingHelper","$q","$ionicHistory",function(e,o,t,n,r,i,a,s,u,l,c,d,m){var g="templates/modals/resource-booking-delete.html";o.editMode=!1,o.resourceBookingBackup={};var k=function(){i.fromTemplateUrl(g,{scope:o,animation:n}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()})},p=function(){var e=a.get({resourceBookingId:t.id});return e.$promise["catch"](function(){s.show(s.simple().content("Resursbokning kunde inte hämtas, var god försök igen.").position("top right"))}),o.resourceBooking=e,e.$promise},f=function(){var e=o.resourceBooking.StartTime,t=o.resourceBooking.EndTime;
o.bookingStartDate=moment(e).toDate(),o.bookingStartHour=moment(e).hour(),o.bookingStartMinute=moment(e).minute(),o.bookingEndDate=moment(t).toDate(),o.bookingEndHour=moment(t).hour(),o.bookingEndMinute=moment(t).minute()},h=function(){return"undefined"!=typeof o.bookingStartDate&&"undefined"!=typeof o.bookingStartHour&&"undefined"!=typeof o.bookingStartMinute&&"undefined"!=typeof o.bookingEndDate&&"undefined"!=typeof o.bookingEndHour&&"undefined"!=typeof o.bookingEndMinute},y=function(){o.selectHours=c.getHoursForSelect(),o.selectMinutes=c.getMinutesForSelect()},b=function(){if(h()){var e=M(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute),t=M(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute);u.queryFreeForPeriod({fromDate:e.format("YYYY-MM-DD"),fromTime:e.format("HH:mm"),toDate:t.format("YYYY-MM-DD"),toTime:t.format("HH:mm"),resourceBookingExceptionId:o.resourceBooking.ResourceBookingId}).$promise.then(function(e){o.resources=e,o.setSelectedResourceFromId(o.resourceBooking.ResourceId)})["catch"](function(e){s.show(s.simple().content("Ett oväntat fel uppstod när uppgifter om lediga resurser skulle hämtas").position("top right"))})}},v=function(){var e=l.query();e.$promise["catch"](function(){s.show(s.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right"))}),o.customers=e},M=function(e,o,t){return moment(e).hour(o).minute(t)};o.startEditMode=function(){var e=this;e.isEditMode=!0,e.resourceBookingBackup=angular.copy(e.resourceBooking)},o.endEditMode=function(){var e=this;e.isEditMode=!1},o.abortEditMode=function(){var e=this;e.isEditMode=!1,e.resourceBooking=e.resourceBookingBackup},o.deleteResourceBooking=function(){a["delete"]({resourceBookingId:t.id}).$promise.then(function(e){s.show(s.simple().content("Resursbokningen raderades med ett lyckat resultat").position("top right")),history.back()})["catch"](function(e){400!==e.status&&500!==e.status||s.show(s.simple().content("Ett oväntat fel uppstod när Resursbokningen skulle tas bort").position("top right")),404===e.status&&s.show(s.simple().content("Resursbokningen existerar inte längre. Hann kanske någon radera den?").position("top right")),history.back()})},o.checkEndDate=function(){if(h()){var e=M(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute).toDate().getTime(),t=M(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute).toDate().getTime();e>t&&(o.bookingEndDate=o.bookingStartDate,o.bookingEndHour=o.bookingStartHour,o.bookingEndMinute=o.bookingStartMinute+15),b()}},o.saveResourceBooking=function(){var e=this,o=d.defer(),t=o.promise;return a.save({BookingId:e.resourceBooking.BookingId,ResourceBookingId:e.resourceBooking.ResourceBookingId,ResourceId:e.resourceBooking.ResourceId,ResourceCount:e.resourceBooking.ResourceCount,StartTime:M(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).format(),EndTime:M(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).format(),Provisional:e.resourceBooking.Provisional}).$promise.then(function(e){s.show(s.simple().content("Resursbokningen sparades med ett lyckat resultat").position("top right")),o.resolve(),m.goBack()})["catch"](function(e){409===e.status?s.show(s.simple().content("Resursen är tyvärr redan bokad under vald tidsram.").position("top right")):s.show(s.simple().content("Ett oväntat fel uppstod när resursbokningen skulle sparas").position("top right"))}),t},o.setSelectedResourceFromId=function(e){o.selectedResource=o.resources.find(function(o){return o.ResourceId===Number(e)})},k(),p().then(function(){f(),b()}),v(),y()}]).controller("ResourceBookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","ResourceBooking","Resource","BookingHelper","Customer","$q","$mdToast","$ionicHistory",function(e,o,t,n,r,i,a,s,u,l,c){t.resourceBooking={Provisional:!0,BookingTypeId:1};var d=function(){n.params.date?(t.bookingStartDate=moment(n.params.date).toDate(),t.bookingStartHour=moment(n.params.date).hour(),t.bookingStartMinute=moment(n.params.date).minute(),t.bookingEndDate=moment(n.params.date).toDate(),t.bookingEndHour=moment(n.params.date).hour(),t.bookingEndMinute=moment(n.params.date).add(59,"minutes").minute()):(t.bookingStartDate=new Date,t.bookingStartHour=8,t.bookingStartMinute=0,t.bookingEndDate=new Date,t.bookingEndHour=8,t.bookingEndMinute=59)},m=function(){return"undefined"!=typeof t.bookingStartDate&&"undefined"!=typeof t.bookingStartHour&&"undefined"!=typeof t.bookingStartMinute&&"undefined"!=typeof t.bookingEndDate&&"undefined"!=typeof t.bookingEndHour&&"undefined"!=typeof t.bookingEndMinute},g=function(){t.selectHours=a.getHoursForSelect(),t.selectMinutes=a.getMinutesForSelect()},k=function(){if(m()){var e=f(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute),o=f(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute);i.queryFreeForPeriod({fromDate:e.format("YYYY-MM-DD"),fromTime:e.format("HH:mm"),toDate:o.format("YYYY-MM-DD"),toTime:o.format("HH:mm")}).$promise.then(function(e){t.resources=e})["catch"](function(e){l.show(l.simple().content("Ett oväntat fel uppstod när uppgifter om lediga resurser skulle hämtas").position("top right"))})}},p=function(){var e=s.query();e.$promise["catch"](function(){l.show(l.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right"))}),t.customers=e},f=function(e,o,t){return moment(e).hour(o).minute(t)},h=function(){var e=u.defer();return a.createBookingContainer(t.resourceBooking).then(function(o){t.resourceBooking.BookingId=o.BookingId,e.resolve()})["catch"](function(o){l.show(l.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle sparas").position("top right")),e.reject()}),e.promise};t.checkEndDate=function(){if(m()){var e=f(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute).toDate().getTime(),o=f(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute).toDate().getTime();e>o&&(t.bookingEndDate=t.bookingStartDate,t.bookingEndHour=t.bookingStartHour,t.bookingEndMinute=t.bookingStartMinute+15),k()}},t.saveResourceBooking=function(){var e=this,o=u.defer(),t=o.promise;return h().then(function(){r.save({BookingId:e.resourceBooking.BookingId,ResourceBookingId:0,ResourceId:e.resourceBooking.Resource.ResourceId,ResourceCount:e.resourceBooking.ResourceCount,StartTime:f(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).format(),EndTime:f(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).format()}).$promise.then(function(e){l.show(l.simple().content(" Resursbokningen skapades med ett lyckat resultat").position("top right")),o.resolve(),c.goBack()})["catch"](function(e){409===e.status?l.show(l.simple().content("Resursen är tyvärr redan bokad under vald tidsram.").position("top right")):l.show(l.simple().content("Ett oväntat fel uppstod när resursbokningen skulle sparas").position("top right"))})}),t},d(),k(),p(),g()}]),angular.module("BookingSystem.resourceBookingServices",["ngResource"]).factory("ResourceBooking",["$resource","API_URL",function(e,o){return e(o+"ResourceBooking/:resourceBookingId",{resourceBookingId:"@resourceBookingId"},{queryLessForPeriod:{url:o+"ResourceBooking/period/:fromDate/:toDate/less",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},queryMoreForPeriod:{url:o+"ResourceBooking/period/:fromDate/:toDate/more",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}}})}]),angular.module("BookingSystem.calendarDaysHeaderDirective",[]).controller("CalendarDaysHeaderCtrl",["$rootScope","$scope",function(e,o){o.days=[];var t=function(){o.weekDateStart=moment(o.date).startOf("isoWeek");for(var e=0,t=moment(o.weekDateStart);7>e;t.add(1,"days"))o.days[e]={},o.days[e].isCurrentDay=moment().format("YYYY-MM-DD")===t.format("YYYY-MM-DD"),o.days[e].dayNumber=t.format("D"),o.days[e].dayName=t.format("ddd"),e++};o.$watch("date",function(e,o){t()})}]).directive("calendarDaysHeader",[function(){return{restrict:"E",replace:!0,templateUrl:function(e,o){return"templates/directives/calendar-days-header.html"},scope:{date:"="},controller:"CalendarDaysHeaderCtrl"}}]),angular.module("BookingSystem.start",["ngMessages"]).controller("StartViewCtrl",["$rootScope","$scope","$state","Booking","LocationBooking","ResourceBooking","MealBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM","$stateParams","$ionicHistory",function(e,o,t,n,r,i,a,s,u,l,c,d,m,g){var k=u,p=null,f=null,h=null;o.zoom=d,o.weekDate=moment(),o.bookingsType=m.bookingType,o.bookingTypes={booking:"booking",location:"location-booking",resource:"resource-booking",meal:"meal-booking"};var y=function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];e>0?o.weekDate=moment(o.weekDate).add(1,"weeks"):0>e&&(o.weekDate=moment(o.weekDate).subtract(1,"weeks")),f=moment(o.weekDate).startOf("week"),h=moment(o.weekDate).endOf("week")},b=function(){switch(o.bookingsType){case o.bookingTypes.booking:o.calendarTitle="Bokningstillfällen";break;case o.bookingTypes.location:o.calendarTitle="Lokalbokningar";break;case o.bookingTypes.resource:o.calendarTitle="Resursbokningar";break;case o.bookingTypes.meal:o.calendarTitle="Måltidsbokningar";break;default:o.calendarTitle="Bokningstillfällen"}},v=function(){var e=void 0;switch(o.bookingsType){case o.bookingTypes.booking:e=n.queryLessForPeriod({fromDate:f.format("YYYY-MM-DD"),toDate:h.format("YYYY-MM-DD")});break;case o.bookingTypes.location:e=r.queryLessForPeriod({fromDate:f.format("YYYY-MM-DD"),toDate:h.format("YYYY-MM-DD")});break;case o.bookingTypes.resource:e=i.queryLessForPeriod({fromDate:f.format("YYYY-MM-DD"),toDate:h.format("YYYY-MM-DD")});break;case o.bookingTypes.meal:e=a.queryLessForPeriod({fromDate:f.format("YYYY-MM-DD"),toDate:h.format("YYYY-MM-DD")});break;default:e={}}e.$promise["catch"](function(){c.show(c.simple().content("Bokningar kunde inte hämtas, var god försök igen.").position("top right"))}).then(function(e){o.bookings=e})},M=function(){p=s(function(){v()},k)},B=function(){var e=angular.element(document.querySelector("#booking-view-content"));l.on("pinch",function(e){e.gesture.srcEvent.preventDefault(),o.$apply(function(){o.zoom=e.gesture.scale})},e),l.on("swipeleft",function(e){o.toNextWeek(),o.$apply(),o.$broadcast("swipe-occurred")},e),l.on("swiperight",function(e){o.toPreviousWeek(),o.$apply(),o.$broadcast("swipe-occurred")},e)};o.toNextWeek=function(){y(1),v()},o.toPreviousWeek=function(){y(-1),v()},o.changeBookingTypeTo=function(e){g.nextViewOptions({disableAnimate:!0,disableBack:!0}),t.go("app.start",{bookingType:e})},o.$on("$ionicView.enter",function(e,o){y(),v(),M(),b()}),o.$on("$ionicView.loaded",function(e,o){B()}),o.$on("$ionicView.leave",function(e){p&&s.cancel(p),o.$broadcast("leaving-view")})}]),angular.module("BookingSystem.mealBookingServices",["ngResource"]).factory("MealBooking",["$resource","API_URL",function(e,o){return e(o+"MealBooking/:mealBookingId",{mealBookingId:"@mealBookingId"},{queryLessForPeriod:{url:o+"MealBooking/period/:fromDate/:toDate/less",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},queryMoreForPeriod:{url:o+"MealBooking/period/:fromDate/:toDate/more",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}}})}]),angular.module("BookingSystem.mealBooking",["ngMessages"]).controller("MealBookingViewCtrl",["$rootScope","$scope","$state","MealBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM",function(e,o,t,n,r,i,a,s,u){var l=i,c=null,d=null,m=null;o.zoom=u,o.weekDate=moment();var g=function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];e>0?o.weekDate=moment(o.weekDate).add(1,"weeks"):0>e&&(o.weekDate=moment(o.weekDate).subtract(1,"weeks")),d=moment(o.weekDate).startOf("week"),m=moment(o.weekDate).endOf("week")},k=function(){var e=n.queryLessForPeriod({fromDate:d.format("YYYY-MM-DD"),toDate:m.format("YYYY-MM-DD")});e.$promise["catch"](function(){s.show(s.simple().content("Måltidsbokningar kunde inte hämtas, var god försök igen.").position("top right"))}).then(function(e){o.mealBookings=e})},p=function(){c=r(function(){k()},l)},f=function(){var e=angular.element(document.querySelector("#booking-view-content"));a.on("pinch",function(e){e.gesture.srcEvent.preventDefault(),o.$apply(function(){o.zoom=e.gesture.scale})},e),a.on("swipeleft",function(e){o.toNextWeek(),o.$apply(),o.$broadcast("swipe-occurred")},e),a.on("swiperight",function(e){o.toPreviousWeek(),o.$apply(),o.$broadcast("swipe-occurred")},e)};o.toNextWeek=function(){g(1),k()},o.toPreviousWeek=function(){g(-1),k()},o.$on("$ionicView.enter",function(e,o){g(),k(),p()}),o.$on("$ionicView.loaded",function(e,o){f()}),o.$on("$ionicView.leave",function(e){c&&r.cancel(c),o.$broadcast("leaving-view")})}]).controller("MealBookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","MealBooking","$mdToast","Meal","Customer","BookingHelper","$q","$ionicHistory","Location",function(e,o,t,n,r,i,a,s,u,l,c,d,m,g){var k="templates/modals/meal-booking-delete.html";o.editMode=!1,o.mealBookingBackup={};var p=function(){i.fromTemplateUrl(k,{scope:o,animation:n}).then(function(e){o.modal=e}),o.$on("$destroy",function(){o.modal.remove()})},f=function(){var e=a.get({mealBookingId:t.id});return e.$promise["catch"](function(){s.show(s.simple().content("Måltidsbokning kunde inte hämtas, var god försök igen.").position("top right"))}),o.mealBooking=e,e.$promise},h=function(){var e=o.mealBooking.StartTime,t=o.mealBooking.EndTime;o.bookingStartDate=moment(e).toDate(),o.bookingStartHour=moment(e).hour(),o.bookingStartMinute=moment(e).minute(),o.bookingEndDate=moment(t).toDate(),o.bookingEndHour=moment(t).hour(),o.bookingEndMinute=moment(t).minute()},y=function(){return"undefined"!=typeof o.bookingStartDate&&"undefined"!=typeof o.bookingStartHour&&"undefined"!=typeof o.bookingStartMinute&&"undefined"!=typeof o.bookingEndDate&&"undefined"!=typeof o.bookingEndHour&&"undefined"!=typeof o.bookingEndMinute},b=function(){o.selectHours=c.getHoursForSelect(),o.selectMinutes=c.getMinutesForSelect()},v=function(){g.query().$promise.then(function(e){o.locations=e})["catch"](function(e){s.show(s.simple().content("Ett oväntat fel uppstod när lokaler skulle hämtas").position("top right"))})},M=function(){return o.meals=u.query(),u.query().$promise.then(function(e){o.meals=e})["catch"](function(e){s.show(s.simple().content("Ett oväntat fel uppstod när uppgifter om måltider skulle hämtas").position("top right"))}),u.query().$promise},B=function(){var e=l.query();return e.$promise["catch"](function(){s.show(s.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right"))}),o.customers=e,e.$promise},D=function(e,o,t){return moment(e).hour(o).minute(t)};o.startEditMode=function(){var e=this;e.isEditMode=!0,e.mealBookingBackup=angular.copy(e.mealBooking)},o.endEditMode=function(){var e=this;e.isEditMode=!1},o.abortEditMode=function(){var e=this;e.isEditMode=!1,e.mealBooking=e.mealBookingBackup},o.deleteMealBooking=function(){a["delete"]({mealBookingId:t.id}).$promise.then(function(e){s.show(s.simple().content("Måltidsbokningen raderades med ett lyckat resultat").position("top right")),history.back()})["catch"](function(e){400!==e.status&&500!==e.status||s.show(s.simple().content("Ett oväntat fel uppstod när Måltidsbokningen skulle tas bort").position("top right")),404===e.status&&s.show(s.simple().content("Måltidsbokningen existerar inte längre. Hann kanske någon radera den?").position("top right")),history.back()})},o.checkEndDate=function(){if(y()){var e=D(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute).toDate().getTime(),t=D(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute).toDate().getTime();e>t&&(o.bookingEndDate=o.bookingStartDate,o.bookingEndHour=o.bookingStartHour,o.bookingEndMinute=o.bookingStartMinute+15),M()}},o.saveMealBooking=function(){var e=this,o=d.defer(),t=o.promise;return a.save({BookingId:e.mealBooking.BookingId,MealBookingId:e.mealBooking.MealBookingId,MealId:e.mealBooking.MealId,StartTime:D(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).format(),EndTime:D(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).format(),NumberOfPeople:e.mealBooking.NumberOfPeople,Provisional:e.mealBooking.Provisional,LocationId:e.mealBooking.LocationId,DeliveryAddress:e.mealBooking.DeliveryAddress,MealCount:e.mealBooking.MealCount,Notes:e.mealBooking.Notes}).$promise.then(function(e){s.show(s.simple().content("Måltidsbokningen sparades med ett lyckat resultat").position("top right")),o.resolve(),m.goBack()})["catch"](function(e){s.show(s.simple().content("Ett oväntat fel uppstod när lokal/plats-bokningen skulle sparas").position("top right"))}),t},p(),f().then(function(){return h(),M()}).then(function(){return B()}).then(function(){v(),b()})}]).controller("MealBookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","MealBooking","Meal","BookingHelper","Customer","$q","$mdToast","$ionicHistory","Location",function(e,o,t,n,r,i,a,s,u,l,c,d){t.mealBooking={Provisional:!0,BookingTypeId:1};var m=function(){n.params.date?(t.bookingStartDate=moment(n.params.date).toDate(),t.bookingStartHour=moment(n.params.date).hour(),t.bookingStartMinute=moment(n.params.date).minute(),t.bookingEndDate=moment(n.params.date).toDate(),t.bookingEndHour=moment(n.params.date).hour(),t.bookingEndMinute=moment(n.params.date).add(59,"minutes").minute()):(t.bookingStartDate=new Date,t.bookingStartHour=8,t.bookingStartMinute=0,t.bookingEndDate=new Date,t.bookingEndHour=8,t.bookingEndMinute=59)},g=function(){return"undefined"!=typeof t.bookingStartDate&&"undefined"!=typeof t.bookingStartHour&&"undefined"!=typeof t.bookingStartMinute&&"undefined"!=typeof t.bookingEndDate&&"undefined"!=typeof t.bookingEndHour&&"undefined"!=typeof t.bookingEndMinute},k=function(){t.selectHours=a.getHoursForSelect(),t.selectMinutes=a.getMinutesForSelect()},p=function(){var e=d.query();return e.$promise.then(function(e){t.locations=e})["catch"](function(e){l.show(l.simple().content("Ett oväntat fel uppstod när lokaler skulle hämtas").position("top right"))}),e.$promise},f=function(){return t.meals=i.query(),t.meals.$promise.then(function(e){t.meals=e})["catch"](function(e){l.show(l.simple().content("Ett oväntat fel uppstod när uppgifter om måltider skulle hämtas").position("top right"))}),t.meals.$promise},h=function(){var e=s.query();return e.$promise["catch"](function(){l.show(l.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right"))}),t.customers=e,e.$promise},y=function(e,o,t){return moment(e).hour(o).minute(t)},b=function(){var e=u.defer();return a.createBookingContainer(t.mealBooking).then(function(o){t.mealBooking.BookingId=o.BookingId,e.resolve()})["catch"](function(o){l.show(l.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle sparas").position("top right")),e.reject()}),e.promise};t.checkEndDate=function(){if(g()){var e=y(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute).toDate().getTime(),o=y(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute).toDate().getTime();e>o&&(t.bookingEndDate=t.bookingStartDate,t.bookingEndHour=t.bookingStartHour,t.bookingEndMinute=t.bookingStartMinute+15),f()}},t.saveMealBooking=function(){var e=this,o=u.defer(),t=o.promise;return b().then(function(){r.save({BookingId:e.mealBooking.BookingId,MealBookingId:0,MealId:e.mealBooking.MealId,StartTime:y(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).format(),EndTime:y(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).format(),LocationId:e.mealBooking.LocationId,DeliveryAddress:e.mealBooking.DeliveryAddress,MealCount:e.mealBooking.MealCount,Provisional:e.mealBooking.Provisional,Notes:e.mealBooking.Notes}).$promise.then(function(e){l.show(l.simple().content("Måltidsbokningen skapades med ett lyckat resultat").position("top right")),o.resolve(),c.goBack()})["catch"](function(e){l.show(l.simple().content("Ett oväntat fel uppstod när måltidsbokningen skulle sparas").position("top right"))})}),t},m(),f().then(function(){return h()}).then(function(){p(),k()})}]);