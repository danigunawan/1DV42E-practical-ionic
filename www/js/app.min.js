"use strict";var BookingSystem=angular.module("BookingSystem",["ionic","ngMaterial","ngResource","ngMessages","BookingSystem.start","BookingSystem.routes","BookingSystem.constants","BookingSystem.ngMaterialSettings","BookingSystem.httpSettings","BookingSystem.meals","BookingSystem.resources","BookingSystem.bookings","BookingSystem.locations","BookingSystem.furnituring","BookingSystem.customers","BookingSystem.mealProperties","BookingSystem.locationBooking","BookingSystem.resourceBooking","BookingSystem.mealBooking","BookingSystem.bookingTypes","BookingSystem.users","BookingSystem.account","BookingSystem.authService","BookingSystem.furnituringServices","BookingSystem.mealsServices","BookingSystem.resourcesServices","BookingSystem.locationBookingServices","BookingSystem.mealPropertiesServices","BookingSystem.locationsServices","BookingSystem.customersServices","BookingSystem.bookingTypesServices","BookingSystem.imageResizeServices","BookingSystem.bookingHelperServices","BookingSystem.locationsServices","BookingSystem.bookingServices","BookingSystem.resourceBookingServices","BookingSystem.mealBookingServices","BookingSystem.usersServices","BookingSystem.accountServices","BookingSystem.calendarDaysHeaderDirective","BookingSystem.calendarWeekDirective","BookingSystem.imageUploaderDirective","BookingSystem.ngMinMaxDirectives","BookingSystem.calendarDayDirective","BookingSystem.imageShowOnLoadDirective","BookingSystem.filters"]);BookingSystem.run(["$ionicPlatform","$rootScope",function(e,t){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()}),moment.locale("sv"),t.TEXT_FIELD_REGEXP=/^[0-9a-zA-ZåäöÅÄÖé\-_&\.,~\^@()\/%\s\!]*$/,t.USERNAME_REGEXP=/^[0-9a-zA-Z\-_&\.,~\^@()\/%\s\!]*$/,t.NUMERIC_SPACE_REGEXP=/^[0-9\s\+\-]*$/,t.NUMERIC_STRICT_REGEXP=/^[0-9]*$/,t.NUMERIC_DOT_REGEXP=/^[0-9]*[\.]?[0-9]*?$/}]),BookingSystem.controller("NavigationCtrl",["$scope","$state","API_IMG_PATH_URL","AuthService",function(e,t,o,n){e.API_IMG_PATH_URL=o}]),angular.module("BookingSystem.routes",[]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(e,t,o){e.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html"}).state("app.start",{url:"/start",views:{menuContent:{templateUrl:"templates/start/start.html",controller:"StartViewCtrl"}}}).state("app.account",{cache:!1,url:"/account",views:{menuContent:{templateUrl:"templates/account/account.html",controller:"AccountCtrl"}}}).state("app.users-list",{url:"/user-list",views:{menuContent:{templateUrl:"templates/users/users-list.html",controller:"UsersListCtrl"}}}).state("app.user-details",{url:"/user-details/:userId",views:{menuContent:{templateUrl:"templates/users/user-details.html",controller:"UserDetailsCtrl"}}}).state("app.user-create",{cache:!1,url:"/user-create",views:{menuContent:{templateUrl:"templates/users/user-create.html",controller:"UserCreateCtrl"}}}).state("app.booking-details",{url:"/booking-details",params:{id:null},views:{menuContent:{templateUrl:"templates/booking/booking-details.html",controller:"BookingDetailsCtrl"}}}).state("app.booking-view",{url:"/booking-view",params:{bookingType:"booking",weekDate:null},views:{menuContent:{templateUrl:"templates/booking/booking-view.html",controller:"BookingViewCtrl"}}}).state("app.meal-booking-view",{url:"/meal-booking-view",views:{menuContent:{templateUrl:"templates/meal-booking/meal-booking-view.html",controller:"MealBookingViewCtrl"}}}).state("app.meal-booking-details",{url:"/meal-booking-details",params:{id:null},views:{menuContent:{templateUrl:"templates/meal-booking/meal-booking-details.html",controller:"MealBookingDetailsCtrl"}}}).state("app.meal-booking-create",{cache:!1,url:"/meal-booking-create",params:{date:null,bookingId:null,customerId:null},views:{menuContent:{templateUrl:"templates/meal-booking/meal-booking-create.html",controller:"MealBookingCreateCtrl"}}}).state("app.resource-booking-view",{url:"/resource-booking-view",views:{menuContent:{templateUrl:"templates/resource-booking/resource-booking-view.html",controller:"ResourceBookingViewCtrl"}}}).state("app.resource-booking-details",{url:"/resource-booking-details",params:{id:null},views:{menuContent:{templateUrl:"templates/resource-booking/resource-booking-details.html",controller:"ResourceBookingDetailsCtrl"}}}).state("app.resource-booking-create",{cache:!1,url:"/resource-booking-create",params:{date:null,bookingId:null,customerId:null},views:{menuContent:{templateUrl:"templates/resource-booking/resource-booking-create.html",controller:"ResourceBookingCreateCtrl"}}}).state("app.location-booking-view",{url:"/location-booking-view",views:{menuContent:{templateUrl:"templates/location-booking/location-booking-view.html",controller:"LocationBookingViewCtrl"}}}).state("app.location-booking-details",{url:"/location-booking-details",params:{id:null},views:{menuContent:{templateUrl:"templates/location-booking/location-booking-details.html",controller:"LocationBookingDetailsCtrl"}}}).state("app.location-booking-create",{cache:!1,url:"/location-booking-create",params:{date:null,bookingId:null,customerId:null},views:{menuContent:{templateUrl:"templates/location-booking/location-booking-create.html",controller:"LocationBookingCreateCtrl"}}}).state("app.furnituring-list",{url:"/furnituring-list",views:{menuContent:{templateUrl:"templates/furnituring/furnituring-list.html",controller:"FurnituringListCtrl"}}}).state("app.furnituring-details",{url:"/furnituring-details/:furnituringId",views:{menuContent:{templateUrl:"templates/furnituring/furnituring-details.html",controller:"FurnituringDetailsCtrl"}}}).state("app.furnituring-create",{cache:!1,url:"/furnituring-create",views:{menuContent:{templateUrl:"templates/furnituring/furnituring-create.html",controller:"FurnituringCreateCtrl"}}}).state("app.meal-properties-list",{url:"/meal-properties-list",views:{menuContent:{templateUrl:"templates/meal-properties/meal-properties-list.html",controller:"MealPropertyListCtrl"}}}).state("app.meal-property-details",{url:"/meal-property-details/:mealPropertyId",views:{menuContent:{templateUrl:"templates/meal-properties/meal-property-details.html",controller:"MealPropertyDetailsCtrl"}}}).state("app.meal-property-create",{cache:!1,url:"/meal-property-create",views:{menuContent:{templateUrl:"templates/meal-properties/meal-property-create.html",controller:"MealPropertyCreateCtrl"}}}).state("app.meals-list",{url:"/meals-list",views:{menuContent:{templateUrl:"templates/meals/meals-list.html",controller:"MealsListCtrl"}}}).state("app.meal-details",{url:"/meal-details/:mealId",views:{menuContent:{templateUrl:"templates/meals/meal-details.html",controller:"MealDetailsCtrl"}}}).state("app.meal-create",{cache:!1,url:"/meal-create",views:{menuContent:{templateUrl:"templates/meals/meal-create.html",controller:"MealCreateCtrl"}}}).state("app.resources-list",{url:"/resources-list",views:{menuContent:{templateUrl:"templates/resources/resources-list.html",controller:"ResourcesListCtrl"}}}).state("app.resource-details",{url:"/resource-details/:resourceId",views:{menuContent:{templateUrl:"templates/resources/resource-details.html",controller:"ResourceDetailsCtrl"}}}).state("app.resource-create",{cache:!1,url:"/resource-create",views:{menuContent:{templateUrl:"templates/resources/resource-create.html",controller:"ResourceCreateCtrl"}}}).state("app.customers-list",{url:"/customers-list",views:{menuContent:{templateUrl:"templates/customers/customers-list.html",controller:"CustomersListCtrl"}}}).state("app.customer-details",{url:"/customer-details/:customerId",views:{menuContent:{templateUrl:"templates/customers/customer-details.html",controller:"CustomerDetailsCtrl"}}}).state("app.customer-create",{cache:!1,url:"/customer-create",views:{menuContent:{templateUrl:"templates/customers/customer-create.html",controller:"CustomerCreateCtrl"}}}).state("app.bookingtypes-list",{url:"/bookingtypes-list",views:{menuContent:{templateUrl:"templates/bookingtypes/bookingtypes-list.html",controller:"BookingTypesListCtrl"}}}).state("app.bookingtype-details",{url:"/bookingtype-details/:bookingTypeId",views:{menuContent:{templateUrl:"templates/bookingtypes/bookingtype-details.html",controller:"BookingTypeDetailsCtrl"}}}).state("app.bookingtype-create",{cache:!1,url:"/bookingtype-create",views:{menuContent:{templateUrl:"templates/bookingtypes/bookingtype-create.html",controller:"BookingTypeCreateCtrl"}}}).state("app.locations-list",{url:"/locations-list",views:{menuContent:{templateUrl:"templates/locations/locations-list.html",controller:"LocationsListCtrl"}}}).state("app.location-details",{url:"/location-details/:locationId",views:{menuContent:{templateUrl:"templates/locations/location-details.html",controller:"LocationDetailsCtrl"}}}).state("app.location-create",{cache:!1,url:"/location-create",views:{menuContent:{templateUrl:"templates/locations/location-create.html",controller:"LocationCreateCtrl"}}}),t.otherwise("/app/start"),o.views.transition("none")}]),angular.module("BookingSystem.constants",[]).constant("API_URL","http://bokning.vvfors.se/api/").constant("API_LOGIN_URL","http://bokning.vvfors.se/Token").constant("API_LOGOUT_URL","http://bokning.vvfors.se/api/Account/Logout").constant("API_IMG_PATH_URL","http://bokning.vvfors.se/").constant("UPLOAD_IMG_MAX_WIDTH","300").constant("UPLOAD_IMG_MAX_HEIGHT","300").constant("PHOTO_MISSING_SRC","img/photo_missing.svg").constant("THUMBNAIL_EXTENSION","thumbnail").constant("DEFAULT_MAP_ZOOM",5).constant("DEFAULT_LATITUDE",67.2792).constant("DEFAULT_LONGITUDE",4.2361).constant("MODAL_ANIMATION","slide-in-up").constant("DATA_SYNC_INTERVAL_TIME",3e5).constant("DEFAULT_CALENDAR_ZOOM",2).constant("BOOKING_TYPES",{booking:"booking",location:"location-booking",resource:"resource-booking",meal:"meal-booking"}),angular.module("BookingSystem.ngMaterialSettings",["ngMaterial"]).config(["$mdDateLocaleProvider","$mdGestureProvider",function(e,t){e.months=["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],e.shortMonths=["jan","feb","mar","apr","maj","jun","jul","aug","sep","okt","nov","dec"],e.days=["söndag","måndag","tisdag","onsdag","torsdag","fredag","lördag"],e.shortDays=["Sö","Må","Ti","On","To","Fr","Lö"],e.firstDayOfWeek=1,e.parseDate=function(e){var t=moment(e,"L",!0);return t.isValid()?t.toDate():new Date(NaN)},e.formatDate=function(e){return moment(e).format("L")},e.monthHeaderFormatter=function(t){return e.shortMonths[t.getMonth()]+" "+t.getFullYear()},e.weekNumberFormatter=function(e){return"Vecka "+e},e.msgCalendar="Kalender",e.msgOpenCalendar="Öppna kalender"}]).config(["$mdGestureProvider",function(e){e.skipClickHijack()}]).config(["$mdThemingProvider",function(e){e.theme("warn"),e.theme("success")}]),angular.module("BookingSystem.httpSettings",[]).config(["$httpProvider",function(e){e.interceptors.push(["$q","$rootScope","$injector",function(e,t,o){return{request:function(e){var n=o.get("AuthService");return t.isLoading=!0,n.apiUrlEqualsUrl(e.url)&&(e.headers.Authorization=n.getAuthHeader()),e},requestError:function(e){return t.isLoading=!1,e},response:function(e){return t.isLoading=!1,e},responseError:function(n){var r=o.get("AuthService");return t.isLoading=!1,r.apiUrlEqualsUrl(n.config.url)&&401===n.status&&(r.clearCredentials(),t.isLoggedIn=!1,r.showLoginModal()),e.reject(n)}}}])}]),angular.module("BookingSystem.authService",["ngCookies"]).service("AuthService",["$q","$cookies","$timeout","$rootScope","API_URL","MODAL_ANIMATION","$injector","$http","Account","$state",function(e,t,o,n,r,i,a,s,u,c){var l="currentUser",m="templates/modals/login.html",d=this,p=null;this.showLoginModal=function(){if(void 0===n.loginModal||null===n.loginModal||void 0!==n.loginModal&&void 0!==n.loginModal.isShown&&!n.loginModal.isShown()){n.loginModal={};var e=a.get("$ionicModal");e.fromTemplateUrl(m,{scope:n,animation:i,backdropClickToClose:!1,hardwareBackButtonClose:!1}).then(function(e){n.loginModal=e,n.loginModal.show()}),n.$on("loginModal.hidden",function(){n.loginModal.remove()}),n.$on("loginModal.removed",function(){n.loginModal=null})}},this.login=function(e,t){return u.login(e,t)},this.logout=function(){var e=u.logout();return e.then(function(){d.clearCredentials()}),e},this.isLoggedInCheck=function(){var e=void 0!==t.get(l);return n.isLoggedIn!==e&&(n.isLoggedIn=e),e},this.setCredentials=function(e){p=e,d.setRootScopeUserInfo(p),t.putObject(l,e)},this.getCredentials=function(){return null===p&&(p=t.getObject(l),p&&d.setRootScopeUserInfo(p)),p},this.setRootScopeUserInfo=function(e){n.userInfo={id:e.id,userName:e.userName,firstName:e.firstName,surName:e.surName,imageSrc:e.imageSrc,emailAddress:e.emailAddress}},this.getAuthHeader=function(){var e=!1,t=new Date,o=d.getCredentials();if(o){var n=new Date(o.expires);void 0!==o.token&&n>t?e="Bearer "+o.token:d.clearCredentials()}return e},this.clearCredentials=function(){p=null,n.userInfo=null,t.remove(l)},this.apiUrlEqualsUrl=function(e){var t=void 0,o=void 0,n=void 0,i=e.split("/");return i.length>2?(t=r.split("/"),n=i[0]+i[2]+i[3],o=t[0]+t[2]+t[3],n===o):!1},n.loginFromModal=function(e,t){var o=a.get("$mdToast");d.login(e,t).then(function(e){n.loginModal.hide(),o.show(o.simple().content("Du är nu inloggad").position("top right")),d.setCredentials({id:e.data.Id,userName:e.data.UserName,firstName:e.data.FirstName,surName:e.data.SurName,imageSrc:e.data.ImageSrc,emailAddress:e.data.EmailAddress,token:e.data.access_token,expires:e.data[".expires"]}),c.go("app.start")})["catch"](function(e){"invalid_grant"===e.data.error?o.show(o.simple().content("Felaktigt användarnamn eller lösenord").position("top right").theme("warn")):"account_locked"===e.data.error&&o.show(o.simple().content("Du har gjort för många felaktiga inloggningar. Kontot är spärrat till och med "+e.data.error_description).position("top right").theme("warn"))})},n.abortLoginFromModal=function(){n.loginModal.hide(),c.go("app.start")},n.logout=function(){var e=a.get("$mdToast");d.logout().then(function(){c.go("app.start"),e.show(e.simple().content("Du är nu utloggad").position("top right"))})},n.showLogin=function(){d.showLoginModal()},d.getCredentials()}]),angular.module("BookingSystem.furnituringServices",["ngResource"]).factory("Furnituring",["$resource","API_URL",function(e,t){return e(t+"Furnituring/:furnituringId",{furnituringId:"@furnituringId"})}]).factory("LocationFurnituring",["$resource","API_URL",function(e,t){return e(t+"LocationFurnituring/:locationId",{locationId:"@locationId"},{remove:{url:t+"LocationFurnituring/:locationId/:furnituringId",id:"@id",method:"DELETE",isArray:!1,params:{locationId:"@locationId",furnituringId:"@furnituringId"}},removeForLocation:{url:t+"LocationFurnituring/:locationId",id:"@id",method:"DELETE",isArray:!1,params:{locationId:"@locationId"}},queryForLocation:{url:t+"LocationFurnituring/location/:locationId",id:"@id",method:"GET",isArray:!0,params:{locationId:"@locationId"}},saveForLocation:{url:t+"LocationFurnituring/location",id:"@id",method:"POST",isArray:!0}})}]),angular.module("BookingSystem.mealPropertiesServices",["ngResource","BookingSystem.mealsServices"]).factory("MealProperty",["$resource","API_URL",function(e,t){return e(t+"MealProperty/:mealPropertyId",{mealPropertyId:"@mealPropertyId"})}]).factory("MealHasProperty",["$resource","API_URL",function(e,t){return e(t+"MealHasProperty/:mealPropertyId/:mealId",{mealPropertyId:"@mealPropertyId"},{remove:{url:t+"MealHasProperty/:mealPropertyId/:mealId",id:"@id",method:"DELETE",isArray:!1,params:{mealPropertyId:"@mealPropertyId",mealId:"@mealId"}},removeForMeal:{url:t+"MealHasProperty/:mealId",id:"@id",method:"DELETE",isArray:!1,params:{mealId:"@mealId"}},queryForMeal:{url:t+"MealHasProperty/meal/:mealId",id:"@id",method:"GET",isArray:!0,params:{mealPropertyId:"@mealId"}},saveForMeal:{url:t+"MealHasProperty/meal",id:"@id",method:"POST",isArray:!0}})}]),angular.module("BookingSystem.resourcesServices",["ngResource"]).factory("Resource",["$resource","API_URL",function(e,t){return e(t+"Resource/:resourceId",{resourceId:"@resourceId"},{queryFreeForPeriod:{url:t+"Resource/free/:fromDate/:toDate/:resourceBookingId",id:"@id",method:"GET",isArray:!0,params:{resourceBookingId:"@resourceBookingId",fromDate:"@fromDate",toDate:"@toDate"}}})}]).factory("ResourceImage",["$http","API_URL",function(e,t){return{upload:function(o,n){return e({method:"POST",url:t+"Resource/image/"+n,data:o,headers:{"Content-Type":void 0}})}}}]),angular.module("BookingSystem.customersServices",["ngResource"]).factory("Customer",["$resource","API_URL",function(e,t){return e(t+"Customer/:customerId",{customerId:"@customerId"})}]).factory("CustomerImage",["$http","API_URL",function(e,t){return{upload:function(o,n){return e({method:"POST",url:t+"Customer/image/"+n,data:o,headers:{"Content-Type":void 0}})}}}]),angular.module("BookingSystem.mealsServices",["ngResource"]).factory("Meal",["$resource","API_URL",function(e,t){return e(t+"Meal/:mealId",{mealId:"@mealId"})}]).factory("MealImage",["$http","API_URL",function(e,t){return{upload:function(o,n){return e({method:"POST",url:t+"Meal/image/"+n,data:o,headers:{"Content-Type":void 0}})}}}]).factory("MealHasPropertyHelper",["MealHasProperty","MealProperty",function(e,t){return{getCombined:function(o){var n=t.query(),r=e.queryForMealProperty({mealPropertyId:mealPropertyId});return n.$promise["finally"](function(){r.$promise["finally"](function(){n.forEach(function(e){var t=!1,o=void 0;for(o=0;o<r.length;o++)if(e.MealPropertyId===r[o].MealPropertyId){e.Selected=!0,t=!0;break}t||(e.Selected=!1)})})}),n}}}]),angular.module("BookingSystem.locationsServices",["ngResource"]).factory("Location",["$resource","API_URL",function(e,t){return e(t+"Location/:locationId",{locationId:"@locationId"},{queryFreeForPeriod:{url:t+"Location/free/:fromDate/:toDate/:locationBookingId",id:"@id",method:"GET",isArray:!0,params:{locationBookingId:"@locationBookingId",fromDate:"@fromDate",toDate:"@toDate"}},querySearch:{url:t+"Location/search/:column",id:"@id",method:"GET",isArray:!0,params:{column:"@column"}}})}]).factory("LocationImage",["$http","API_URL",function(e,t){return{upload:function(o,n){return e({method:"POST",url:t+"Location/image/"+n,data:o,headers:{"Content-Type":void 0}})}}}]),angular.module("BookingSystem.locationBookingServices",["ngResource"]).factory("LocationBooking",["$resource","API_URL",function(e,t){return e(t+"LocationBooking/:locationBookingId",{locationBookingId:"@locationBookingId"},{queryLessForPeriod:{url:t+"LocationBooking/period/:fromDate/:toDate/less",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},queryMoreForPeriod:{url:t+"LocationBooking/period/:fromDate/:toDate/more",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}}})}]),angular.module("BookingSystem.bookingTypesServices",["ngResource"]).factory("BookingType",["$resource","API_URL",function(e,t){return e(t+"BookingType/:bookingTypeId",{bookingTypeId:"@bookingTypeId"})}]),angular.module("BookingSystem.bookingHelperServices",[]).factory("BookingHelper",["$q","Booking",function(e,t){var o=function(e,t,o,n){return e=moment(e),t=moment(t),o=moment(o),n=moment(n),e.isBefore(n)&&t.isAfter(n)||e.isBefore(o)&&t.isAfter(o)||e.isSameOrAfter(o)&&t.isSameOrBefore(n)},n=function(e,t){var n=[],r=0,i=void 0;for(i=0;i<t.length;i++)o(e.StartTime,e.EndTime,t[i].StartTime,t[i].EndTime)&&n.push(t[i]);e.ConcurrentBookings=n.length,n.length&&(n.sort(function(e,t){return e.StartTime>=t.StartTime&&e.EndTime<=t.EndTime}),r=n.findIndex(function(t){return e.Id===t.Id})),e.ConcurrentBookingIndex=r},r=function(){for(var e=[],t=0;23>=t;t++)e.push(t);return e},i=function(){for(var e=[],t=0;59>=t;t++)e.push(t);return e},a=function(e){return t.save({BookingId:0,Name:"",BookingTypeId:e.BookingTypeId,CustomerId:e.CustomerId,Provisional:1,NumberOfPeople:e.NumberOfPeople||0,Discount:0,CreatedByUserId:1,ModifiedByUserId:1,ResponsibleUserId:1}).$promise};return{doBookingsCollide:o,setConcurrentBookingData:n,getHoursForSelect:r,getMinutesForSelect:i,createBookingContainer:a}}]),angular.module("BookingSystem.bookingServices",["ngResource"]).factory("Booking",["$resource","API_URL",function(e,t){return e(t+"Booking/:bookingId",{bookingId:"@bookingId"},{queryLessForPeriod:{url:t+"Booking/period/:fromDate/:toDate/less",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},queryMoreForPeriod:{url:t+"Booking/period/:fromDate/:toDate/more",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},countEmpty:{url:t+"Booking/empty/count",id:"@id",method:"GET",isArray:!1},queryEmpty:{url:t+"Booking/empty/info",id:"@id",method:"GET",isArray:!0},querySearch:{url:t+"Booking/search/:column",id:"@id",method:"GET",isArray:!0,params:{column:"@column"}}})}]),angular.module("BookingSystem.resourceBookingServices",["ngResource"]).factory("ResourceBooking",["$resource","API_URL",function(e,t){return e(t+"ResourceBooking/:resourceBookingId",{resourceBookingId:"@resourceBookingId"},{queryLessForPeriod:{url:t+"ResourceBooking/period/:fromDate/:toDate/less",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},queryMoreForPeriod:{url:t+"ResourceBooking/period/:fromDate/:toDate/more",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}}})}]),angular.module("BookingSystem.mealBookingServices",["ngResource"]).factory("MealBooking",["$resource","API_URL",function(e,t){return e(t+"MealBooking/:mealBookingId",{mealBookingId:"@mealBookingId"},{queryLessForPeriod:{url:t+"MealBooking/period/:fromDate/:toDate/less",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}},queryMoreForPeriod:{url:t+"MealBooking/period/:fromDate/:toDate/more",id:"@id",method:"GET",isArray:!0,params:{fromDate:"@fromDate",toDate:"@toDate"}}})}]),angular.module("BookingSystem.imageResizeServices",[]).factory("ImageResize",["UPLOAD_IMG_MAX_WIDTH","UPLOAD_IMG_MAX_HEIGHT","$q",function(e,t,o){var n=void 0,r=void 0,i=void 0,a=void 0,s=function(e){var t=document.createElement("canvas");return t.width=e.width/2,t.height=e.height/2,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t},u=function(e,t,o){function n(e,t,o,n,r,i){var a=1-r,s=1-i;return e*a*s+t*r*s+o*a*i+n*r*i}var r=void 0,i=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,m=void 0,d=void 0,p=void 0,g=void 0,f=void 0,k=void 0,h=void 0,v=void 0,b=void 0,y=void 0,M=void 0,I=void 0;for(r=0;r<t.height;++r)for(a=r/o,s=Math.floor(a),u=Math.ceil(a)>e.height-1?e.height-1:Math.ceil(a),i=0;i<t.width;++i)c=i/o,l=Math.floor(c),m=Math.ceil(c)>e.width-1?e.width-1:Math.ceil(c),d=4*(i+t.width*r),p=4*(l+e.width*s),g=4*(m+e.width*s),f=4*(l+e.width*u),k=4*(m+e.width*u),h=c-l,v=a-s,b=n(e.data[p],e.data[g],e.data[f],e.data[k],h,v),t.data[d]=b,y=n(e.data[p+1],e.data[g+1],e.data[f+1],e.data[k+1],h,v),t.data[d+1]=y,M=n(e.data[p+2],e.data[g+2],e.data[f+2],e.data[k+2],h,v),t.data[d+2]=M,I=n(e.data[p+3],e.data[g+3],e.data[f+3],e.data[k+3],h,v),t.data[d+3]=I},c=function(o){var n=void 0;return n=o.width>o.height?e/o.width:t/o.height},l=function(e){var t=document.createElement("canvas"),o=c(e);t.width=e.width*o,t.height=e.height*o;var n=e.getContext("2d").getImageData(0,0,e.width,e.height),r=t.getContext("2d").createImageData(t.width,t.height);return u(n,r,o),t.getContext("2d").putImageData(r,0,0),t};return{scaleImage:function(u){return n=document.createElement("img"),r=document.createElement("canvas"),i=o.defer(),n.src=u,n.onload=function(){for(r.width=n.width,r.height=n.height,r.getContext("2d").drawImage(n,0,0,r.width,r.height);r.width>=2*e;)r=s(r);(r.width>e||r.height>t)&&(r=l(r)),a=r.toDataURL("image/jpeg",1),i.resolve(a)},i.promise}}}]),angular.module("BookingSystem.usersServices",["ngResource"]).factory("User",["$resource","API_URL",function(e,t){return e(t+"User/:userId",{userId:"@userId"},{changePasswordForUser:{url:t+"User/password/:userId",id:"@id",method:"POST",params:{userId:"@userId"}}})}]).factory("UserImage",["$http","API_URL",function(e,t){return{upload:function(o,n){return e({method:"POST",url:t+"User/image/"+n,data:o,headers:{"Content-Type":void 0}})}}}]),angular.module("BookingSystem.accountServices",["ngResource"]).factory("Account",["$resource","$http","$httpParamSerializer","API_URL","API_LOGIN_URL","API_LOGOUT_URL",function(e,t,o,n,r,i){return{login:function(e,n){return t.post(r,o({grant_type:"password",UserName:e,Password:n}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},logout:function(){return t.post(i)},getInfo:function(){return t.get(n+"Account/GetInfo")},changeInfo:function(e){return t({method:"POST",url:n+"Account/ChangeInfo/",data:e})}}}]).factory("AccountImage",["$http","API_URL",function(e,t){return{upload:function(o){return e({method:"POST",url:t+"Account/Image/",data:o,headers:{"Content-Type":void 0}})}}}]),angular.module("BookingSystem.calendarWeekDirective",[]).controller("CalendarWeekCtrl",["$rootScope","$scope","$state","LocationBooking","BookingHelper",function(e,t,o,n,r){t.days=[];var i=function(e,t,o){return r.doBookingsCollide(o.StartTime,o.EndTime,e,t)},a=function(e){var o=void 0;for(o=0;7>o;o++){var n=moment(t.days[o].date),r=moment(n).endOf("day"),a=t.bookings.filter(i.bind(null,n,r));t.days[o].bookings=[],a.forEach(function(e){t.days[o].bookings.push(JSON.parse(JSON.stringify(e)))})}},s=function(){t.weekDateStart=moment(t.date).startOf("isoWeek");for(var e=0,o=moment(t.weekDateStart);7>e;o.add(1,"days"))t.days[e]={},t.days[e].date=o.format(),e++},u=function(e){t.$broadcast("hideAllAddButtons",!0)};t.hideAddButtons=function(e){u()},s(),t.$watch("bookings",function(e){void 0!==e&&a()}),t.$watch("date",function(e,t){s()})}]).directive("calendarWeek",[function(){return{restrict:"E",replace:!0,templateUrl:function(e,t){return"templates/directives/calendar-week.html"},scope:{date:"=",bookings:"=",bookingsType:"=",zoom:"="},link:function(e,t,o){},controller:"CalendarWeekCtrl"}}]),angular.module("BookingSystem.calendarDayDirective",[]).controller("CalendarDayCtrl",["$scope","$element","$attrs","$rootScope","$location","$q","$state","BookingHelper","$interval","DEFAULT_CALENDAR_ZOOM","$ionicScrollDelegate","$window","$document","$ionicModal","MODAL_ANIMATION","BOOKING_TYPES",function(e,t,o,n,r,i,a,s,u,c,l,m,d,p,g,f){var k="templates/modals/booking-create-choose-type.html",h=moment(e.date),v=6e4,b=200,y=35,M=null;e.dayNumber=h.format("D"),e.dayName=h.format("ddd"),e.visibleAddButtonHour=null,e.columnHeight=y*e.zoom,e.bookingTypes=f;var I=function(){"booking"===e.bookingsType&&(p.fromTemplateUrl(k,{scope:e,animation:g}).then(function(t){e.modal=t}),e.$on("$destroy",function(){e.modal.remove()}))},w=function(){var t=void 0,o=24;for(e.hoursArray=[],t=0;o>t;t++)e.hoursArray.push(t)},$=function(e,t){return Number(e)+Number(t/60)},S=function(){var t=e.columnHeight+y*(e.zoom-1);b>t&&t>y&&(e.columnHeight=t)},B=function(){e.isCurrentDay&&d.ready(function(){var t=angular.element(document.querySelector(".time-line")).prop("offsetTop");l.scrollTo(0,t-e.columnHeight,!1)})},P=function(){if(e.isCurrentDay=moment().format("YYYY-MM-DD")===h.format("YYYY-MM-DD"),e.isCurrentDay){var t=moment(),o=t.format("H"),n=t.format("mm");e.currentHour=$(o,n)}else e.isDayOld=h.isBefore(moment())},D=function(){e.isCurrentDay&&(M=u(function(){P()},v))},E=function(e){var t=moment(e.EndTime).startOf("day"),o=moment(e.StartTime).format("H"),n=moment(e.StartTime).format("mm");return h.date()!==moment(e.StartTime).date()&&moment(e.StartTime).isBefore(t)?0:$(o,n)},T=function(e){return moment(e.EndTime).isAfter(moment(h).endOf("day"))?23.99:Number(moment(e.EndTime).format("H"))+Number(moment(e.EndTime).format("mm")/60)},A=function(){void 0!==e.bookings&&e.bookings.forEach(function(t){t.StartHour=E(t),t.EndHour=T(t),t.Duration=t.EndHour-t.StartHour,s.setConcurrentBookingData(t,e.bookings)})};e.showAddHour=function(t){n.userInfo&&(e.hideAllAddButtonsCallback(),e.visibleAddButtonHour=t)},e.hideAddButton=function(){e.visibleAddButtonHour=null},e.createEventForHour=function(t,o){var n=o||e.bookingsType;h.set({hour:t}),"booking"===n?e.modal.show():(a.go("app."+n+"-create",{date:h,id:null}),e.hideAddButton())},e.createBookingOfType=function(t){e.createEventForHour(h.hour(),t),e.modal.hide()},e.showEvent=function(t){n.userInfo&&a.go("app."+e.bookingsType+"-details",{id:t})},w(),P(),D(),B(),I(),e.$on("hideAllAddButtons",function(t,o){e.hideAddButton()}),e.$watch("bookings",function(e,t){Array.isArray(e)&&A()}),e.$watch("zoom",function(e,t){S()}),e.$on("swipe-occurred",function(t){e.columnHeight=y*c}),e.$on("leaving-view",function(e){null!==M&&u.cancel(M)})}]).directive("calendarDay",[function(){return{restrict:"E",replace:!0,templateUrl:function(e,t){return"templates/directives/calendar-day.html"},scope:{date:"=",hideAllAddButtonsCallback:"&",hideAddButton:"=",bookings:"=",bookingsType:"=",zoom:"="},link:function(e,t,o){},controller:"CalendarDayCtrl"}}]).controller("CalendarTimeCtrl",["$scope","DEFAULT_CALENDAR_ZOOM",function(e,t){var o=35;e.columnHeight=o*e.zoom;var n=200,r=function(){e.weekNumber=moment(e.date).isoWeek()},i=function(){var t=e.columnHeight+o*(e.zoom-1);n>t&&t>o&&(e.columnHeight=t)},a=function(){var t=void 0,o=24;for(e.hoursArray=[],t=1;o>t;t++)e.hoursArray.push(t)};a(),r(),e.$watch("zoom",function(e,t){i()}),e.$watch("date",function(e,t){r()}),e.$on("swipe-occurred",function(n){e.columnHeight=o*t})}]).directive("calendarTime",[function(){return{restrict:"E",replace:!0,scope:{date:"=",zoom:"="},templateUrl:function(e,t){return"templates/directives/calendar-time.html"},controller:"CalendarTimeCtrl"}}]).filter("digits",function(){return function(e){return 10>e&&(e="0"+e),e}}),angular.module("BookingSystem.imageUploaderDirective",["BookingSystem.imageResizeServices"]).controller("imageUploaderCtrl",["$scope","$q","$element","$attrs","$rootScope","CustomerImage","ImageResize","API_IMG_PATH_URL","PHOTO_MISSING_SRC",function(e,t,o,n,r,i,a,s,u){e.file="",e.progress=0,e.isProgressVisible=!1;var c=function(t,o){return function(){e.$apply(function(){a.scaleImage(t.result).then(function(t){e.displayImageSrc=t,e.base64EncodedImage=t.replace(/^data:image\/jpeg;base64,/,""),o.resolve()})})}},l=function(t,o){return function(){e.$apply(function(){o.reject(t.result)})}},m=function(e){return function(e){}},d=function(e){var t=!1;return"image/png"!==e.type&&"image/jpg"!==e.type&&"image/jpeg"!==e.type&&"image/gif"!==e.type||e.size<1e7&&(t=!0),t};e.$watch("imageSrc",function(t,o){"undefined"!=typeof t&&""!==t?e.displayImageSrc=s+t+"?"+Date.now():e.displayImageSrc=u}),e.readUploadedFile=function(e){var o=t.defer(),n=new FileReader,i=null;return d(e)?(n.onload=c(n,o),n.onerror=l(n,o),n.onprogress=m(n),n.readAsDataURL(e),i=o.promise):(r.FlashMessage={type:"error",message:"Den uppladdade bilden måste vara av typen: jpg, gif eller png och får inte överstiga 10mb i storlek"},o.reject(),i=o.promise),i}}]).directive("imageUploader",["$http",function(e){return{restrict:"E",link:function(e,t,o){},scope:{imageSrc:"=imageSrc",base64EncodedImage:"=base64EncodedImage"},replace:!0,templateUrl:"templates/directives/image-uploader-directive.html",controller:"imageUploaderCtrl"}}]).directive("imageUploaderFile",function(){return{restrict:"A",replace:!1,scope:!1,controller:["$scope","$element","$attrs",function(e,t,o){t.bind("change",function(t){var o=(t.srcElement||t.target).files[0];e.readUploadedFile(o)})}]}}),function(){var e=function(e){return angular.isUndefined(e)||""===e||null===e||void 0===e};angular.module("BookingSystem.ngMinMaxDirectives",[]).directive("ngMin",function(){return{restrict:"A",require:"ngModel",link:function(t,o,n,r){t.$watch(n.ngMin,function(){r.$setViewValue(r.$viewValue)});var i=function(o){var i=t.$eval(n.ngMin)||0;return!e(o)&&i>o?void r.$setValidity("ngMin",!1):(r.$setValidity("ngMin",!0),o)};r.$parsers.push(i),r.$formatters.push(i);
}}}).directive("ngMax",function(){return{restrict:"A",require:"ngModel",link:function(t,o,n,r){t.$watch(n.ngMax,function(){r.$setViewValue(r.$viewValue)});var i=function(o){var i=t.$eval(n.ngMax)||1/0;return!e(o)&&o>i?void r.$setValidity("ngMax",!1):(r.$setValidity("ngMax",!0),o)};r.$parsers.push(i),r.$formatters.push(i)}}})}(),angular.module("BookingSystem.calendarDaysHeaderDirective",[]).controller("CalendarDaysHeaderCtrl",["$rootScope","$scope",function(e,t){t.days=[];var o=function(){t.weekDateStart=moment(t.date).startOf("isoWeek");for(var e=0,o=moment(t.weekDateStart);7>e;o.add(1,"days"))t.days[e]={},t.days[e].isCurrentDay=moment().format("YYYY-MM-DD")===o.format("YYYY-MM-DD"),t.days[e].dayNumber=o.format("D"),t.days[e].dayName=o.format("ddd"),e++};t.$watch("date",function(e,t){o()})}]).directive("calendarDaysHeader",[function(){return{restrict:"E",replace:!0,templateUrl:function(e,t){return"templates/directives/calendar-days-header.html"},scope:{date:"="},controller:"CalendarDaysHeaderCtrl"}}]),function(){angular.module("BookingSystem.imageShowOnLoadDirective",[]).directive("showOnLoad",function(){return{link:function(e,t){t.on("load",function(){e.$apply(function(){e.imageVisible=!0})})}}})}(),angular.module("BookingSystem.filters",[]).filter("zpad",[function(){return function(e,t){if(void 0===e&&(e=""),e.length>=t)return e;var o="0".repeat(t);return(o+e).slice(-1*t)}}]).filter("kr",function(){return function(e){var t=void 0;return"undefined"!=typeof e&&(e=e.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "),t=e+" kr"),t}}).filter("count",function(){return function(e){return e+" st"}}).filter("bool",function(){return function(e){return e?"ja":"nej"}}).filter("listLetterIcon",function(){return function(e){return e.charAt(0).toUpperCase()}}).filter("thumbnail",["THUMBNAIL_EXTENSION",function(e){return function(t){var o=t.split("."),n=o.length-1;return o.splice(n,0,e),o.join(".")}}]).filter("percentage",["$filter",function(e){return function(t){return e("number")(100*t,0)+"%"}}]),angular.module("BookingSystem.furnituring",[]).controller("FurnituringListCtrl",["$rootScope","$scope","$state","Furnituring","$mdToast",function(e,t,o,n,r){var i=function(){var e=n.query();e.$promise["catch"](function(){r.show(r.simple().content("Möbleringar kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.furniturings=e};t.$on("$ionicView.beforeEnter",function(e,t){i()})}]).controller("FurnituringDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","Furnituring","$mdToast",function(e,t,o,n,r,i,a,s){var u="templates/modals/furnituring-delete.html";t.editMode=!1,t.furnituringBackup={};var c=function(){i.fromTemplateUrl(u,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},l=function(){var e=a.get({furnituringId:o.furnituringId});e.$promise["catch"](function(){s.show(s.simple().content("Möblering kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.furnituring=e};t.startEditMode=function(){var e=this;e.isEditMode=!0,e.furnituringBackup=angular.copy(e.furnituring)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.furnituring=e.furnituringBackup},t.saveFurnituring=function(){var e=this;a.save({FurnituringId:o.furnituringId,Name:e.furnituring.Name}).$promise.then(function(t){e.endEditMode(),s.show(s.simple().content('Möbleringen "'+e.furnituring.Name+'" sparades med ett lyckat resultat').position("top right").theme("success")),history.back()})["catch"](function(t){409===t.status?s.show(s.simple().content('Det finns redan en möblering som heter "'+e.furnituring.Name+'". Två möbleringar kan inte heta lika.').position("top right").theme("warn")):400!==t.status&&500!==t.status||s.show(s.simple().content("Ett oväntat fel uppstod när möbleringen skulle sparas").position("top right").theme("warn")),404===t.status&&(s.show(s.simple().content('Möbleringen "'+e.furnituring.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back())})},t.deleteFurnituring=function(){a["delete"]({furnituringId:o.furnituringId}).$promise.then(function(e){s.show(s.simple().content('Möbleringen "'+t.furnituring.Name+'" raderades med ett lyckat resultat').position("top right").theme("success")),history.back()})["catch"](function(e){400===e.status&&"undefined"!==e.data.Message&&"Foreign key references exists"===e.data.Message?s.show(s.simple().content("Möbleringen kan inte raderas eftersom det finns en lokalbokning eller en lokalmöblering som refererar till möbleringen").position("top right").theme("warn")):400!==e.status&&500!==e.status||s.show(s.simple().content("Ett oväntat fel uppstod när möbleringen skulle tas bort").position("top right").theme("warn")),404===e.status&&s.show(s.simple().content('Möbleringen "'+t.furnituring.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back()})},c(),l()}]).controller("FurnituringCreateCtrl",["$rootScope","$stateParams","$scope","$state","Furnituring","$mdToast",function(e,t,o,n,r,i){o.furnituring={},o.saveFurnituring=function(){var e=this;r.save({FurnituringId:0,Name:e.furnituring.Name}).$promise.then(function(t){i.show(i.simple().content('Möbleringen "'+e.furnituring.Name+'" skapades med ett lyckat resultat').position("top right").theme("success")),history.back()})["catch"](function(t){409===t.status?i.show(i.simple().content('Det finns redan en möblering som heter "'+e.furnituring.Name+'". Två möbleringar kan inte heta lika.').position("top right").theme("warn")):i.show(i.simple().content("Ett oväntat fel uppstod när möbleringen skulle sparas").position("top right").theme("warn"))})}}]),angular.module("BookingSystem.meals",[]).controller("MealsListCtrl",["$rootScope","$scope","$state","Meal","$mdToast","API_IMG_PATH_URL",function(e,t,o,n,r,i){t.API_IMG_PATH_URL=i;var a=function(){var e=n.query();e.$promise["catch"](function(){r.show(r.simple().content("Måltider kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.meals=e};t.$on("$ionicView.beforeEnter",function(e,t){a()})}]).controller("MealDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","Meal","MealProperty","MealHasProperty","$mdToast","API_IMG_PATH_URL","MealImage","$q",function(e,t,o,n,r,i,a,s,u,c,l,m,d){var p="templates/modals/select-meal-properties.html",g="templates/modals/meals-delete.html";t.isEditMode=!1,t.mealBackup={},t.API_IMG_PATH_URL=l;var f=function(){r.fromTemplateUrl(g,{scope:t,animation:n}).then(function(e){t.deleteModal=e}),t.$on("$destroy",function(){t.deleteModal.remove()})},k=function(){r.fromTemplateUrl(p,{scope:t,animation:n}).then(function(e){t.selectModal=e}),t.$on("$destroy",function(){t.selectModal.remove()})},h=function(e){return m.upload(t.meal.ImageForUpload,e)},v=function(){c.show(c.simple().content('Måltiden "'+t.meal.Name+'" sparades med ett lyckat resultat').position("top right").theme("success")),history.back()},b=function(){var e=d.defer(),n=a.get({mealId:o.mealId});return n.$promise["catch"](function(){c.show(c.simple().content("Måltid kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}).then(function(){e.resolve()})["catch"](function(){c.show(c.simple().content("Måltidsegenskaper kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.meal=n,e.promise},y=function(){return t.mealProperties=s.query(),t.mealProperties.$promise},M=function(){t.mealProperties.forEach(function(e){var o=t.meal.mealProperties.some(function(t){return e.Name===t.MealPropertyName});e.isSelected=o})},I=function(){return t.meal.mealProperties=u.queryForMeal({mealId:o.mealId}),t.meal.mealProperties.$promise},w=function(){var e=d.defer(),n=[],r=u.removeForMeal({mealId:t.meal.MealId});return r.$promise["finally"](function(){t.meal.mealProperties.forEach(function(e){n.push({MealId:o.mealId,MealPropertyId:e.MealPropertyId})}),u.saveForMeal(n).$promise.then(function(){e.resolve()})}),e.promise};t.startEditMode=function(){t.isEditMode=!0,t.mealBackup=angular.copy(t.meal)},t.endEditMode=function(){t.isEditMode=!1},t.abortEditMode=function(){t.isEditMode=!1,t.meal=t.mealBackup},t.saveMeal=function(){var e=this;a.save({MealId:o.mealId,Name:e.meal.Name,ImageSrc:e.meal.ImageSrc}).$promise.then(function(t){e.endEditMode(),w(t.MealId).then(function(){"undefined"!=typeof e.meal.ImageForUpload?h(t.MealId).success(function(){v()}).error(function(){c.show(c.simple().content('Måltiden "'+e.meal.Name+'" sparades, men det gick inte att ladda upp och spara den önskade bilden.').position("top right").theme("warn")),history.back()}):v()})["catch"](function(){c.show(c.simple().content("Uppgifter om måltiden sparades, men måltidsegenskaper kunde inte sparas. Var god försök igen.").position("top right").theme("warn"))})})["catch"](function(t){409===t.status?c.show(c.simple().content('Det finns redan en måltid som heter "'+e.meal.Name+'". Två måltider kan inte heta lika.').position("top right").theme("warn")):400!==t.status&&500!==t.status||c.show(c.simple().content("Ett oväntat fel uppstod när måltiden skulle sparas").position("top right").theme("warn")),404===t.status&&(c.show(c.simple().content('Måltiden "'+e.meal.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back())})},t.deleteMeal=function(){a["delete"]({mealId:o.mealId}).$promise.then(function(e){c.show(c.simple().content('Måltiden "'+t.meal.Name+'" raderades med ett lyckat resultat').position("top right").theme("success")),history.back()})["catch"](function(e){400===e.status&&"undefined"!==e.data.Message&&"Foreign key references exists"===e.data.Message?c.show(c.simple().content("Måltiden kan inte raderas eftersom det finns en lokalbokning eller en lokalmåltid som refererar till måltiden").position("top right").theme("warn")):400!==e.status&&500!==e.status||c.show(c.simple().content("Ett oväntat fel uppstod när måltiden skulle tas bort").position("top right").theme("warn")),404===e.status&&c.show(c.simple().content('Måltiden "'+t.meal.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back()})},t.toggleMealPropertyToMeal=function(e){var o=[],n=!1;t.meal.mealProperties.forEach(function(t){t.MealPropertyId===e.MealPropertyId?n=!0:o.push(t)}),n||o.push({MealPropertyId:e.MealPropertyId,MealPropertyName:e.Name}),t.meal.mealProperties=o},f(),k(),b().then(function(){return y()}).then(function(){return I()}).then(function(){M()})}]).controller("MealCreateCtrl",["$rootScope","$stateParams","$scope","$state","Meal","$mdToast","MealImage","MODAL_ANIMATION","$ionicModal","MealProperty","MealHasProperty","$q",function(e,t,o,n,r,i,a,s,u,c,l,m){var d="templates/modals/select-meal-properties.html";o.meal={mealProperties:[]},o.isEditMode=!0;var p=function(){u.fromTemplateUrl(d,{scope:o,animation:s}).then(function(e){o.selectModal=e}),o.$on("$destroy",function(){o.selectModal.remove()})},g=function(e){return a.upload(o.meal.ImageForUpload,e)},f=function(){return o.mealProperties=c.query(),o.mealProperties.$promise},k=function(){i.show(i.simple().content('Måltiden "'+o.meal.Name+'" sparades med ett lyckat resultat').position("top right").theme("success")),history.back()},h=function(e){var t=m.defer(),n=[];return o.meal.mealProperties.forEach(function(t){n.push({MealId:e,MealPropertyId:t.MealPropertyId})}),l.saveForMeal(n).$promise.then(function(){t.resolve()}),t.promise};o.saveMeal=function(){var e=this;r.save({MealId:0,Name:e.meal.Name}).$promise.then(function(t){"undefined"!=typeof e.meal.ImageForUpload&&g(t.MealId).error(function(){i.show(i.simple().content('Måltiden "'+e.meal.Name+'" skapades, men det gick inte att ladda upp och spara den önskade bilden.').position("top right").theme("warn")),history.back()}),h(t.MealId).then(function(){k()})["catch"](function(){i.show(i.simple().content("Uppgifter om måltiden sparades, men måltidsegenskaper kunde inte sparas. Var god försök igen.").position("top right").theme("warn"))})})["catch"](function(t){409===t.status?i.show(i.simple().content('Det finns redan en måltid som heter "'+e.meal.Name+'". Två måltider kan inte heta lika.').position("top right").theme("warn")):i.show(i.simple().content("Ett oväntat fel uppstod när måltiden skulle sparas").position("top right").theme("warn"))})},o.toggleMealPropertyToMeal=function(e){var t=[],n=!1;o.meal.mealProperties.forEach(function(o){o.MealPropertyId===e.MealPropertyId?n=!0:t.push(o)}),n||t.push({MealPropertyId:e.MealPropertyId,MealPropertyName:e.Name}),o.meal.mealProperties=t},p(),f()}]),angular.module("BookingSystem.resources",[]).controller("ResourcesListCtrl",["$rootScope","$scope","$state","$mdToast","Resource","API_IMG_PATH_URL",function(e,t,o,n,r,i){t.API_IMG_PATH_URL=i;var a=function(){var e=r.query();e.$promise["catch"](function(){n.show(n.simple().content("Resurser kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.resources=e};t.$on("$ionicView.beforeEnter",function(e,t){a()})}]).controller("ResourceDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","Resource","ResourceImage","API_IMG_PATH_URL","$mdToast",function(e,t,o,n,r,i,a,s,u,c){var l="templates/modals/resources-delete.html";t.isEditMode=!1,t.resourceBackup={},t.API_IMG_PATH_URL=u;var m=function(){r.fromTemplateUrl(l,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},d=function(e){return s.upload(t.resource.ImageForUpload,e)},p=function(){c.show(c.simple().content('Resursen "'+t.resource.Name+'" sparades med ett lyckat resultat').position("top right").theme("success")),history.back()},g=function(){var e=a.get({resourceId:o.resourceId});e.$promise["catch"](function(){c.show(c.simple().content("Resurs kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.resource=e};t.startEditMode=function(){var e=this;e.isEditMode=!0,e.resourceBackup=angular.copy(e.resource)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.resource=e.resourceBackup},t.saveResource=function(){var e=this;a.save({ResourceId:o.resourceId,Name:e.resource.Name,Count:e.resource.Count,ImageSrc:e.resource.ImageSrc,BookingPricePerHour:e.resource.BookingPricePerHour,MinutesMarginBeforeBooking:e.resource.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:e.resource.MinutesMarginAfterBooking,WeekEndCount:e.resource.WeekEndCount}).$promise.then(function(t){e.endEditMode(),"undefined"!=typeof e.resource.ImageForUpload?d(t.ResourceId).success(function(){p()}).error(function(){c.show(c.simple().content("Resursen sparades, men det gick inte att ladda upp och spara den önskade bilden.").position("top right").theme("warn"))}):p()})["catch"](function(t){409===t.status?c.show(c.simple().content('Det finns redan en resurs som heter "'+e.resource.Name+'". Två resurser kan inte heta lika.').position("top right").theme("warn")):400!==t.status&&500!==t.status||c.show(c.simple().content("Ett oväntat fel uppstod när resursen skulle sparas").position("top right").theme("warn")),404===t.status&&(c.show(c.simple().content('Resursen "'+e.resource.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back())})},t.deleteResource=function(){a["delete"]({resourceId:o.resourceId}).$promise.then(function(e){c.show(c.simple().content('Resursen "'+t.resource.Name+'" raderades med ett lyckat resultat').position("top right").theme("success")),history.back()})["catch"](function(e){400===e.status&&"undefined"!==e.data.Message&&"Foreign key references exists"===e.data.Message?c.show(c.simple().content("Resursen kan inte raderas eftersom det finns en lokalbokning eller en lokalresurs som refererar till resursen").position("top right").theme("warn")):400!==e.status&&500!==e.status||c.show(c.simple().content("Ett oväntat fel uppstod när resursen skulle tas bort").position("top right").theme("warn")),404===e.status&&c.show(c.simple().content('Resursen "'+t.resource.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back()})},m(),g()}]).controller("ResourceCreateCtrl",["$rootScope","$stateParams","$scope","$state","Resource","$mdToast","ResourceImage",function(e,t,o,n,r,i,a){o.resource={};var s=function(e){return a.upload(o.resource.ImageForUpload,e)},u=function(){i.show(i.simple().content('Resursen "'+o.resource.Name+'" sparades med ett lyckat resultat').position("top right").theme("success")),history.back()};o.saveResource=function(){var e=this;r.save({ResourceId:0,Name:e.resource.Name,Count:e.resource.Count,BookingPricePerHour:e.resource.BookingPricePerHour,MinutesMarginBeforeBooking:e.resource.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:e.resource.MinutesMarginAfterBooking,WeekEndCount:e.resource.WeekEndCount}).$promise.then(function(t){"undefined"!=typeof e.resource.ImageForUpload?s(t.ResourceId).success(function(e){u()}).error(function(){i.show(i.simple().content('Resursen "'+e.meal.Name+'" skapades, men det gick inte att ladda upp och spara den önskade bilden.').position("top right").theme("warn")),history.back()}):u()})["catch"](function(t){409===t.status?i.show(i.simple().content('Det finns redan en resurs som heter "'+e.resource.Name+'". Två resurser kan inte heta lika.').position("top right").theme("warn")):i.show(i.simple().content("Ett oväntat fel uppstod när resursen skulle sparas").position("top right").theme("warn"))})}}]),angular.module("BookingSystem.locationBooking",["ngMessages"]).controller("LocationBookingViewCtrl",["$rootScope","$scope","$state","LocationBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM",function(e,t,o,n,r,i,a,s,u){var c=i,l=null,m=null,d=null;t.zoom=u,t.weekDate=moment();var p=function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],o=arguments.length<=1||void 0===arguments[1]?"weeks":arguments[1];e>0?t.weekDate=moment(t.weekDate).add(e,o):0>e&&(t.weekDate=moment(t.weekDate).subtract(Math.abs(e),o)),m=moment(t.weekDate).startOf("week"),d=moment(t.weekDate).endOf("week")},g=function(){var e=n.queryLessForPeriod({fromDate:m.format("YYYY-MM-DD"),toDate:d.format("YYYY-MM-DD")});e.$promise["catch"](function(){s.show(s.simple().content("Lokalbokningar kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}).then(function(e){t.locationBookings=e})},f=function(){l=r(function(){g()},c)},k=function(){var e=angular.element(document.querySelector("#booking-view-content"));a.on("pinch",function(e){e.gesture.srcEvent.preventDefault(),t.$apply(function(){t.zoom=e.gesture.scale})},e),a.on("swipeleft",function(e){t.toNextWeek(),t.$apply(),t.$broadcast("swipe-occurred")},e),a.on("swiperight",function(e){t.toPreviousWeek(),t.$apply(),t.$broadcast("swipe-occurred")},e)};t.toNextWeek=function(){p(1),g()},t.toPreviousWeek=function(){p(-1),g()},t.toNextMonth=function(){p(1,"month"),g()},t.toPreviousMonth=function(){p(-1,"month"),g()},t.$on("$ionicView.beforeEnter",function(e,t){p(),g(),f()}),t.$on("$ionicView.loaded",function(e,t){k()}),t.$on("$ionicView.leave",function(e){l&&r.cancel(l),t.$broadcast("leaving-view")})}]).controller("LocationBookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","LocationBooking","$mdToast","Location","Customer","BookingHelper","$q","$ionicHistory","API_IMG_PATH_URL",function(e,t,o,n,r,i,a,s,u,c,l,m,d,p){var g="templates/modals/location-booking-delete.html";t.editMode=!1,t.locationBookingBackup={},t.API_IMG_PATH_URL=p;var f=function(){i.fromTemplateUrl(g,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},k=function(){var e=a.get({locationBookingId:o.id});return e.$promise["catch"](function(){s.show(s.simple().content("Lokalbokning kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.locationBooking=e,e.$promise},h=function(){var e=t.locationBooking.StartTime,o=t.locationBooking.EndTime;t.bookingStartDate=moment(e).toDate(),t.bookingStartHour=moment(e).hour(),t.bookingStartMinute=moment(e).minute(),t.bookingEndDate=moment(o).toDate(),t.bookingEndHour=moment(o).hour(),t.bookingEndMinute=moment(o).minute()},v=function(){return"undefined"!=typeof t.bookingStartDate&&"undefined"!=typeof t.bookingStartHour&&"undefined"!=typeof t.bookingStartMinute&&"undefined"!=typeof t.bookingEndDate&&"undefined"!=typeof t.bookingEndHour&&"undefined"!=typeof t.bookingEndMinute},b=function(){t.selectHours=l.getHoursForSelect(),t.selectMinutes=l.getMinutesForSelect()},y=function(){if(v()){var e=I(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute),o=I(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute);u.queryFreeForPeriod({locationBookingId:t.locationBooking.LocationBookingId,fromDate:e.format("YYYY-MM-DD"),fromTime:e.format("HH:mm"),toDate:o.format("YYYY-MM-DD"),toTime:o.format("HH:mm")}).$promise.then(function(e){t.locations=e})["catch"](function(e){s.show(s.simple().content("Ett oväntat fel uppstod när uppgifter om lediga lokaler skulle hämtas").position("top right").theme("warn"))})}},M=function(){var e=c.get({customerId:t.locationBooking.CustomerId});return e.$promise["catch"](function(){s.show(s.simple().content("Kund kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.customer=e,e.$promise},I=function(e,t,o){return moment(e).hour(t).minute(o)};t.startEditMode=function(){var e=this;e.isEditMode=!0,e.locationBookingBackup=angular.copy(e.locationBooking)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.locationBooking=e.locationBookingBackup},t.deleteLocationBooking=function(){a["delete"]({locationBookingId:o.id}).$promise.then(function(e){s.show(s.simple().content("Lokalbokningen raderades med ett lyckat resultat").position("top right").theme("success")),history.back()})["catch"](function(e){400!==e.status&&500!==e.status||s.show(s.simple().content("Ett oväntat fel uppstod när Lokalbokningen skulle tas bort").position("top right").theme("warn")),404===e.status&&s.show(s.simple().content("Lokalbokningen existerar inte längre. Hann kanske någon radera den?").position("top right").theme("warn")),history.back()})},t.updateFurniturings=function(){t.locationBooking.LocationId?(t.furniturings=LocationFurnituring.queryForLocation({locationId:t.locationBooking.LocationId}),t.furniturings.$promise["catch"](function(){s.show(s.simple().content("Möbleringar för vald lokal kunde inte hämtas.").position("top right").theme("warn"))})):t.furnituring=[]},t.checkEndDate=function(){if(v()){var e=I(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute).toDate().getTime(),o=I(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute).toDate().getTime();e>o&&(t.bookingEndDate=t.bookingStartDate,t.bookingEndHour=t.bookingStartHour,t.bookingEndMinute=t.bookingStartMinute+15),y()}},t.saveLocationBooking=function(){var e=this,t=m.defer(),o=t.promise,n=e.locationBooking.SelectedFurnituring?e.locationBooking.SelectedFurnituring.FurnituringId:null;return a.save({BookingId:e.locationBooking.BookingId,LocationBookingId:e.locationBooking.LocationBookingId,LocationId:e.locationBooking.LocationId,FurnituringId:n,StartTime:I(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).format(),EndTime:I(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).format(),NumberOfPeople:e.locationBooking.NumberOfPeople,Provisional:e.locationBooking.Provisional}).$promise.then(function(e){s.show(s.simple().content("Lokal/plats-bokningen sparades med ett lyckat resultat").position("top right").theme("success")),t.resolve(),d.goBack()})["catch"](function(e){409===e.status?s.show(s.simple().content("Lokalen är tyvärr redan bokad under vald tidsram.").position("top right").theme("warn")):s.show(s.simple().content("Ett oväntat fel uppstod när lokal/plats-bokningen skulle sparas").position("top right").theme("warn"))}),o},f(),k().then(function(){h(),M().then(function(){y()})}),b()}]).controller("LocationBookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","LocationBooking","Location","BookingHelper","LocationFurnituring","Customer","$q","$mdToast","$ionicHistory","API_IMG_PATH_URL","PHOTO_MISSING_SRC",function(e,t,o,n,r,i,a,s,u,c,l,m,d,p){o.locationBooking={Provisional:!0,BookingTypeId:1},o.furnituring=[],o.API_IMG_PATH_URL=d,o.customerImageSrc=p;var g=function(){n.params.date?(o.bookingStartDate=moment(n.params.date).toDate(),o.bookingStartHour=moment(n.params.date).hour(),o.bookingStartMinute=moment(n.params.date).minute(),o.bookingEndDate=moment(n.params.date).toDate(),o.bookingEndHour=moment(n.params.date).hour(),o.bookingEndMinute=moment(n.params.date).add(59,"minutes").minute()):(o.bookingStartDate=new Date,o.bookingStartHour=8,o.bookingStartMinute=0,o.bookingEndDate=new Date,o.bookingEndHour=8,o.bookingEndMinute=59)},f=function(){return"undefined"!=typeof o.bookingStartDate&&"undefined"!=typeof o.bookingStartHour&&"undefined"!=typeof o.bookingStartMinute&&"undefined"!=typeof o.bookingEndDate&&"undefined"!=typeof o.bookingEndHour&&"undefined"!=typeof o.bookingEndMinute},k=function(){o.selectHours=a.getHoursForSelect(),o.selectMinutes=a.getMinutesForSelect()},h=function(){var e=c.defer();if(f()){var t=M(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute),n=M(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute);i.queryFreeForPeriod({fromDate:t.format("YYYY-MM-DD"),fromTime:t.format("HH:mm"),toDate:n.format("YYYY-MM-DD"),toTime:n.format("HH:mm")}).$promise.then(function(t){o.locations=t,e.resolve()})["catch"](function(t){l.show(l.simple().content("Ett oväntat fel uppstod när uppgifter om lediga lokaler skulle hämtas").position("top right").theme("warn")),e.reject()})}return e.promise},v=function(){var e=u.query();e.$promise["catch"](function(){l.show(l.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),o.customers=e},b=function(){o.customerImageSrc=null!==o.customer.ImageSrc&&o.customer.ImageSrc.length>1?d+o.customer.ImageSrc:p},y=function(){var e=u.get({customerId:n.params.customerId});e.$promise["catch"](function(){l.show(l.simple().content("Kund kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}).then(function(){b()}),o.customer=e},M=function(e,t,o){return moment(e).hour(t).minute(o)},I=function(){var e=c.defer();return null!==n.params.bookingId?(o.locationBooking.BookingId=n.params.bookingId,e.resolve()):a.createBookingContainer(o.locationBooking).then(function(t){o.locationBooking.BookingId=t.BookingId,e.resolve()})["catch"](function(t){l.show(l.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle skapas").position("top right").theme("warn")),e.reject()}),e.promise};o.updateFurniturings=function(){o.locationBooking.LocationId?(o.furniturings=s.queryForLocation({locationId:o.locationBooking.LocationId}),o.furniturings.$promise["catch"](function(){l.show(l.simple().content("Möbleringar för vald lokal kunde inte hämtas.").position("top right").theme("warn"))})):o.furnituring=[]},o.checkEndDate=function(){if(f()){var e=M(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute).toDate().getTime(),t=M(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute).toDate().getTime();e>t&&(o.bookingEndDate=o.bookingStartDate,o.bookingEndHour=o.bookingStartHour,o.bookingEndMinute=o.bookingStartMinute+15),h()}},o.saveLocationBooking=function(){var e=this,t=c.defer(),o=t.promise;return I().then(function(){var o=e.locationBooking.SelectedFurnituring?e.locationBooking.SelectedFurnituring.FurnituringId:null,i=M(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).format(),a=M(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).format();r.save({BookingId:e.locationBooking.BookingId,LocationBookingId:0,LocationId:e.locationBooking.LocationId,FurnituringId:o,StartTime:i,EndTime:a,NumberOfPeople:e.locationBooking.NumberOfPeople,Provisional:e.locationBooking.Provisional}).$promise.then(function(e){l.show(l.simple().content("Lokal/plats-bokningen skapades med ett lyckat resultat").position("top right").theme("success")),t.resolve(),n.go("app.booking-view",{weekDate:i})})["catch"](function(e){409===e.status?l.show(l.simple().content("Lokalen är tyvärr redan bokad under vald tidsram.").position("top right").theme("warn")):l.show(l.simple().content("Ett oväntat fel uppstod när lokal/plats-bokningen skulle sparas").position("top right").theme("warn"))})}),o},g(),h().then(function(){n.params.customerId?y():v()}),k()}]),angular.module("BookingSystem.locations",["uiGmapgoogle-maps"]).config(["$stateProvider","uiGmapGoogleMapApiProvider",function(e,t){t.configure({v:"3.17",libraries:"weather,geometry,visualization",language:"sv"})}]).controller("LocationsListCtrl",["$rootScope","$scope","$state","$mdToast","Location","API_IMG_PATH_URL",function(e,t,o,n,r,i){t.API_IMG_PATH_URL=i;var a=function(){var e=r.query();e.$promise["catch"](function(){n.show(n.simple().content("Lokaler och platser kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.locations=e};t.$on("$ionicView.beforeEnter",function(e,t){a()})}]).controller("LocationDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","$mdToast","Location","LocationImage","API_IMG_PATH_URL","DEFAULT_MAP_ZOOM","DEFAULT_LONGITUDE","DEFAULT_LATITUDE","LocationFurnituring","$q","Furnituring",function(e,t,o,n,r,i,a,s,u,c,l,m,d,p,g,f){var k="templates/modals/select-location-furnituring.html",h="templates/modals/location-delete.html",v="templates/modals/google-maps.html";t.locationBackup={},t.API_IMG_PATH_URL=c,t.markers=[],t.mapsWillRefresh=!1;var b=function(){var e=g.defer();return i.fromTemplateUrl(h,{scope:t,animation:n}).then(function(o){t.deleteModal=o,e.resolve()}),t.$on("$destroy",function(){t.deleteModal.remove()}),e.promise},y=function(){var e=g.defer();return i.fromTemplateUrl(k,{scope:t,animation:n}).then(function(o){t.selectModal=o,e.resolve()}),t.$on("$destroy",function(){t.selectModal.remove()}),e.promise},M=function(){var e=g.defer();return i.fromTemplateUrl(v,{scope:t,animation:n}).then(function(o){t.mapsModal=o,e.resolve()}),t.$on("$destroy",function(){t.mapsModal.remove()}),e.promise},I=function(e){return u.upload(t.location.ImageForUpload,e)},w=function(){a.show(a.simple().content('Lokalen/Platsen "'+t.location.Name+'" sparades med ett lyckat resultat').position("top right").theme("success")),history.back()},$=function(e,o,n){t.isEditMode&&(t.location.GPSLatitude=n[0].latLng.lat(),t.location.GPSLongitude=n[0].latLng.lng(),t.markers[0].coords={latitude:n[0].latLng.lat(),longitude:n[0].latLng.lng()},t.$apply())},S=function(){t.map={center:{latitude:d,longitude:m},zoom:l,bounds:{},events:{click:function(e,t,o){$(e,t,o)}}}},B=function(){t.markers[0]={id:t.location.LocationId,coords:{latitude:t.location.GPSLatitude,longitude:t.location.GPSLongitude}}},P=function(){return t.furniturings=f.query(),t.furniturings.$promise},D=function(){t.furniturings.forEach(function(e){var o=t.location.furniturings.some(function(t){return e.Name===t.FurnituringName});e.isSelected=o,e.maxPeople||(e.maxPeople=4)})},E=function(){return t.location.furniturings=p.queryForLocation({locationId:o.locationId}),t.location.furniturings.$promise},T=function(){var e=s.get({locationId:o.locationId});return e.$promise["catch"](function(){a.show(a.simple().content("Lokal/plats kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.location=e,e.$promise},A=function(){var e=!1,o=[];return t.location.furniturings.forEach(function(t){"maxPeople"in t&&void 0!==t.maxPeople&&null!==t.maxPeople?o.push(t):e=!0}),e&&(t.location.furniturings=o),e},L=function(){
var e=t.furniturings.filter(function(e){return e.isSelected});t.location.furniturings=e};t.showSelectModal=function(){t.selectModal.show()},t.startEditMode=function(){t.isEditMode=!0,t.locationBackup=angular.copy(t.location)},t.endEditMode=function(){t.isEditMode=!1},t.abortEditMode=function(){t.isEditMode=!1,t.location=t.locationBackup},t.saveLocation=function(){var e=this;s.save({LocationId:o.locationId,Name:e.location.Name,MaxPeople:e.location.MaxPeople,ImageSrc:e.location.ImageSrc,GPSLatitude:e.location.GPSLatitude,GPSLongitude:e.location.GPSLongitude,BookingPricePerHour:e.location.BookingPricePerHour,MinutesMarginBeforeBooking:e.location.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:e.location.MinutesMarginAfterBooking}).$promise.then(function(t){e.endEditMode(),"undefined"!=typeof e.location.ImageForUpload?I(t.LocationId).success(function(){w()}).error(function(){a.show(a.simple().content("Lokalen/Platsen sparades, men det gick inte att ladda upp och spara den önskade bilden.").position("top right").theme("warn"))}):w()})["catch"](function(t){409===t.status?a.show(a.simple().content('Det finns redan en lokal/plats som heter "'+e.location.Name+'". Två lokaler eller platser kan inte heta lika.').position("top right").theme("warn")):400!==t.status&&500!==t.status||a.show(a.simple().content("Ett oväntat fel uppstod när lokalen/platsen skulle sparas").position("top right").theme("warn")),404===t.status&&(a.show(a.simple().content('Lokalen/platsen "'+e.location.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back())})},t.showMapsModal=function(){t.mapsModal.show().then(function(){0!==t.location.GPSLatitude&&0!==t.location.GPSLongitude&&(t.map.center={latitude:t.location.GPSLatitude,longitude:t.location.GPSLongitude},t.map.zoom=15)})},t.deleteLocation=function(){s["delete"]({locationId:o.locationId}).$promise.then(function(e){a.show(a.simple().content('Lokalen/platsen "'+t.location.Name+'" raderades med ett lyckat resultat').position("top right").theme("success")),history.back()})["catch"](function(e){400===e.status&&"undefined"!==e.data.Message&&"Foreign key references exists"===e.data.Message?a.show(a.simple().content("Lokalen/platsen kan inte raderas eftersom det finns en bokning eller en lokalmöblering som refererar till lokalen/platsen").position("top right").theme("warn")):400!==e.status&&500!==e.status||a.show(a.simple().content("Ett oväntat fel uppstod när lokalen/platsen skulle tas bort").position("top right").theme("warn")),404===e.status&&a.show(a.simple().content('Lokalen/platsen "'+t.location.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back()})},b().then(function(){return y()}).then(function(){return M()}).then(function(){return T()}).then(function(){return P()}).then(function(){return E()}).then(function(){D()}),S(),t.$watch(function(){return t.map.bounds},function(e,t){!t.southwest&&e.southwest&&B()},!0),t.$on("modal.hidden",function(){L(),A()&&a.show(a.simple().content("Uppgifter om max antal personer var ogiltig för en eller flera möbleringar. Var god försök igen.").position("top right").theme("warn"))})}]).controller("LocationCreateCtrl",["$rootScope","$stateParams","$scope","$state","$mdToast","Location","LocationImage","DEFAULT_LATITUDE","DEFAULT_LONGITUDE","DEFAULT_MAP_ZOOM","$ionicModal","MODAL_ANIMATION",function(e,t,o,n,r,i,a,s,u,c,l,m){o.location={GPSLatitude:0,GPSLongitude:0},o.markers=[];var d="templates/modals/google-maps.html",p=function(e){return a.upload(o.location.ImageForUpload,e)},g=function(){r.show(r.simple().content('Lokalen/Platsen "'+o.location.Name+'" sparades med ett lyckat resultat').position("top right").theme("success")),history.back()},f=function(){l.fromTemplateUrl(d,{scope:o,animation:m}).then(function(e){o.mapsModal=e}),o.$on("$destroy",function(){o.mapsModal.remove()})},k=function(e,t,n){o.location.GPSLatitude=n[0].latLng.lat(),o.location.GPSLongitude=n[0].latLng.lng(),o.markers[0].coords={latitude:n[0].latLng.lat(),longitude:n[0].latLng.lng()},o.$apply()},h=function(){o.map={center:{latitude:s,longitude:u},zoom:c,bounds:{},events:{click:function(e,t,o){k(e,t,o)}}}},v=function(){o.markers[0]={id:0,coords:{latitude:o.location.GPSLatitude,longitude:o.location.GPSLongitude}},0!==o.location.GPSLatitude&&0!==o.location.GPSLongitude&&(o.map.center={latitude:o.location.GPSLatitude+latitudeOffset,longitude:o.location.GPSLongitude+longitudeOffset},o.map.zoom=17)};o.saveLocation=function(){var e=this;i.save({LocationId:0,Name:e.location.Name,MaxPeople:e.location.MaxPeople,ImageSrc:e.location.ImageSrc,GPSLatitude:e.location.GPSLatitude,GPSLongitude:e.location.GPSLongitude,BookingPricePerHour:e.location.BookingPricePerHour,MinutesMarginBeforeBooking:e.location.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:e.location.MinutesMarginAfterBooking}).$promise.then(function(t){"undefined"!=typeof e.location.ImageForUpload?p(t.LocationId).success(function(){g()}).error(function(){r.show(r.simple().content("Lokalen/Platsen sparades, men det gick inte att ladda upp och spara den önskade bilden.").position("top right").theme("warn"))}):g()})["catch"](function(t){409===t.status?r.show(r.simple().content('Det finns redan en lokal eller plats som heter "'+e.location.Name+'". Två lokaler/platser kan inte heta lika.').position("top right").theme("warn")):r.show(r.simple().content("Ett oväntat fel uppstod när lokalen/platsen skulle sparas").position("top right").theme("warn"))})},f(),h(),o.$watch(function(){return o.map.bounds},function(e,t){!t.southwest&&e.southwest&&v()},!0)}]),angular.module("BookingSystem.customers",[]).controller("CustomersListCtrl",["$rootScope","$scope","$state","Customer","$mdToast","API_IMG_PATH_URL",function(e,t,o,n,r,i){t.API_IMG_PATH_URL=i;var a=function(){var e=n.query();e.$promise["catch"](function(){r.show(r.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.customers=e};t.$on("$ionicView.beforeEnter",function(e,t){a()})}]).controller("CustomerDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","Customer","CustomerImage","API_IMG_PATH_URL","$mdToast",function(e,t,o,n,r,i,a,s,u,c){var l="templates/modals/customers-delete.html";t.isEditMode=!1,t.customerBackup={},t.API_IMG_PATH_URL=u;var m=function(){r.fromTemplateUrl(l,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},d=function(e){return s.upload(t.customer.ImageForUpload,e)},p=function(){c.show(c.simple().content('Kunden "'+t.customer.Name+'" sparades med ett lyckat resultat').position("top right").theme("success")),history.back()},g=function(){var e=a.get({customerId:o.customerId});return e.$promise["catch"](function(){c.show(c.simple().content("Kunden kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.customer=e,e.$promise},f=function(){var e=a.query();e.$promise["catch"](function(){c.show(c.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.customers=e};t.startEditMode=function(){t.isEditMode=!0,t.customerBackup=angular.copy(t.customer)},t.endEditMode=function(){t.isEditMode=!1},t.abortEditMode=function(){t.isEditMode=!1,t.customer=t.customerBackup},t.saveCustomer=function(){var e=this,t=e.customer.EmailAddress.length>1?e.customer.EmailAddress:null;a.save({CustomerId:o.customerId,Name:e.customer.Name,Address:e.customer.Address,PostNumber:e.customer.PostNumber,City:e.customer.City,EmailAddress:t,PhoneNumber:e.customer.PhoneNumber,CellPhoneNumber:e.customer.CellPhoneNumber,ParentCustomerId:e.customer.ParentCustomerId,ImageSrc:e.customer.ImageSrc,Notes:e.customer.Notes}).$promise.then(function(t){e.endEditMode(),"undefined"!=typeof e.customer.ImageForUpload?d(t.CustomerId).success(function(){p()}).error(function(){c.show(c.simple().content("Kunden sparades, men det gick inte att ladda upp och spara den önskade bilden.").position("top right").theme("warn"))}):p()})["catch"](function(t){409===t.status?c.show(c.simple().content('Det finns redan en kund som heter "'+e.customer.Name+'". Två kunder kan inte heta lika.').position("top right").theme("warn")):400!==t.status&&500!==t.status||c.show(c.simple().content("Ett oväntat fel uppstod när kunden skulle sparas").position("top right").theme("warn")),404===t.status&&(c.show(c.simple().content('Kunden "'+e.customer.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back())})},t.deleteCustomer=function(){a["delete"]({customerId:o.customerId}).$promise.then(function(e){c.show(c.simple().content('Kunden "'+t.customer.Name+'" raderades med ett lyckat resultat').position("top right").theme("success")),history.back()})["catch"](function(o){400===o.status&&"undefined"!==o.data.Message&&"Foreign key references exists"===o.data.Message?c.show(c.simple().content("Kunden kan inte raderas eftersom det finns en bokning som refererar till kunden").position("top right").theme("warn")):400!==o.status&&500!==o.status||c.show(c.simple().content("Ett oväntat fel uppstod när kunden skulle tas bort").position("top right").theme("warn")),404===o.status&&(c.show(c.simple().content('Kunden "'+t.customer.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),e.FlashMessage={type:"error",message:""}),history.back()})},t.fixPostFormat=function(){t.customer.PostNumber&&(t.customer.PostNumber.length>=5&&" "!==t.customer.PostNumber[3]&&(t.customer.PostNumber=t.customer.PostNumber.substring(0,3)+" "+t.customer.PostNumber.substring(3)),t.customer.PostNumber.length>6&&(t.customer.PostNumber=t.customer.PostNumber.substring(0,6)))},m(),g().then(function(){return f()})}]).controller("CustomerCreateCtrl",["$rootScope","$stateParams","$scope","$state","Customer","CustomerImage","$mdToast",function(e,t,o,n,r,i,a){o.customer={};var s=function(e){return i.upload(o.customer.ImageForUpload,e)},u=function(){a.show(a.simple().content('Kunden "'+o.customer.Name+'" sparades med ett lyckat resultat').position("top right").theme("success")),history.back()},c=function(){var e=r.query();e.$promise["catch"](function(){a.show(a.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),o.customers=e};o.saveCustomer=function(){var e=this;r.save({CustomerId:0,Name:e.customer.Name,Address:e.customer.Address,PostNumber:e.customer.PostNumber,City:e.customer.City,EmailAddress:e.customer.EmailAddress,PhoneNumber:e.customer.PhoneNumber,CellPhoneNumber:e.customer.CellPhoneNumber,ParentCustomerId:e.customer.ParentCustomerId,ImageSrc:e.customer.ImageSrc,Notes:e.customer.Notes}).$promise.then(function(t){"undefined"!=typeof e.customer.ImageForUpload?s(t.CustomerId).success(function(e){u()}).error(function(){a.show(a.simple().content('Kunden "'+e.customer.Name+'" skapades, men det gick inte att ladda upp och spara den önskade bilden.').position("top right").theme("warn")),history.back()}):u()})["catch"](function(t){409===t.status?a.show(a.simple().content('Det finns redan en kund som heter "'+e.customer.Name+'". Två kunder kan inte heta lika.').position("top right").theme("success")):a.show(a.simple().content("Ett oväntat fel uppstod när kunden skulle sparas").position("top right").theme("warn"))})},o.fixPostFormat=function(){o.customer.PostNumber&&(o.customer.PostNumber.length>=5&&" "!==o.customer.PostNumber[3]&&(o.customer.PostNumber=o.customer.PostNumber.substring(0,3)+" "+o.customer.PostNumber.substring(3)),o.customer.PostNumber.length>6&&(o.customer.PostNumber=o.customer.PostNumber.substring(0,6)))},c()}]),angular.module("BookingSystem.bookingTypes",[]).controller("BookingTypesListCtrl",["$rootScope","$scope","$state","BookingType","$mdToast",function(e,t,o,n,r){var i=function(){var e=n.query();e.$promise["catch"](function(){r.show(r.simple().content("Bokningstyper kunde inte hämtas, var god försök igen.").position("top right"))}),t.bookingTypes=e};t.$on("$ionicView.beforeEnter",function(e,t){i()})}]).controller("BookingTypeDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","BookingType","$mdToast",function(e,t,o,n,r,i,a,s){var u="templates/modals/bookingtypes-delete.html";t.isEditMode=!1,t.bookingTypeBackup={};var c=function(){r.fromTemplateUrl(u,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},l=function(){var e=a.get({bookingTypeId:o.bookingTypeId});e.$promise["catch"](function(){s.show(s.simple().content("Bokningstypen kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.bookingType=e};t.toggleHasLocation=function(){var e=this;e.bookingType.HasLocation===!0?e.bookingType.HasLocation=!1:e.bookingType.HasLocation=!0},t.startEditMode=function(){var e=this;e.isEditMode=!0,e.bookingTypeBackup=angular.copy(e.bookingType)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.bookingType=e.bookingTypeBackup},t.saveBookingType=function(){var e=this;a.save({BookingTypeId:o.bookingTypeId,Name:e.bookingType.Name}).$promise.then(function(t){e.endEditMode(),s.show(s.simple().content('Bokningstypen "'+e.bookingType.Name+'" sparades med ett lyckat resultat').position("top right").theme("success"))})["catch"](function(t){409===t.status?s.show(s.simple().content('Det finns redan en bokningstyp som heter "'+e.bookingType.Name+'". Två boknigstyper kan inte heta lika.').position("top right").theme("warn")):400!==t.status&&500!==t.status||s.show(s.simple().content("Ett oväntat fel uppstod när bokningstypen skulle sparas").position("top right").theme("warn")),404===t.status&&(s.show(s.simple().content('Bokningstypen "'+e.bookingType.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back())})},t.deleteBookingType=function(){a["delete"]({bookingTypeId:o.bookingTypeId}).$promise.then(function(e){s.show(s.simple().content('Bokningstypen "'+t.bookingType.Name+'" raderades med ett lyckat resultat').position("top right").theme("success")),history.back()})["catch"](function(e){400===e.status&&"undefined"!==e.data.Message&&"Foreign key references exists"===e.data.Message?s.show(s.simple().content("Bokningstypen kan inte raderas eftersom det finns en bokning som refererar till bokningstypen").position("top right").theme("warn")):400!==e.status&&500!==e.status||s.show(s.simple().content("Ett oväntat fel uppstod när bokningstypen skulle tas bort").position("top right").theme("warn")),404===e.status&&s.show(s.simple().content('Bokningstypen "'+t.bookingType.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back()})},c(),l()}]).controller("BookingTypeCreateCtrl",["$rootScope","$stateParams","$scope","$state","BookingType","$mdToast",function(e,t,o,n,r,i){o.bookingType={},o.bookingType.HasLocation=!1,o.toggleHasLocation=function(){var e=this;e.bookingType.HasLocation===!0?e.bookingType.HasLocation=!1:e.bookingType.HasLocation=!0},o.saveBookingType=function(){var e=this;r.save({BookingTypeId:0,Name:e.bookingType.Name,HasLocation:e.bookingType.HasLocation,MinutesMarginBeforeBooking:e.bookingType.MinutesMarginBeforeBooking,MinutesMarginAfterBooking:e.bookingType.MinutesMarginAfterBooking}).$promise.then(function(t){i.show(i.simple().content('Bokningstypen "'+e.bookingType.Name+'" skapades med ett lyckat resultat').position("top right").theme("success")),history.back()})["catch"](function(t){409===t.status?i.show(i.simple().content('Det finns redan en bokningstyp som heter "'+e.bookingType.Name+'". Två bokningstyper kan inte heta lika.').position("top right").theme("warn")):i.show(i.simple().content("Ett oväntat fel uppstod när bokningstypen skulle sparas").position("top right").theme("warn"))})}}]),angular.module("BookingSystem.bookings",[]).controller("BookingViewCtrl",["$rootScope","$scope","$state","Booking","LocationBooking","ResourceBooking","MealBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM","$stateParams","$ionicHistory","$ionicModal","MODAL_ANIMATION","BOOKING_TYPES",function(e,t,o,n,r,i,a,s,u,c,l,m,d,p,g,f,k){var h="templates/modals/booking-create-choose-type.html",v=u,b=null,y=null,M=null;t.zoom=m,t.weekDate=d.weekDate?moment(d.weekDate):moment(),t.bookingTypes=k,t.bookingsType=t.bookingTypes.booking;var I=function(){g.fromTemplateUrl(h,{scope:t,animation:f}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},w=function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],o=arguments.length<=1||void 0===arguments[1]?"weeks":arguments[1];e>0?t.weekDate=moment(t.weekDate).add(e,o):0>e&&(t.weekDate=moment(t.weekDate).subtract(Math.abs(e),o)),y=moment(t.weekDate).startOf("week"),M=moment(t.weekDate).endOf("week")},$=function(){switch(t.bookingsType){case t.bookingTypes.booking:t.calendarTitle="Bokningstillfällen";break;case t.bookingTypes.location:t.calendarTitle="Lokalbokningar";break;case t.bookingTypes.resource:t.calendarTitle="Resursbokningar";break;case t.bookingTypes.meal:t.calendarTitle="Måltidsbokningar";break;default:t.calendarTitle="Bokningstillfällen"}},S=function(){var e=void 0;switch(t.bookingsType){case t.bookingTypes.booking:e=n.queryLessForPeriod({fromDate:y.format("YYYY-MM-DD"),toDate:M.format("YYYY-MM-DD")});break;case t.bookingTypes.location:e=r.queryLessForPeriod({fromDate:y.format("YYYY-MM-DD"),toDate:M.format("YYYY-MM-DD")});break;case t.bookingTypes.resource:e=i.queryLessForPeriod({fromDate:y.format("YYYY-MM-DD"),toDate:M.format("YYYY-MM-DD")});break;case t.bookingTypes.meal:e=a.queryLessForPeriod({fromDate:y.format("YYYY-MM-DD"),toDate:M.format("YYYY-MM-DD")});break;default:e={}}e.$promise["catch"](function(){l.show(l.simple().content("Bokningar kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}).then(function(e){t.bookings=e})},B=function(){b=s(function(){S()},v)},P=function(){var e=angular.element(document.querySelector("#booking-view-content"));c.on("pinch",function(e){e.gesture.srcEvent.preventDefault(),t.$apply(function(){t.zoom=e.gesture.scale})},e),c.on("swipeleft",function(e){t.toNextWeek(),t.$apply(),t.$broadcast("swipe-occurred")},e),c.on("swiperight",function(e){t.toPreviousWeek(),t.$apply(),t.$broadcast("swipe-occurred")},e)};t.toNextWeek=function(){w(1),S()},t.toPreviousWeek=function(){w(-1),S()},t.toNextMonth=function(){w(1,"month"),S()},t.toPreviousMonth=function(){w(-1,"month"),S()},t.resetTimeToNow=function(){t.weekDate=moment(),y=moment().startOf("week"),M=moment().endOf("week"),S()},t.changeBookingTypeTo=function(e){t.$broadcast("changed-booking-type",{bookingType:e})},t.createBookingOfType=function(e){o.go("app."+e+"-create"),t.modal.hide()},t.$on("changed-booking-type",function(e,o){t.bookingsType=o.bookingType,S(),$()}),t.$on("$ionicView.enter",function(e,t){w(),S(),B(),$(),I()}),t.$on("$ionicView.loaded",function(e,t){P()}),t.$on("$ionicView.leave",function(e){b&&s.cancel(b),t.$broadcast("leaving-view")})}]).controller("BookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","Booking","API_IMG_PATH_URL","$mdToast","Customer","PHOTO_MISSING_SRC","$ionicHistory","BOOKING_TYPES",function(e,t,o,n,r,i,a,s,u,c,l,m,d){var p="templates/modals/booking-delete.html";t.editMode=!1,t.bookingBackup={},t.API_IMG_PATH_URL=s,t.customerImageSrc=l,t.bookingTypes=d;var g=function(){i.fromTemplateUrl(p,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},f=function(){var e=c.query();return e.$promise["catch"](function(){u.show(u.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.customers=e,e.$promise},k=function(){var e=a.get({bookingId:o.id});return e.$promise["catch"](function(){u.show(u.simple().content("Bokningstillfället kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}).then(function(){t.booking.Discount*=100,t.updateCustomerImageSrc()}),t.booking=e,e.$promise};t.updateCustomerImageSrc=function(){var e=t.customers.find(function(e){return e.CustomerId===Number(t.booking.CustomerId)});t.customerImageSrc=null!==e.ImageSrc&&e.ImageSrc.length>1?s+e.ImageSrc:l},t.startEditMode=function(){var e=this;e.isEditMode=!0,e.bookingBackup=angular.copy(e.booking)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.$parent.isEditMode=!1,e.booking=e.bookingBackup},t.saveBooking=function(){var e=this;a.save({BookingTypeId:1,BookingId:o.id,CustomerId:e.booking.CustomerId,NumberOfPeople:e.booking.NumberOfPeople,Notes:e.booking.Notes,Discount:e.booking.Discount/100}).$promise.then(function(t){e.endEditMode(),u.show(u.simple().content("Bokningstillfället sparades med ett lyckat resultat").position("top right").theme("success")),m.goBack()})["catch"](function(e){400!==e.status&&500!==e.status||u.show(u.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle sparas").position("top right").theme("warn")),404===e.status&&(u.show(u.simple().content("Bokningstillfället existerar inte längre. Hann kanske någon radera den?").position("top right").theme("warn")),m.goBack())})},t.deleteBooking=function(){a["delete"]({bookingId:o.id}).$promise.then(function(e){u.show(u.simple().content("Bokningstillfället raderades med ett lyckat resultat").position("top right").theme("success")),m.goBack()})["catch"](function(e){400===e.status&&"undefined"!==e.data.Message&&"Foreign key references exists"===e.data.Message?u.show(u.simple().content("Bokningstillfället kan inte raderas eftersom det finns en lokalbokning, resursbokning eller en måltidsbokning som refererar till bokningstillfället").position("top right").theme("warn")):400!==e.status&&500!==e.status||u.show(u.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle tas bort").position("top right").theme("warn")),404===e.status&&u.show(u.simple().content('Bokningstillfället "'+t.booking.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),m.goBack()})},t.createBookingOfType=function(e){r.go("app."+e+"-create",{bookingId:o.id,customerId:t.booking.CustomerId,startTime:t.booking.StartTime,endTime:t.booking.EndTime})},t.showBooking=function(e,t){r.go("app."+t+"-details",{id:e})},t.$on("$ionicView.beforeEnter",function(e,t){g(),f().then(function(){k()})})}]).controller("BookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","Booking","$mdToast",function(e,t,o,n,r,i){o.booking={},o.saveBooking=function(){var e=this;r.save({BookingId:0,Name:e.booking.Name}).$promise.then(function(t){i.show(i.simple().content('Bokningstillfället "'+e.booking.Name+'" skapades med ett lyckat resultat').position("top right").theme("success")),history.back()})["catch"](function(t){409===t.status?i.show(i.simple().content('Det finns redan ett bokningstillfälle som heter "'+e.booking.Name+'". Två bokningstillfällen kan inte heta lika.').position("top right").theme("warn")):i.show(i.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle sparas").position("top right").theme("warn"))})}}]),angular.module("BookingSystem.resourceBooking",["ngMessages"]).controller("ResourceBookingViewCtrl",["$rootScope","$scope","$state","ResourceBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM",function(e,t,o,n,r,i,a,s,u){var c=i,l=null,m=null,d=null;t.zoom=u,t.weekDate=moment();var p=function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],o=arguments.length<=1||void 0===arguments[1]?"weeks":arguments[1];e>0?t.weekDate=moment(t.weekDate).add(e,o):0>e&&(t.weekDate=moment(t.weekDate).subtract(Math.abs(e),o)),m=moment(t.weekDate).startOf("week"),d=moment(t.weekDate).endOf("week")},g=function(){var e=n.queryLessForPeriod({fromDate:m.format("YYYY-MM-DD"),toDate:d.format("YYYY-MM-DD")});e.$promise["catch"](function(){s.show(s.simple().content("Resursbokningar kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}).then(function(e){t.resourceBookings=e})},f=function(){l=r(function(){g()},c)},k=function(){var e=angular.element(document.querySelector("#booking-view-content"));a.on("pinch",function(e){e.gesture.srcEvent.preventDefault(),t.$apply(function(){t.zoom=e.gesture.scale})},e),a.on("swipeleft",function(e){t.toNextWeek(),t.$apply(),t.$broadcast("swipe-occurred")},e),a.on("swiperight",function(e){t.toPreviousWeek(),t.$apply(),t.$broadcast("swipe-occurred")},e)};t.toNextWeek=function(){p(1),g()},t.toPreviousWeek=function(){p(-1),g()},t.toNextMonth=function(){p(1,"month"),g()},t.toPreviousMonth=function(){p(-1,"month"),g()},t.$on("$ionicView.beforeEnter",function(e,t){p(),g(),f()}),t.$on("$ionicView.loaded",function(e,t){k()}),t.$on("$ionicView.leave",function(e){l&&r.cancel(l),t.$broadcast("leaving-view")})}]).controller("ResourceBookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","ResourceBooking","$mdToast","Resource","Customer","BookingHelper","$q","$ionicHistory","API_IMG_PATH_URL",function(e,t,o,n,r,i,a,s,u,c,l,m,d,p){var g="templates/modals/resource-booking-delete.html";t.editMode=!1,t.resourceBookingBackup={},t.API_IMG_PATH_URL=p;var f=function(){i.fromTemplateUrl(g,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},k=function(){var e=a.get({resourceBookingId:o.id});return e.$promise["catch"](function(){s.show(s.simple().content("Resursbokning kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.resourceBooking=e,e.$promise},h=function(){var e=t.resourceBooking.StartTime,o=t.resourceBooking.EndTime;t.bookingStartDate=moment(e).toDate(),t.bookingStartHour=moment(e).hour(),t.bookingStartMinute=moment(e).minute(),t.bookingEndDate=moment(o).toDate(),t.bookingEndHour=moment(o).hour(),t.bookingEndMinute=moment(o).minute()},v=function(){return"undefined"!=typeof t.bookingStartDate&&"undefined"!=typeof t.bookingStartHour&&"undefined"!=typeof t.bookingStartMinute&&"undefined"!=typeof t.bookingEndDate&&"undefined"!=typeof t.bookingEndHour&&"undefined"!=typeof t.bookingEndMinute},b=function(){t.selectHours=l.getHoursForSelect(),t.selectMinutes=l.getMinutesForSelect()},y=function(){if(v()){var e=I(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute),o=I(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute);u.queryFreeForPeriod({fromDate:e.format("YYYY-MM-DD"),fromTime:e.format("HH:mm"),toDate:o.format("YYYY-MM-DD"),toTime:o.format("HH:mm"),resourceBookingId:t.resourceBooking.ResourceBookingId}).$promise.then(function(e){t.resources=e,t.setSelectedResourceFromId(t.resourceBooking.ResourceId)})["catch"](function(e){s.show(s.simple().content("Ett oväntat fel uppstod när uppgifter om lediga resurser skulle hämtas").position("top right").theme("warn"))})}},M=function(){var e=c.get({customerId:t.resourceBooking.CustomerId});return e.$promise["catch"](function(){s.show(s.simple().content("Kund kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.customer=e,e.$promise},I=function(e,t,o){return moment(e).hour(t).minute(o)};t.startEditMode=function(){var e=this;e.isEditMode=!0,e.resourceBookingBackup=angular.copy(e.resourceBooking)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.resourceBooking=e.resourceBookingBackup},t.deleteResourceBooking=function(){a["delete"]({resourceBookingId:o.id}).$promise.then(function(e){s.show(s.simple().content("Resursbokningen raderades med ett lyckat resultat").position("top right").theme("success")),history.back()})["catch"](function(e){400!==e.status&&500!==e.status||s.show(s.simple().content("Ett oväntat fel uppstod när Resursbokningen skulle tas bort").position("top right").theme("warn")),404===e.status&&s.show(s.simple().content("Resursbokningen existerar inte längre. Hann kanske någon radera den?").position("top right").theme("warn")),history.back()})},t.checkEndDate=function(){if(v()){var e=I(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute).toDate().getTime(),o=I(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute).toDate().getTime();e>o&&(t.bookingEndDate=t.bookingStartDate,t.bookingEndHour=t.bookingStartHour,t.bookingEndMinute=t.bookingStartMinute+15),y()}},t.saveResourceBooking=function(){var e=this,t=m.defer(),o=t.promise;return a.save({BookingId:e.resourceBooking.BookingId,ResourceBookingId:e.resourceBooking.ResourceBookingId,ResourceId:e.resourceBooking.ResourceId,ResourceCount:e.resourceBooking.ResourceCount,StartTime:I(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).format(),EndTime:I(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).format(),Provisional:e.resourceBooking.Provisional}).$promise.then(function(e){s.show(s.simple().content("Resursbokningen sparades med ett lyckat resultat").position("top right").theme("success")),t.resolve(),d.goBack()})["catch"](function(e){409===e.status?s.show(s.simple().content("Alla resurser av denna typ är tyvärr redan bokade under vald tidsram.").position("top right").theme("warn")):s.show(s.simple().content("Ett oväntat fel uppstod när resursbokningen skulle sparas").position("top right").theme("warn"))}),o},t.setSelectedResourceFromId=function(e){t.selectedResource=t.resources.find(function(t){return t.ResourceId===Number(e)})},f(),k().then(function(){h(),M().then(function(){y()})}),b()}]).controller("ResourceBookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","ResourceBooking","Resource","BookingHelper","Customer","$q","$mdToast","$ionicHistory","API_IMG_PATH_URL","PHOTO_MISSING_SRC",function(e,t,o,n,r,i,a,s,u,c,l,m,d){o.resourceBooking={Provisional:!0,BookingTypeId:1},o.API_IMG_PATH_URL=m,o.customerImageSrc=d;var p=function(){n.params.date?(o.bookingStartDate=moment(n.params.date).toDate(),o.bookingStartHour=moment(n.params.date).hour(),o.bookingStartMinute=moment(n.params.date).minute(),o.bookingEndDate=moment(n.params.date).toDate(),o.bookingEndHour=moment(n.params.date).hour(),o.bookingEndMinute=moment(n.params.date).add(59,"minutes").minute()):(o.bookingStartDate=new Date,o.bookingStartHour=8,o.bookingStartMinute=0,o.bookingEndDate=new Date,o.bookingEndHour=8,o.bookingEndMinute=59)},g=function(){return"undefined"!=typeof o.bookingStartDate&&"undefined"!=typeof o.bookingStartHour&&"undefined"!=typeof o.bookingStartMinute&&"undefined"!=typeof o.bookingEndDate&&"undefined"!=typeof o.bookingEndHour&&"undefined"!=typeof o.bookingEndMinute},f=function(){o.selectHours=a.getHoursForSelect(),o.selectMinutes=a.getMinutesForSelect()},k=function(){var e=u.defer();if(g()){var t=y(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute),n=y(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute);i.queryFreeForPeriod({fromDate:t.format("YYYY-MM-DD"),fromTime:t.format("HH:mm"),toDate:n.format("YYYY-MM-DD"),toTime:n.format("HH:mm")}).$promise.then(function(t){o.resources=t,e.resolve()})["catch"](function(t){c.show(c.simple().content("Ett oväntat fel uppstod när uppgifter om lediga resurser skulle hämtas").position("top right").theme("warn")),e.reject()})}return e.promise},h=function(){var e=s.query();e.$promise["catch"](function(){c.show(c.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),o.customers=e},v=function(){o.customerImageSrc=null!==o.customer.ImageSrc&&o.customer.ImageSrc.length>1?m+o.customer.ImageSrc:d},b=function(){var e=s.get({customerId:n.params.customerId});e.$promise["catch"](function(){c.show(c.simple().content("Kund kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}).then(function(){v()}),o.customer=e},y=function(e,t,o){return moment(e).hour(t).minute(o)},M=function(){var e=u.defer();return null!==n.params.bookingId?(o.resourceBooking.BookingId=n.params.bookingId,
e.resolve()):a.createBookingContainer(o.resourceBooking).then(function(t){o.resourceBooking.BookingId=t.BookingId,e.resolve()})["catch"](function(t){c.show(c.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle sparas").position("top right").theme("warn")),e.reject()}),e.promise};o.checkEndDate=function(){if(g()){var e=y(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute).toDate().getTime(),t=y(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute).toDate().getTime();e>t&&(o.bookingEndDate=o.bookingStartDate,o.bookingEndHour=o.bookingStartHour,o.bookingEndMinute=o.bookingStartMinute+15),k()}},o.saveResourceBooking=function(){var e=this,t=u.defer(),o=t.promise;return M().then(function(){var o=y(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).format(),i=y(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).format();r.save({BookingId:e.resourceBooking.BookingId,ResourceBookingId:0,ResourceId:e.resourceBooking.Resource.ResourceId,ResourceCount:e.resourceBooking.ResourceCount,StartTime:o,EndTime:i,Provisional:e.resourceBooking.Provisional}).$promise.then(function(e){c.show(c.simple().content("Resursbokningen skapades med ett lyckat resultat").position("top right").theme("success")),t.resolve(),n.go("app.booking-view",{weekDate:o})})["catch"](function(e){409===e.status?c.show(c.simple().content("Resursen är tyvärr redan bokad under vald tidsram.").position("top right").theme("warn")):c.show(c.simple().content("Ett oväntat fel uppstod när resursbokningen skulle sparas").position("top right").theme("warn"))})}),o},p(),k().then(function(){n.params.customerId?b():h()}),f()}]),angular.module("BookingSystem.start",["ngMessages"]).controller("StartViewCtrl",["$rootScope","$scope","$state","Booking","LocationBooking","ResourceBooking","MealBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM","$stateParams","$ionicHistory","$ionicModal","MODAL_ANIMATION","BOOKING_TYPES",function(e,t,o,n,r,i,a,s,u,c,l,m,d,p,g,f,k){}]),angular.module("BookingSystem.mealBooking",["ngMessages"]).controller("MealBookingViewCtrl",["$rootScope","$scope","$state","MealBooking","$interval","DATA_SYNC_INTERVAL_TIME","$ionicGesture","$mdToast","DEFAULT_CALENDAR_ZOOM",function(e,t,o,n,r,i,a,s,u){var c=i,l=null,m=null,d=null;t.zoom=u,t.weekDate=moment();var p=function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],o=arguments.length<=1||void 0===arguments[1]?"weeks":arguments[1];e>0?t.weekDate=moment(t.weekDate).add(e,o):0>e&&(t.weekDate=moment(t.weekDate).subtract(Math.abs(e),o)),m=moment(t.weekDate).startOf("week"),d=moment(t.weekDate).endOf("week")},g=function(){var e=n.queryLessForPeriod({fromDate:m.format("YYYY-MM-DD"),toDate:d.format("YYYY-MM-DD")});e.$promise["catch"](function(){s.show(s.simple().content("Måltidsbokningar kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}).then(function(e){t.mealBookings=e})},f=function(){l=r(function(){g()},c)},k=function(){var e=angular.element(document.querySelector("#booking-view-content"));a.on("pinch",function(e){e.gesture.srcEvent.preventDefault(),t.$apply(function(){t.zoom=e.gesture.scale})},e),a.on("swipeleft",function(e){t.toNextWeek(),t.$apply(),t.$broadcast("swipe-occurred")},e),a.on("swiperight",function(e){t.toPreviousWeek(),t.$apply(),t.$broadcast("swipe-occurred")},e)};t.toNextWeek=function(){p(1),g()},t.toPreviousWeek=function(){p(-1),g()},t.toNextMonth=function(){p(1,"month"),g()},t.toPreviousMonth=function(){p(-1,"month"),g()},t.$on("$ionicView.beforeEnter",function(e,t){p(),g(),f()}),t.$on("$ionicView.loaded",function(e,t){k()}),t.$on("$ionicView.leave",function(e){l&&r.cancel(l),t.$broadcast("leaving-view")})}]).controller("MealBookingDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","$ionicModal","MealBooking","$mdToast","Meal","Customer","BookingHelper","$q","$ionicHistory","Location","API_IMG_PATH_URL","MealHasProperty",function(e,t,o,n,r,i,a,s,u,c,l,m,d,p,g,f){var k="templates/modals/meal-booking-delete.html";t.editMode=!1,t.mealBookingBackup={},t.API_IMG_PATH_URL=g;var h=function(){i.fromTemplateUrl(k,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},v=function(){var e=a.get({mealBookingId:o.id});return e.$promise.then(function(e){t.mealProperties=e.MealHasProperties})["catch"](function(){s.show(s.simple().content("Måltidsbokning kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.mealBooking=e,e.$promise},b=function(){var e=t.mealBooking.StartTime,o=t.mealBooking.EndTime;t.bookingStartDate=moment(e).toDate(),t.bookingStartHour=moment(e).hour(),t.bookingStartMinute=moment(e).minute(),t.bookingEndDate=moment(o).toDate(),t.bookingEndHour=moment(o).hour(),t.bookingEndMinute=moment(o).minute()},y=function(){return"undefined"!=typeof t.bookingStartDate&&"undefined"!=typeof t.bookingStartHour&&"undefined"!=typeof t.bookingStartMinute&&"undefined"!=typeof t.bookingEndDate&&"undefined"!=typeof t.bookingEndHour&&"undefined"!=typeof t.bookingEndMinute},M=function(){t.selectHours=l.getHoursForSelect(),t.selectMinutes=l.getMinutesForSelect()},I=function(){p.query().$promise.then(function(e){t.locations=e})["catch"](function(e){s.show(s.simple().content("Ett oväntat fel uppstod när lokaler skulle hämtas").position("top right").theme("warn"))})},w=function(){return t.meals=u.query(),t.meals.$promise.then(function(e){t.meals=e})["catch"](function(e){s.show(s.simple().content("Ett oväntat fel uppstod när uppgifter om måltider skulle hämtas").position("top right").theme("warn"))}),t.meals.$promise},$=function(){var e=c.get({customerId:t.mealBooking.CustomerId});return e.$promise["catch"](function(){s.show(s.simple().content("Kund kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.customer=e,e.$promise},S=function(e,t,o){return moment(e).hour(t).minute(o)};t.startEditMode=function(){var e=this;e.isEditMode=!0,e.mealBookingBackup=angular.copy(e.mealBooking)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.mealBooking=e.mealBookingBackup},t.deleteMealBooking=function(){a["delete"]({mealBookingId:o.id}).$promise.then(function(e){s.show(s.simple().content("Måltidsbokningen raderades med ett lyckat resultat").position("top right").theme("success")),history.back()})["catch"](function(e){400!==e.status&&500!==e.status||s.show(s.simple().content("Ett oväntat fel uppstod när Måltidsbokningen skulle tas bort").position("top right").theme("warn")),404===e.status&&s.show(s.simple().content("Måltidsbokningen existerar inte längre. Hann kanske någon radera den?").position("top right").theme("warn")),history.back()})},t.checkEndDate=function(){if(y()){var e=S(t.bookingStartDate,t.bookingStartHour,t.bookingStartMinute).toDate().getTime(),o=S(t.bookingEndDate,t.bookingEndHour,t.bookingEndMinute).toDate().getTime();e>o&&(t.bookingEndDate=t.bookingStartDate,t.bookingEndHour=t.bookingStartHour,t.bookingEndMinute=t.bookingStartMinute+15),w()}},t.saveMealBooking=function(){var e=this,t=m.defer(),o=t.promise;return a.save({BookingId:e.mealBooking.BookingId,MealBookingId:e.mealBooking.MealBookingId,MealId:e.mealBooking.MealId,StartTime:S(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).format(),EndTime:S(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).format(),NumberOfPeople:e.mealBooking.NumberOfPeople,Provisional:e.mealBooking.Provisional,LocationId:e.mealBooking.LocationId,DeliveryAddress:e.mealBooking.DeliveryAddress,MealCount:e.mealBooking.MealCount,Notes:e.mealBooking.Notes}).$promise.then(function(e){s.show(s.simple().content("Måltidsbokningen sparades med ett lyckat resultat").position("top right").theme("success")),t.resolve(),d.goBack()})["catch"](function(e){s.show(s.simple().content("Ett oväntat fel uppstod när måltidsbokningen skulle sparas").position("top right").theme("warn"))}),o},t.updateMealProperties=function(){t.mealBooking.MealId?(t.mealProperties=f.queryForMeal({mealId:t.mealBooking.MealId}),t.mealProperties.$promise["catch"](function(){s.show(s.simple().content("Måltidsegenskaper för vald måltid kunde inte hämtas.").position("top right").theme("warn"))})):t.mealProperties=[]},h(),v().then(function(){return b(),w()}).then(function(){return $()}).then(function(){I(),M()})}]).controller("MealBookingCreateCtrl",["$rootScope","$stateParams","$scope","$state","MealBooking","Meal","BookingHelper","Customer","$q","$mdToast","$ionicHistory","Location","API_IMG_PATH_URL","PHOTO_MISSING_SRC","MealHasProperty",function(e,t,o,n,r,i,a,s,u,c,l,m,d,p,g){o.mealBooking={Provisional:!0,BookingTypeId:1},o.API_IMG_PATH_URL=d,o.customerImageSrc=p;var f=function(){n.params.date?(o.bookingStartDate=moment(n.params.date).toDate(),o.bookingStartHour=moment(n.params.date).hour(),o.bookingStartMinute=moment(n.params.date).minute(),o.bookingEndDate=moment(n.params.date).toDate(),o.bookingEndHour=moment(n.params.date).hour(),o.bookingEndMinute=moment(n.params.date).add(59,"minutes").minute()):(o.bookingStartDate=new Date,o.bookingStartHour=8,o.bookingStartMinute=0,o.bookingEndDate=new Date,o.bookingEndHour=8,o.bookingEndMinute=59)},k=function(){return"undefined"!=typeof o.bookingStartDate&&"undefined"!=typeof o.bookingStartHour&&"undefined"!=typeof o.bookingStartMinute&&"undefined"!=typeof o.bookingEndDate&&"undefined"!=typeof o.bookingEndHour&&"undefined"!=typeof o.bookingEndMinute},h=function(){o.selectHours=a.getHoursForSelect(),o.selectMinutes=a.getMinutesForSelect()},v=function(){var e=m.query();return e.$promise.then(function(e){o.locations=e})["catch"](function(e){c.show(c.simple().content("Ett oväntat fel uppstod när lokaler skulle hämtas").position("top right").theme("warn"))}),e.$promise},b=function(){return o.meals=i.query(),o.meals.$promise.then(function(e){o.meals=e})["catch"](function(e){c.show(c.simple().content("Ett oväntat fel uppstod när uppgifter om måltider skulle hämtas").position("top right").theme("warn"))}),o.meals.$promise},y=function(){var e=s.query();return e.$promise["catch"](function(){c.show(c.simple().content("Kunder kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),o.customers=e,e.$promise},M=function(){o.customerImageSrc=null!==o.customer.ImageSrc&&o.customer.ImageSrc.length>1?d+o.customer.ImageSrc:p},I=function(){var e=s.get({customerId:n.params.customerId});return e.$promise["catch"](function(){c.show(c.simple().content("Kund kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}).then(function(){M()}),o.customer=e,e.$promise},w=function(e,t,o){return moment(e).hour(t).minute(o)},$=function(){var e=u.defer();return null!==n.params.bookingId?(o.mealBooking.BookingId=n.params.bookingId,e.resolve()):a.createBookingContainer(o.mealBooking).then(function(t){o.mealBooking.BookingId=t.BookingId,e.resolve()})["catch"](function(t){c.show(c.simple().content("Ett oväntat fel uppstod när bokningstillfället skulle sparas").position("top right").theme("warn")),e.reject()}),e.promise};o.checkEndDate=function(){if(k()){var e=w(o.bookingStartDate,o.bookingStartHour,o.bookingStartMinute).toDate().getTime(),t=w(o.bookingEndDate,o.bookingEndHour,o.bookingEndMinute).toDate().getTime();e>t&&(o.bookingEndDate=o.bookingStartDate,o.bookingEndHour=o.bookingStartHour,o.bookingEndMinute=o.bookingStartMinute+15),b()}},o.saveMealBooking=function(){var e=this,t=u.defer(),o=t.promise;return $().then(function(){var o=w(e.bookingStartDate,e.bookingStartHour,e.bookingStartMinute).format(),i=w(e.bookingEndDate,e.bookingEndHour,e.bookingEndMinute).format();r.save({BookingId:e.mealBooking.BookingId,MealBookingId:0,MealId:e.mealBooking.MealId,StartTime:o,EndTime:i,LocationId:e.mealBooking.LocationId,DeliveryAddress:e.mealBooking.DeliveryAddress,MealCount:e.mealBooking.MealCount,Provisional:e.mealBooking.Provisional,Notes:e.mealBooking.Notes}).$promise.then(function(e){c.show(c.simple().content("Måltidsbokningen skapades med ett lyckat resultat").position("top right").theme("success")),t.resolve(),n.go("app.booking-view",{weekDate:o})})["catch"](function(e){c.show(c.simple().content("Ett oväntat fel uppstod när måltidsbokningen skulle sparas").position("top right").theme("warn"))})}),o},o.updateMealProperties=function(){o.mealBooking.MealId?(o.mealProperties=g.queryForMeal({mealId:o.mealBooking.MealId}),o.mealProperties.$promise["catch"](function(){c.show(c.simple().content("Måltidsegenskaper för vald måltid kunde inte hämtas.").position("top right").theme("warn"))})):o.mealProperties=[]},f(),b().then(function(){return n.params.customerId?I():y()}).then(function(){v(),h()})}]),angular.module("BookingSystem.mealProperties",[]).controller("MealPropertyListCtrl",["$rootScope","$scope","$state","MealProperty","$mdToast",function(e,t,o,n,r){var i=function(){var e=n.query();e.$promise["catch"](function(){r.show(r.simple().content("Måltidsegenskaper kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.mealProperties=e};t.$on("$ionicView.beforeEnter",function(e,t){i()})}]).controller("MealPropertyDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","MealProperty","$mdToast","API_IMG_PATH_URL",function(e,t,o,n,r,i,a,s,u){var c="templates/modals/meal-property-delete.html";t.isEditMode=!1,t.mealPropertyBackup={},t.API_IMG_PATH_URL=u;var l=function(){r.fromTemplateUrl(c,{scope:t,animation:n}).then(function(e){t.modal=e}),t.$on("$destroy",function(){t.modal.remove()})},m=function(){s.show(s.simple().content('Måltidsegenskapen "'+t.mealProperty.Name+'" sparades med ett lyckat resultat').position("top right").theme("success")),history.back()},d=function(){var e=a.get({mealPropertyId:o.mealPropertyId});t.mealProperty=e};t.startEditMode=function(){var e=this;e.isEditMode=!0,e.mealPropertyBackup=angular.copy(e.mealProperty)},t.endEditMode=function(){var e=this;e.isEditMode=!1},t.abortEditMode=function(){var e=this;e.isEditMode=!1,e.mealProperty=e.mealPropertyBackup},t.saveMealProperty=function(){var e=this;a.save({MealPropertyId:o.mealId,Name:e.mealProperty.Name}).$promise.then(function(t){e.endEditMode(),m()})["catch"](function(t){409===t.status?s.show(s.simple().content('Det finns redan en måltidsegenskap som heter "'+e.mealProperty.Name+'". Två måltidsegenskaper kan inte heta lika.').position("top right").theme("warn")):400!==t.status&&500!==t.status||s.show(s.simple().content("Ett oväntat fel uppstod när måltidsegenskapen skulle sparas").position("top right").theme("warn")),404===t.status&&(s.show(s.simple().content('Måltidsegenskapen "'+e.mealProperty.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back())})},t.deleteMealProperty=function(){a["delete"]({mealPropertyId:o.mealPropertyId}).$promise.then(function(e){s.show(s.simple().content('Måltidsegenskapen "'+t.mealProperty.Name+'" raderades med ett lyckat resultat').position("top right").theme("success")),history.back()})["catch"](function(e){400===e.status&&"undefined"!==e.data.Message&&"Foreign key references exists"===e.data.Message?s.show(s.simple().content("Måltidsegenskapen kan inte raderas eftersom det finns en måltid som refererar till måltidsegenskapen").position("top right").theme("warn")):400!==e.status&&500!==e.status||s.show(s.simple().content("Ett oväntat fel uppstod när måltidsegenskapen skulle tas bort").position("top right").theme("warn")),404===e.status&&s.show(s.simple().content('Måltidsegenskapen "'+t.mealProperty.Name+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back()})},l(),d()}]).controller("MealPropertyCreateCtrl",["$rootScope","$stateParams","$scope","$state","MealProperty","$mdToast",function(e,t,o,n,r,i){o.mealProperty={};var a=function(){i.show(i.simple().content('Måltidsegenskapen "'+o.mealProperty.Name+'" sparades med ett lyckat resultat').position("top right").theme("success")),history.back()};o.saveMealProperty=function(){var e=this;r.save({MealPropertyId:0,Name:e.mealProperty.Name}).$promise.then(function(e){a()})["catch"](function(t){409===t.status?i.show(i.simple().content('Det finns redan en måltidsegenskap som heter "'+e.mealProperty.Name+'". Två måltidsegenskaper kan inte heta lika.').position("top right").theme("warn")):i.show(i.simple().content("Ett oväntat fel uppstod när måltidsegenskapen skulle sparas").position("top right").theme("warn"))})}}]),angular.module("BookingSystem.users",[]).controller("UsersListCtrl",["$rootScope","$scope","$state","User","$mdToast","API_IMG_PATH_URL",function(e,t,o,n,r,i){t.API_IMG_PATH_URL=i;var a=function(){var e=n.query();e.$promise["catch"](function(){r.show(r.simple().content("Användare kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}),t.users=e};t.$on("$ionicView.beforeEnter",function(e,t){a()})}]).controller("UserDetailsCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$ionicModal","$state","User","$mdToast","API_IMG_PATH_URL","UserImage","$q",function(e,t,o,n,r,i,a,s,u,c,l){var m="templates/modals/user-delete.html";t.isEditMode=!1,t.userBackup={},t.API_IMG_PATH_URL=u;var d=function(){r.fromTemplateUrl(m,{scope:t,animation:n}).then(function(e){t.deleteModal=e}),t.$on("$destroy",function(){t.deleteModal.remove()})},p=function(e,t){return c.upload(e.ImageForUpload,t)},g=function(){s.show(s.simple().content('Användaren "'+t.user.FirstName+" "+t.user.SurName+'" sparades med ett lyckat resultat').position("top right").theme("success")),history.back()},f=function(){var e=l.defer(),n=a.get({userId:o.userId});return n.$promise["catch"](function(){s.show(s.simple().content("Användaren kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}).then(function(){e.resolve()}),t.user=n,e.promise};t.startEditMode=function(){t.isEditMode=!0,t.userBackup=angular.copy(t.user)},t.endEditMode=function(){t.isEditMode=!1},t.abortEditMode=function(){t.isEditMode=!1,t.user=t.userBackup},t.saveUser=function(){var e=this;a.save({Id:o.userId,UserName:e.user.UserName,FirstName:e.user.FirstName,SurName:e.user.SurName,EmailAddress:e.user.EmailAddress,CellPhoneNumber:e.user.CellPhoneNumber,ImageSrc:e.user.ImageSrc,PasswordHash:e.user.Password}).$promise.then(function(t){e.endEditMode(),"undefined"!=typeof e.user.ImageForUpload?p(e.user,t.Id).success(function(){g()}).error(function(){s.show(s.simple().content('Användaren "'+e.user.FirstName+" "+e.user.SurName+'" sparades, men det gick inte att ladda upp och spara den önskade bilden.').position("top right").theme("warn"))}):g()})["catch"](function(t){409===t.status?s.show(s.simple().content("Det finns redan en användare med den angivna e-postadressen eller användarnamnet. Var god försök igen.").position("top right").theme("warn")):400!==t.status&&500!==t.status||s.show(s.simple().content("Ett oväntat fel uppstod när användaren skulle sparas").position("top right").theme("warn")),404===t.status&&(s.show(s.simple().content('Användaren "'+e.user.FirstName+" "+e.user.SurName+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back())})},t.deleteUser=function(){a["delete"]({userId:o.userId}).$promise.then(function(e){s.show(s.simple().content('Användaren "'+t.user.FirstName+" "+t.user.SurName+'" raderades med ett lyckat resultat').position("top right").theme("success")),history.back()})["catch"](function(e){400===e.status&&"undefined"!==e.data.Message&&"Foreign key references exists"===e.data.Message?s.show(s.simple().content("Användaren kan inte raderas eftersom det finns en eller flera bokningar som refererar till användaren").position("top right").theme("warn")):400!==e.status&&500!==e.status||s.show(s.simple().content("Ett oväntat fel uppstod när användaren skulle tas bort").position("top right").theme("warn")),404===e.status&&s.show(s.simple().content('Användaren "'+t.user.FirstName+" "+t.user.SurName+'" existerar inte längre. Hann kanske någon radera den?').position("top right").theme("warn")),history.back()})},d(),f()}]).controller("UserCreateCtrl",["$rootScope","$stateParams","$scope","$state","User","$mdToast","UserImage","MODAL_ANIMATION","$ionicModal","$q",function(e,t,o,n,r,i,a,s,u,c){o.isEditMode=!0;var l=function(e,t){return a.upload(e.ImageForUpload,t)},m=function(e){i.show(i.simple().content('Användaren "'+e.FirstName+" "+e.SurName+'" sparades med ett lyckat resultat').position("top right").theme("success")),history.back()};o.saveUser=function(){var e=this;r.save({Id:0,UserName:e.user.UserName,FirstName:e.user.FirstName,SurName:e.user.SurName,EmailAddress:e.user.EmailAddress,CellPhoneNumber:e.user.CellPhoneNumber,ImageSrc:e.user.ImageSrc,PasswordHash:e.user.Password}).$promise.then(function(t){"undefined"!=typeof e.user.ImageForUpload?l(e.user,t.Id).success(function(){m(e.user)}).error(function(){i.show(i.simple().content('Användaren "'+e.user.FirstName+" "+e.user.SurName+'" skapades, men det gick inte att ladda upp och spara den önskade bilden.').position("top right").theme("warn")),history.back()}):m(e.user)})["catch"](function(t){409===t.status?i.show(i.simple().content('Det finns redan en användare med användarnamnet "'+e.user.UserName+'" eller e-postadressen "'+e.user.EmailAddress+'"').position("top right").theme("warn")):i.show(i.simple().content("Ett oväntat fel uppstod när användaren skulle sparas").position("top right").theme("warn"))})}}]),angular.module("BookingSystem.account",[]).controller("AccountCtrl",["$rootScope","$scope","$stateParams","MODAL_ANIMATION","$state","Account","AccountImage","API_IMG_PATH_URL","$q","$mdToast","AuthService",function(e,t,o,n,r,i,a,s,u,c,l){t.isEditMode=!1,t.userBackup={},t.API_IMG_PATH_URL=s;var m=function(){return a.upload(t.user.ImageForUpload)},d=function(){c.show(c.simple().content("Uppgifterna sparades med ett lyckat resultat").position("top right").theme("success"))},p=function(){var e=l.getCredentials();e.userName=t.user.UserName,e.firstName=t.user.FirstName,e.surName=t.user.SurName,e.imageSrc=t.user.ImageSrc,e.emailAddress=t.user.EmailAddress,l.setCredentials(e),l.setRootScopeUserInfo(e)},g=function(){var e=u.defer();return i.getInfo().then(function(e){t.user=e.data})["catch"](function(){c.show(c.simple().content("Uppgifter kunde inte hämtas, var god försök igen.").position("top right").theme("warn"))}).then(function(){e.resolve()}),e.promise};t.startEditMode=function(){t.isEditMode=!0,t.userBackup=angular.copy(t.user)},t.endEditMode=function(){t.isEditMode=!1},t.abortEditMode=function(){t.isEditMode=!1,t.user=t.userBackup},t.saveUser=function(){var t=this;i.changeInfo({Id:e.userInfo.id,UserName:t.user.UserName,FirstName:t.user.FirstName,SurName:t.user.SurName,EmailAddress:t.user.EmailAddress,CellPhoneNumber:t.user.CellPhoneNumber,ImageSrc:t.user.ImageSrc,PasswordHash:t.user.NewPassword,CurrentPasswordHash:t.user.CurrentPassword}).then(function(e){t.endEditMode(),"undefined"!=typeof t.user.ImageForUpload?m().then(function(e){t.user.ImageSrc=e.data.imgpath,p()},function(){c.show(c.simple().content("Uppgifterna sparades, men det gick inte att ladda upp och spara den önskade bilden.").position("top right").theme("warn")),p()}):p(),d()})["catch"](function(e){409===e.status?c.show(c.simple().content("Det finns redan en användare med den angivna e-postadressen eller användarnamnet. Var god försök igen.").position("top right").theme("warn")):400===e.status?c.show(c.simple().content("Du angav ett felaktigt befintligt lösenord. Var god försök igen.").position("top right").theme("warn")):500===e.status&&c.show(c.simple().content("Ett oväntat fel uppstod när uppgifterna skulle sparas").position("top right").theme("warn")),404===e.status&&c.show(c.simple().content("Användaren som du är inloggad med existerar inte längre. Har kanske någon raderat den?").position("top right").theme("warn"))})},g()}]);